[
    {
        "id": "92d196b8dd5edc6f",
        "type": "tab",
        "label": "V1 Shelly2Domoticz",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1d20c4592ce17a6c",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Receive shelly messages",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "f7c7a691f7a8a8aa",
            "1145fcc9acf3d9af",
            "881ef0252de80e38",
            "83b7fe554ae23c89",
            "4adece8fc99d62a4",
            "fea73a18ebaa3187",
            "0c7bcc15624c9c6a",
            "168f4c44499ca695",
            "c23d1ad50c957212",
            "2ac4341fa81dda55",
            "43f62a97c408d326",
            "75f3f1056c55d850",
            "36ab8be5e8f0707a",
            "0a5006d7941a403a",
            "ed5cd1243f511e69",
            "b0a5802a67385d44",
            "1a221eee828825e7",
            "f00b870a2b3a4ed8",
            "1c3e2947d4526955",
            "02f4cc8719938f57",
            "f65704acf6dbb366",
            "8a8623e5bff1f0d2",
            "cbc87b5b74d88b6d",
            "f0d35adec97431cf"
        ],
        "x": 34,
        "y": 739,
        "w": 1632,
        "h": 422
    },
    {
        "id": "a56e0810e773e8af",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Central MQTT settings",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "0352919dff9a05d9",
            "20338ca523d880b5",
            "d61bf0737bbe5d26",
            "3b8a77e979d55f31",
            "91249707778a902a",
            "4378d6ef181b88db"
        ],
        "x": 34,
        "y": 259,
        "w": 672,
        "h": 122
    },
    {
        "id": "f63f63b090614ce8",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Central save file location",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "2555d6929f804330",
            "7a245fcd3ccfb2be",
            "5e1a90b28cd7652f",
            "243b9e52f1131a35",
            "d7bda42a236116da",
            "cb5eea40a9df9c1a"
        ],
        "x": 34,
        "y": 119,
        "w": 432,
        "h": 122
    },
    {
        "id": "b3d079f2647448c5",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Download knop flows.json",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "7323503dbbf8a647",
            "b72e9f90ac9707cd",
            "fe49ef2c7ee2c638",
            "e80c1151e14c827f",
            "805a28464b2a9063",
            "91e08cddf2b1572d",
            "d29bc4f517bcbb58",
            "1041d4fcf830ca2a",
            "ae39f353710ab4c8",
            "ad26c78480bafdd6",
            "651e201443968c5c",
            "89c7a596afea0250"
        ],
        "x": 34,
        "y": 2579,
        "w": 1632,
        "h": 122
    },
    {
        "id": "0ea23c6bf5d11d06",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Save file location",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "a92b8089f03006d7",
            "12382a95ed6aa9ff",
            "e5b25df6ce120e0e",
            "f8aac06e45f026fe",
            "54088a7174c3546d",
            "8c9045fa5bd00cfc",
            "da65421c62378cd0",
            "5f8587713353a1a7",
            "16321d1955b2f049",
            "6f82c95012ec31f6",
            "e68df47c80fe8e65",
            "da17a7b68e3291b2",
            "0b60e1cd78a45be3",
            "fdefabdfc8c7f490",
            "5346be917df01bb5",
            "5379f2e9383a45c2",
            "f742e0f4e735731a",
            "14155ca839bc0053"
        ],
        "x": 34,
        "y": 2719,
        "w": 1632,
        "h": 282
    },
    {
        "id": "ec98a9e37e566593",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly status list",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "ddfa01b865761f8e",
            "4b237a23849a5d48",
            "a8bde6ce1b5cedf0",
            "daa00fa3085ff2c8",
            "e77e20fd5deca7e8",
            "cb75ecdda1a1afbe",
            "e7b24ae597c4e863",
            "e5138d845d050ccd",
            "9d63320360ac75c6"
        ],
        "x": 34,
        "y": 2079,
        "w": 1632,
        "h": 122
    },
    {
        "id": "2ed2aca7ee26a013",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly IDX table",
        "style": {
            "stroke": "#3f93cf",
            "label": true
        },
        "nodes": [
            "0b7895c6dc63149d",
            "af3f88e50ad02e74",
            "0f9ef404ee764b34",
            "bb94cb1060b6b06c",
            "1e34b5df6a63bf13",
            "bcafaf08d92caf75",
            "eb32a5f00cddfa0c",
            "8b3f9821f648e607",
            "81752e16603830e9",
            "b26ff514cf8bbec7",
            "3d10c70462eca2b6",
            "3595d5f7c4977056",
            "3ee91e17ccc4fb71",
            "6fbcc16c92d44e61",
            "20a6d58af853d59a",
            "52e8171859bea37d"
        ],
        "x": 34,
        "y": 1179,
        "w": 1632,
        "h": 202
    },
    {
        "id": "e114b44dfdc366ca",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Flow update nodes",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "1b3e96a9b93baa22",
            "3aa1029e9c66bddd",
            "7ee0250bbb389917",
            "d2fa07a06d3b4653",
            "d85ea8641a530480",
            "fbfa62df44b5e7c1",
            "a52d3e740ebd0117",
            "ca4c6d8652324566",
            "0e686692577996c0",
            "34280f2a742033a5",
            "268830a34e8d27e8",
            "c9f701ec0bae2266"
        ],
        "x": 34,
        "y": 439,
        "w": 752,
        "h": 262
    },
    {
        "id": "53310d80315438e7",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "IDX shelly tabel",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "71edd660cefc9226",
            "56824029e6f38b75",
            "f37da88143021b4d",
            "5e08dd2f8ad71400",
            "65eaf22ab46f5b53",
            "1bdd1463bd9de7af",
            "8b5271b5e1e8c73e",
            "fc932208fd217397",
            "d9250757fb74989c",
            "258f80c01825e3f5",
            "15401017791a176a",
            "7940c2cf97052fdd",
            "719922f9fac16e4e",
            "fe2c286acdd317a3",
            "4d905121d538dff2",
            "e5809c8f14fb37fc",
            "b74a4f656fd434d1",
            "878523dd4ea8b869",
            "374aeba7c6298267",
            "d17447fde1d15eda",
            "3cf568a0737e5ea1",
            "4a8030fb86e585ec",
            "88cb9d4cb9ec641c",
            "f16058a97df52b5b",
            "0a5e15de869bd148",
            "91aca1d4c94f4e9c",
            "a2ac4abe5de37273",
            "a8ce72f77b2fb794",
            "5ea23a0d0eb1223c",
            "758680b394f241ed",
            "68ca6aabf39d31c4"
        ],
        "x": 34,
        "y": 1399,
        "w": 1632,
        "h": 662
    },
    {
        "id": "aa5b9df6db34883d",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "shelly plug s",
        "style": {
            "label": true
        },
        "nodes": [
            "83430460b8152330",
            "042efe88bc1da655",
            "fa343fb45d7c0034",
            "6019ed6ad1baf3b4",
            "1656d435f5fb0b96",
            "d979f950b1a18f2c"
        ],
        "x": 4134,
        "y": 599,
        "w": 452,
        "h": 162
    },
    {
        "id": "98b014cc250aa60f",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly plus plug s",
        "style": {
            "label": true
        },
        "nodes": [
            "8f90adf150c98930",
            "a767ea3c7c819a61",
            "1d4fa7a805dc568d",
            "df6511b0b8e3ada9",
            "a3346f97261cdd86",
            "c6a078b55b0f8a25",
            "2c19472ed947cbef",
            "7dd90562d7687965",
            "6a27eafd6ee10704",
            "b9a572ccaf9553e0",
            "d9d9a728289db90b",
            "26ea029153dbb122",
            "a870e525613f4f3c",
            "92646751eb838e75",
            "efe14eafead58026",
            "0f77a20991559859",
            "6bcd3ad6c6bc93d7"
        ],
        "x": 4014,
        "y": 219,
        "w": 732,
        "h": 362
    },
    {
        "id": "e71056dc0b96e27a",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Debug field",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "d9227172895afaed",
            "b59e45861a97561a",
            "8e08f5823218b31d",
            "bd3511f0fcc77098",
            "5f07089ff3b349c9",
            "c034ca6144fdbb40",
            "40d8b23e65efdc8a",
            "8f177732b930b22d",
            "44836a96444a97eb"
        ],
        "x": 34,
        "y": 2219,
        "w": 1632,
        "h": 202
    },
    {
        "id": "fc8b35056f0e509b",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Set flow.get(tztest) na deploy",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "e068fa12497d183f",
            "c5378ba20d331918",
            "6c994ce1dd5db210",
            "31fa01bc1ec2c935",
            "d6ea666edecc5841",
            "84b44f7ca04cc0f4",
            "fea93a4a8223583a",
            "8d90f2f1ab00542c",
            "c64ab87a306fe49e",
            "b997dae4a8bdff50",
            "fbcf69ec97b52fb1",
            "1765e2e6f41aca11"
        ],
        "x": 34,
        "y": 2439,
        "w": 1632,
        "h": 122
    },
    {
        "id": "1b078b4e3cb34041",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Set flow.get(telegrambot+chatid) na deploy",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "2d5dcb4304a0901a",
            "f897010fb19eecc9",
            "24b8247762331bc4",
            "cf994b3878b086ab",
            "6aba90f378f86134",
            "4ee5d0c3b24afb48",
            "8059f74a1505fd2d",
            "2ddd3e5049ca712a",
            "11baf83766458e57",
            "d0bde3c507cbec9f",
            "65b7fc994ed8a9d5",
            "1aa46d9667bcf55b"
        ],
        "x": 34,
        "y": 3019,
        "w": 1632,
        "h": 162
    },
    {
        "id": "f9c91086607bc42e",
        "type": "group",
        "z": "92d196b8dd5edc6f",
        "name": "Set telegram settings",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "ee14456093c642ae",
            "21850dcc45e2382d",
            "63f0dd7b943e2d88",
            "cbf354f448d7609e",
            "8df879b0f01694f6",
            "05c29c01d7a525f2",
            "3be3c709f83c4a7c",
            "7856886803b859f9",
            "8cd52e02a5b87194",
            "956b8bc8609a7849",
            "f21e4ee1e436e445",
            "aaf1c3f5f04444e8"
        ],
        "x": 34,
        "y": 3199,
        "w": 1632,
        "h": 202
    },
    {
        "id": "a8faf980f2c83ade",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2960,
        "y": 440,
        "wires": [
            [
                "ef900664e9a57d90"
            ]
        ]
    },
    {
        "id": "ba625f0a2884086f",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 140,
        "wires": [
            [
                "4a938f417f68a103"
            ]
        ]
    },
    {
        "id": "57eab72566b9bcfa",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 500,
        "wires": [
            [
                "dbf3bbdb04596980"
            ]
        ]
    },
    {
        "id": "2b012dd5dfe6d0a2",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 420,
        "wires": [
            [
                "22271fbb8dbe3ba4"
            ]
        ]
    },
    {
        "id": "449152afee8fd53d",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 180,
        "wires": [
            [
                "8d4068eaaf348f97"
            ]
        ]
    },
    {
        "id": "69cb8adb9866a3f2",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 600,
        "wires": [
            [
                "90e86d6b8e9fa079"
            ]
        ]
    },
    {
        "id": "92fe0c477a059e70",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 640,
        "wires": [
            [
                "768fe9fc70de4e98"
            ]
        ]
    },
    {
        "id": "11a00e1f7817d6da",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 680,
        "wires": [
            [
                "d6cf4b7f01eab9de"
            ]
        ]
    },
    {
        "id": "8e9cb7076e47e1d3",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 340,
        "wires": [
            [
                "458a487fe0ad5dd7"
            ]
        ]
    },
    {
        "id": "f486312fc75ac00c",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 100,
        "wires": [
            [
                "44a388f260ca3882"
            ]
        ]
    },
    {
        "id": "fdc07d4f0662cef2",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 60,
        "wires": [
            [
                "0262dd2784ddbcfb"
            ]
        ]
    },
    {
        "id": "f4a2d246807abe83",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 20,
        "wires": [
            [
                "90a8ecc4054dd44e"
            ]
        ]
    },
    {
        "id": "aa73787e5571da02",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 220,
        "wires": [
            [
                "7d2f2990120a0f04"
            ]
        ]
    },
    {
        "id": "2e150fa0b29cae75",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 260,
        "wires": [
            [
                "b35faf45bd224ee1"
            ]
        ]
    },
    {
        "id": "2bf1b03be21a804f",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 300,
        "wires": [
            [
                "c7e15f19bf7030e4"
            ]
        ]
    },
    {
        "id": "d742a2b1483d44e6",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 460,
        "wires": [
            [
                "7ffccaf44bcb20f0"
            ]
        ]
    },
    {
        "id": "164d13892c7a7fd4",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2620,
        "y": 380,
        "wires": [
            [
                "125514273a8a9cdb"
            ]
        ]
    },
    {
        "id": "cc84ffe8774363d4",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 2440,
        "y": 560,
        "wires": [
            [
                "ef900664e9a57d90"
            ]
        ]
    },
    {
        "id": "ef900664e9a57d90",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 3100,
        "y": 560,
        "wires": [
            [
                "695a28cecce03922"
            ]
        ]
    },
    {
        "id": "695a28cecce03922",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 3740,
        "y": 560,
        "wires": [
            [
                "132011d15f020671"
            ]
        ]
    },
    {
        "id": "fa8a8e735bc89e55",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 1860,
        "y": 800,
        "wires": [
            [
                "c139d896b383bce5",
                "8fa664fb5c4558f2"
            ]
        ]
    },
    {
        "id": "01137e4043754771",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 1860,
        "y": 840,
        "wires": [
            [
                "3c4b6432d93c9e94",
                "81fc4311ae3cbdfc"
            ]
        ]
    },
    {
        "id": "1a894e509c55deeb",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 1860,
        "y": 880,
        "wires": [
            [
                "8d78d3552e502f99",
                "2a246aa1569e9bd4"
            ]
        ]
    },
    {
        "id": "09aadf5f9c263b40",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 1860,
        "y": 920,
        "wires": [
            [
                "35e16416965daf36",
                "95edc9c75a937f1b"
            ]
        ]
    },
    {
        "id": "021a652eec2880d7",
        "type": "junction",
        "z": "92d196b8dd5edc6f",
        "x": 1860,
        "y": 960,
        "wires": [
            [
                "62d1839a1fb06581",
                "1413d3a57a7c415a"
            ]
        ]
    },
    {
        "id": "bea1ff20d6c4ede1",
        "type": "comment",
        "z": "92d196b8dd5edc6f",
        "name": "V1_19-11-2025_R1",
        "info": "<b>V1 19-11-2025 R1 beta: </b><br>\n- Heartbeat \"Shelly 1PM\" added <br>\n<b>V1 16-11-2025 R1 beta: </b><br>\n- Change: for \"Shelly pro 2PM\", switch:1 (relay) moved to IDXoption4<br>\n- Added: for \"Shelly pro 2PM\", power, current, voltage added<br>\n- Change: minor little improvements<br>\n<b>V1 15-11-2025 R1 beta: </b><br>\n- Change: Device heartbeat code refactored, only availble for \"Shelly pro 2PM\"<br>\n- Added: Telegram, for sending messages when device is offline<br>\n<b>V1 14-11-2025 R1 beta: </b><br>\n- New device added \"Shelly pro 2PM\" (only switch functions, not input readings, still beta release)<br>\n<b>V1 26-05-2023 R1 beta: </b><br>\n- New device added \"Shelly Plug S\" <br>\n- When select device with a known config, the config is written in setup-nodes <br>\n- Announce message are stopped in the flow <br>\n<b>V1 24-05-2023 R1 beta: </b><br>\n- \"Show discovered shellies\" button added. To prevent that pull-down setup menu's clear itself <br>\n  &nbsp&nbsp&nbsp&nbsp It is not a network discovery option. The shelly first needs to send a message, before it will be added <br>\n- Not (yet) supported option added. To already add those devices to the config <br>\n<b>V1 18-05-2023 R1 beta: </b><br>\n- The first release of the shelly flow <br>\n- Only device \"Shelly Plus Plug S\" is available <br>",
        "x": 110,
        "y": 40,
        "wires": []
    },
    {
        "id": "7323503dbbf8a647",
        "type": "http in",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "url": "/shellyflow.json",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 2660,
        "wires": [
            [
                "fe49ef2c7ee2c638"
            ]
        ]
    },
    {
        "id": "b72e9f90ac9707cd",
        "type": "http response",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 770,
        "y": 2660,
        "wires": []
    },
    {
        "id": "fe49ef2c7ee2c638",
        "type": "http request",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "body",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/flows.json",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 350,
        "y": 2660,
        "wires": [
            [
                "91e08cddf2b1572d"
            ]
        ]
    },
    {
        "id": "e80c1151e14c827f",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 2620,
        "wires": [
            [
                "805a28464b2a9063"
            ]
        ]
    },
    {
        "id": "805a28464b2a9063",
        "type": "http request",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/version",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 310,
        "y": 2620,
        "wires": [
            [
                "89c7a596afea0250"
            ]
        ]
    },
    {
        "id": "1b3e96a9b93baa22",
        "type": "comment",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Wat aanpassen bij een nieuwe release",
        "info": "- De \"comment\" node van de release notes.\n- Node \"UPDATE RELEASE\", de versie in aanpassen.\n- Node \"SCRIPT VERSION\", de versie in aanpassen.\n- Op github de \"version\" file aanpassen.\n- Op github de \"releasenotes\" file aanpassen.",
        "x": 210,
        "y": 580,
        "wires": []
    },
    {
        "id": "91e08cddf2b1572d",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "Make http header",
        "func": "let store = flow.get(\"version\")\nmsg.headers['Content-Disposition'] = 'attachment; filename=\"Shelly-' + store + '.json\"'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 2660,
        "wires": [
            [
                "b72e9f90ac9707cd"
            ]
        ]
    },
    {
        "id": "1041d4fcf830ca2a",
        "type": "http request",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/releasenotes",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1090,
        "y": 2620,
        "wires": [
            [
                "ad26c78480bafdd6"
            ]
        ]
    },
    {
        "id": "ad26c78480bafdd6",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "Check response github",
        "func": "if (msg.statusCode === 200 || 201) {\n    return msg;\n} else {\n    msg.payload = '<p style=\"color:red;\">Error loading release notes from github</p><br><a href=\"https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/releasenotes\" target=\"_blank\">Hyperlink to github, for the release notes</a>'\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 2620,
        "wires": [
            [
                "ae39f353710ab4c8"
            ]
        ]
    },
    {
        "id": "3aa1029e9c66bddd",
        "type": "comment",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Welke modules installeren voor deze flow",
        "info": "Via manage pallette, onderstaande modules toevoegen\n- node-red-dashboard\n- node-red-node-ui-table",
        "x": 220,
        "y": 620,
        "wires": []
    },
    {
        "id": "f7c7a691f7a8a8aa",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly, MQTT ",
        "links": [
            "20338ca523d880b5",
            "132011d15f020671",
            "52510ffad0a5ea79",
            "d0bc25e5421e0c7f"
        ],
        "x": 75,
        "y": 860,
        "wires": [
            [
                "881ef0252de80e38",
                "cbc87b5b74d88b6d"
            ]
        ]
    },
    {
        "id": "0352919dff9a05d9",
        "type": "mqtt in",
        "z": "92d196b8dd5edc6f",
        "g": "a56e0810e773e8af",
        "name": "Messages from MQTT-server",
        "topic": "#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "8b0b1c62d0a392d2",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 360,
        "y": 340,
        "wires": [
            [
                "20338ca523d880b5"
            ]
        ]
    },
    {
        "id": "20338ca523d880b5",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "a56e0810e773e8af",
        "name": "Shelly, Central MQTT-IN",
        "mode": "link",
        "links": [
            "f7c7a691f7a8a8aa"
        ],
        "x": 665,
        "y": 320,
        "wires": []
    },
    {
        "id": "d61bf0737bbe5d26",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "a56e0810e773e8af",
        "name": "Shelly, Messages to MQTT-server",
        "links": [
            "155c8d497f7d9280"
        ],
        "x": 75,
        "y": 320,
        "wires": [
            [
                "3b8a77e979d55f31",
                "91249707778a902a"
            ]
        ]
    },
    {
        "id": "3b8a77e979d55f31",
        "type": "mqtt out",
        "z": "92d196b8dd5edc6f",
        "g": "a56e0810e773e8af",
        "name": "Messages to MQTT-server",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "8b0b1c62d0a392d2",
        "x": 360,
        "y": 300,
        "wires": []
    },
    {
        "id": "1145fcc9acf3d9af",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly, Shelly received message",
        "mode": "link",
        "links": [
            "e7b24ae597c4e863",
            "0b7895c6dc63149d",
            "6a776ed98fa7d55f"
        ],
        "x": 1435,
        "y": 900,
        "wires": []
    },
    {
        "id": "d29bc4f517bcbb58",
        "type": "ui_button",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "",
        "group": "d823ccdecb8e433a",
        "order": 1,
        "width": 30,
        "height": 1,
        "passthru": false,
        "label": "{{text}}",
        "tooltip": "",
        "color": "white",
        "bgcolor": "{{background}}",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "show",
        "topicType": "str",
        "x": 890,
        "y": 2620,
        "wires": [
            [
                "1041d4fcf830ca2a"
            ]
        ]
    },
    {
        "id": "7ee0250bbb389917",
        "type": "ui_text",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "group": "53b94e9a48b9cb3e",
        "order": 1,
        "width": 30,
        "height": 2,
        "name": "Top text info tab",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 680,
        "y": 500,
        "wires": []
    },
    {
        "id": "ae39f353710ab4c8",
        "type": "ui_template",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "group": "ecbbb13f9bc2e1f2",
        "name": "",
        "order": 1,
        "width": 30,
        "height": 1,
        "format": "<div ng-init=\"init()\" id=\"pin_insert\" class=\"dialog\">\n    \n    <div class=\"dialog_content\">\n        \n        <div class=\"dialog_header\">\n            <h2 style=\"margin:10px\">Release notes</h2>\n        </div>\n        \n        <div class=\"dialog_body\">\n            <div ng-bind-html=\"msg.payload\" style=\"height:400px;width:100%;margin: 4px 2px;overflow:auto;\"></div>\n            <!--<div ng-bind-html=\"msg.payload\"></div>-->\n            <form action=\"/shellyflow.json\" method=\"get\"><input type=\"submit\" class=\"buttons\" value=\"Download\" name=\"Submit\" id=\"frm1_submit\"/></form>\n            <button class=\"buttoncl\" id=\"myCls\" ng-click=\"closeDialog()\">Close</button>\n        </div> \n    </div> \n</div> \n\n<style>\n\n/* The Dialog (background) */\n.dialog {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index: 9999; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    color : rgb(255,255,255);\n\tbackground-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n    -webkit-transform: translateZ(0px);\n    -webkit-transform: translate3d(0,0,0);\n    -webkit-perspective: 1000;\n}\n\n.dialog_content {\n\tposition: absolute;\n    background-color: rgb(51,51,51);\n    left: 25%;\n    top: 30px;\n    border-radius: 3px;\n    padding: 0;\n    width: 50%;\n    /*height: 70%;*/\n    height: 550px;\n    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);\n    -webkit-animation-name: animatetop;\n    animation-name: animatetop;\n    animation-duration: 0.4s;\n}\n\n/* Dialog Header */\n.dialog_header {\n    padding: 2px 16px;\n    background-color: rgb(20,117,120);\n    border-radius: 3px 3px 0 0;\n    color: white;\n}\n\n/* Dialog Body */\n.dialog_body {padding: 5px;}\n\n/* The Close Button */\n.close {\n    color: #fff;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n}\n\n.close:hover,\n.close:focus {\n    color: #1565C0;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n\n.btn1 {\n  color : rgb(255,255,255);\n  background-color: rgb(20,117,120);\n  border-radius: 3px 3px 3px 3px;\n  font-size: 16px;\n}\n\n/* Button style */\n    .buttoncl {\n        position: absolute;\n        border: none;\n        /*border-radius: 2px;*/\n        padding: 15px 4.4%;\n        font-size: 16px;\n        font-weight:550;\n        font-family:arial;\n        margin: 4px 2px;\n        /*text-transform: uppercase;*/\n        display: inline-block;\n        cursor: pointer;\n        color: white;\n        background-color:  #0A8085;\n        outline: none;\n        left: 85%;\n        top: 88%;\n    } \n    \n    .buttons {\n        position: absolute;\n        background-color: #0A8085;\n        border: none;\n        color: #FFF7E0; \n        padding: 15px 4.4%;\n        text-align: center;\n        text-decoration: none;\n        display: inline-block;\n        font-size: 16px;\n        font-weight:550;\n        font-family:arial;\n        margin: 4px 2px;\n        cursor: pointer;\n        left: 65%;\n        top: 88%;\n    }\n\n</style>\n\n<script>\nvar dialog;\n\n\n/* ==== */\n(function(scope) {\n    \n    scope.passcode = \"\";\n    \n    scope.init = function() {\n        scope.send({payload : \"init\"});\n\t\tscope.passcode = \"\";\n        //Hide the md-panel\n        $('#pin_insert').parent().parent().css(\"display\", \"none\");\n        //This trick make it works on smartphones too :)\n        dialog = $('#pin_insert').detach();\n        //dialog.appendTo(document.body); // This leaves ghost numpads if pinpad is not opened!\n    }\n    \n    scope.showDialog = function() {\n        dialog.appendTo(document.body); // better to add the body only when the numpad is displayed (seams to be removed automatically)\n        dialog.css(\"display\", \"block\");\n    }\n    \n    scope.closeDialog = function(){\n        dialog.css(\"display\", \"none\");\n\t\tscope.send({payload : scope.passcode});\n    }\n     \n\n    scope.$watch('msg', function(data) {\n        if(data && data.topic){\n            switch(data.topic){\n               case \"show\":\n\t\t\t\t\t\tscope.passcode = \"\";\n                        scope.showDialog();\n                break;\n                case \"close\": \n                    dialog.css(\"display\", \"none\");\n                break;\n            }\n        }\n    });\n})(scope);\n\n</script>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1580,
        "y": 2620,
        "wires": [
            []
        ]
    },
    {
        "id": "2555d6929f804330",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "f63f63b090614ce8",
        "name": "Pi file save location",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/home/pi/domoticz/plugins/shelly",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 160,
        "wires": [
            [
                "7a245fcd3ccfb2be"
            ]
        ]
    },
    {
        "id": "7a245fcd3ccfb2be",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "f63f63b090614ce8",
        "name": "Shelly, Pi save location",
        "mode": "link",
        "links": [
            "da65421c62378cd0"
        ],
        "x": 425,
        "y": 160,
        "wires": []
    },
    {
        "id": "d2fa07a06d3b4653",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "get file location",
        "func": "let location = flow.get(\"savefiledestination\")\nmsg.payload = \"<center>Data save folder: \" + location + \"</center>\"\nmsg.topic = \"Actuel version: <b>V1_18-05-2023_R1</b>\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 480,
        "wires": [
            [
                "ca4c6d8652324566"
            ]
        ]
    },
    {
        "id": "d85ea8641a530480",
        "type": "comment",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Save data locaties",
        "info": "Native system:\n/home/pi/domoticz/plugins/shelly\n\nDocker system:\n/data/saved-files/shelly",
        "x": 150,
        "y": 660,
        "wires": []
    },
    {
        "id": "a92b8089f03006d7",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 850,
        "y": 2760,
        "wires": [
            [
                "fdefabdfc8c7f490"
            ]
        ]
    },
    {
        "id": "12382a95ed6aa9ff",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Get save location pi",
        "func": "let destination = msg.payload;\nmsg.filename = destination + \"/testPIdirectory\";\nflow.set(\"savefiledestination\", destination);\nmsg.delay = 5000;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 2800,
        "wires": [
            [
                "f742e0f4e735731a"
            ]
        ]
    },
    {
        "id": "e5b25df6ce120e0e",
        "type": "catch",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "",
        "scope": [
            "7ee6eacc2a5d9cd1",
            "f742e0f4e735731a"
        ],
        "uncaught": false,
        "x": 110,
        "y": 2880,
        "wires": [
            [
                "5f8587713353a1a7"
            ]
        ]
    },
    {
        "id": "f8aac06e45f026fe",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Get save location docker",
        "func": "let destination = msg.payload;\nmsg.filename = destination + \"/testDOCKERdirectory\";\nflow.set(\"savefiledestination\", destination);\nmsg.delay = 5000;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 2880,
        "wires": [
            [
                "14155ca839bc0053"
            ]
        ]
    },
    {
        "id": "54088a7174c3546d",
        "type": "catch",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "",
        "scope": [
            "082e0f0318b184c7",
            "14155ca839bc0053"
        ],
        "uncaught": false,
        "x": 110,
        "y": 2960,
        "wires": [
            [
                "6f82c95012ec31f6"
            ]
        ]
    },
    {
        "id": "5e1a90b28cd7652f",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "f63f63b090614ce8",
        "name": "Docker file save location",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/data/saved-files/shelly",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "243b9e52f1131a35"
            ]
        ]
    },
    {
        "id": "243b9e52f1131a35",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "f63f63b090614ce8",
        "name": "Shelly, Docker save location",
        "mode": "link",
        "links": [
            "16321d1955b2f049"
        ],
        "x": 425,
        "y": 200,
        "wires": []
    },
    {
        "id": "d7bda42a236116da",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "f63f63b090614ce8",
        "name": "Shelly, Pi save location",
        "links": [
            "8c9045fa5bd00cfc"
        ],
        "x": 75,
        "y": 160,
        "wires": [
            [
                "2555d6929f804330"
            ]
        ]
    },
    {
        "id": "cb5eea40a9df9c1a",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "f63f63b090614ce8",
        "name": "Shelly, Docker save location",
        "links": [
            "5f8587713353a1a7"
        ],
        "x": 75,
        "y": 200,
        "wires": [
            [
                "5e1a90b28cd7652f"
            ]
        ]
    },
    {
        "id": "8c9045fa5bd00cfc",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Shelly, Start after deploy",
        "mode": "link",
        "links": [
            "0e686692577996c0",
            "d7bda42a236116da"
        ],
        "x": 1625,
        "y": 2760,
        "wires": []
    },
    {
        "id": "da65421c62378cd0",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Shelly, Pi data save location",
        "links": [
            "7a245fcd3ccfb2be"
        ],
        "x": 335,
        "y": 2800,
        "wires": [
            [
                "12382a95ed6aa9ff"
            ]
        ]
    },
    {
        "id": "5f8587713353a1a7",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Shelly, Get docker save location",
        "mode": "link",
        "links": [
            "cb5eea40a9df9c1a"
        ],
        "x": 265,
        "y": 2880,
        "wires": []
    },
    {
        "id": "16321d1955b2f049",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Shelly, Docker data save location",
        "links": [
            "243b9e52f1131a35"
        ],
        "x": 335,
        "y": 2880,
        "wires": [
            [
                "f8aac06e45f026fe",
                "da17a7b68e3291b2"
            ]
        ]
    },
    {
        "id": "6f82c95012ec31f6",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Error find directory",
        "func": "let error = \"ERROR, directory PI and DOCKER not found\"\nflow.set(\"savefiledestination\", error);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 2960,
        "wires": [
            [
                "da17a7b68e3291b2"
            ]
        ]
    },
    {
        "id": "e68df47c80fe8e65",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Shelly, start UI",
        "mode": "link",
        "links": [
            "b997dae4a8bdff50",
            "fbfa62df44b5e7c1",
            "24b8247762331bc4"
        ],
        "x": 1625,
        "y": 2960,
        "wires": []
    },
    {
        "id": "0b60e1cd78a45be3",
        "type": "delay",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1460,
        "y": 2960,
        "wires": [
            [
                "e68df47c80fe8e65"
            ]
        ]
    },
    {
        "id": "da17a7b68e3291b2",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "reset delay",
        "func": "delete msg.delay;\ndelete msg.error;\nmsg.reset = true;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 2960,
        "wires": [
            [
                "0b60e1cd78a45be3"
            ]
        ]
    },
    {
        "id": "fbfa62df44b5e7c1",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Shelly, start UI text bar",
        "links": [
            "e68df47c80fe8e65"
        ],
        "x": 75,
        "y": 480,
        "wires": [
            [
                "d2fa07a06d3b4653"
            ]
        ]
    },
    {
        "id": "a52d3e740ebd0117",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "start after deploy",
        "func": "let location = \"please wait, loading config\"\nmsg.payload = \"Data save folder: \" + location\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 520,
        "wires": [
            [
                "ca4c6d8652324566"
            ]
        ]
    },
    {
        "id": "ca4c6d8652324566",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "SCRIPT VERSION",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Actuel version: V1_19-11-2025_R1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 500,
        "wires": [
            [
                "7ee0250bbb389917"
            ]
        ]
    },
    {
        "id": "0e686692577996c0",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Shelly, startup",
        "links": [
            "8c9045fa5bd00cfc"
        ],
        "x": 75,
        "y": 520,
        "wires": [
            [
                "a52d3e740ebd0117"
            ]
        ]
    },
    {
        "id": "fdefabdfc8c7f490",
        "type": "http request",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://127.0.0.1:1880/settings",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 2760,
        "wires": [
            [
                "5346be917df01bb5"
            ]
        ]
    },
    {
        "id": "5346be917df01bb5",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1270,
        "y": 2760,
        "wires": [
            [
                "5379f2e9383a45c2"
            ]
        ]
    },
    {
        "id": "5379f2e9383a45c2",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "Get version",
        "func": "flow.set(\"NoderedVersion\",msg.payload.version);\nmsg.payload = new(Date);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 2760,
        "wires": [
            [
                "8c9045fa5bd00cfc"
            ]
        ]
    },
    {
        "id": "f742e0f4e735731a",
        "type": "file",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "V3 Pi, test directory exists",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1110,
        "y": 2800,
        "wires": [
            [
                "0b60e1cd78a45be3"
            ]
        ]
    },
    {
        "id": "14155ca839bc0053",
        "type": "file",
        "z": "92d196b8dd5edc6f",
        "g": "0ea23c6bf5d11d06",
        "name": "V3 Docker, test directory exists",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1130,
        "y": 2880,
        "wires": [
            [
                "0b60e1cd78a45be3"
            ]
        ]
    },
    {
        "id": "34280f2a742033a5",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Shelly, update release in",
        "links": [
            "89c7a596afea0250"
        ],
        "x": 415,
        "y": 560,
        "wires": [
            [
                "c9f701ec0bae2266"
            ]
        ]
    },
    {
        "id": "268830a34e8d27e8",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "Shelly, update release out",
        "mode": "link",
        "links": [
            "651e201443968c5c"
        ],
        "x": 705,
        "y": 560,
        "wires": []
    },
    {
        "id": "c9f701ec0bae2266",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "e114b44dfdc366ca",
        "name": "UPDATE RELEASE",
        "func": "let version = \"V1_19-11-2025_R1\"\nlet oldStr = msg.payload;\nlet newStr = oldStr.slice(0, oldStr.length-1);\nlet store = newStr;\nflow.set(\"version\", newStr);\nlet html = \"\";\nmsg.topic = \"Release notes\";\nif (msg.statusCode === 200 || 201) {\n    if (store === version) {\n        msg.text = \"FLOW IS UP TO DATE WITH GITHUB (\" + version + \")\"\n        msg.background = \"#0A8085\";\n        return msg;\n    } else {\n        msg.text = \"THERE IS AN UPDATE, CLICK HERE TO READ RELEASE-NOTES AND DOWNLOAD FLOW FILE FROM GITHUB\"\n        msg.background = \"#8C101C\";\n        return msg;\n    }\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 560,
        "wires": [
            [
                "268830a34e8d27e8"
            ]
        ]
    },
    {
        "id": "89c7a596afea0250",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "Shelly, update release in",
        "mode": "link",
        "links": [
            "34280f2a742033a5"
        ],
        "x": 435,
        "y": 2620,
        "wires": []
    },
    {
        "id": "651e201443968c5c",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "b3d079f2647448c5",
        "name": "Shelly, update release out",
        "links": [
            "268830a34e8d27e8"
        ],
        "x": 745,
        "y": 2620,
        "wires": [
            [
                "d29bc4f517bcbb58"
            ]
        ]
    },
    {
        "id": "881ef0252de80e38",
        "type": "switch",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Contain domoticz/out",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "domoticz/out",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 240,
        "y": 1080,
        "wires": [
            [
                "c23d1ad50c957212"
            ]
        ]
    },
    {
        "id": "83b7fe554ae23c89",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Source domoticz",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "domoticz",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1040,
        "wires": [
            [
                "0c7bcc15624c9c6a"
            ]
        ]
    },
    {
        "id": "4adece8fc99d62a4",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Source shelly gen 1",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 900,
        "wires": [
            [
                "0c7bcc15624c9c6a",
                "1145fcc9acf3d9af"
            ]
        ]
    },
    {
        "id": "fea73a18ebaa3187",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Source shelly gen 2 or 3",
        "rules": [
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen2-3",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 860,
        "wires": [
            [
                "0c7bcc15624c9c6a",
                "1145fcc9acf3d9af"
            ]
        ]
    },
    {
        "id": "0c7bcc15624c9c6a",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly ID filter on ui table",
        "func": "let storetopic = msg.topic;\nlet devs = flow.get(\"sh2dz-idx\") || {};\nlet length = Object.keys(devs).length;\n\nif (msg.source === 'gen1' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n             \n        if (IDkey === storetopic.split(\"/\")[1]) {\n            let type = dev.type;\n            let output = msg.payload;\n            msg.payload = { output, script: { source: \"Shelly_gen1\" }, domoticz : { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen}};\n            \n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null, null];\n            } else if (type === \"Shelly pro 2PM\") {\n                return [null, null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, null, msg];\n            }\n        }\n    }\n} else {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n                \n        if (IDkey === storetopic.split(\"/\")[0]){\n            let type = dev.type;\n            msg.payload.domoticz = { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen };\n            msg.payload.script = { source: \"Shelly_gen2-3\" };\n\n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null, null];\n            } else if (type === \"Shelly pro 2PM\") {\n                return [null, null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, null, msg];\n            }\n        }\n    }\n}\n\nif ( msg.source === 'domoticz' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let message = devs[IDkey];\n        let messageidx = parseInt(devs[IDkey].idx);\n        let messageidxoption4 = parseInt(devs[IDkey].idxoption4);\n\n        if (messageidx === msg.payload.idx || messageidxoption4 === msg.payload.idx) {\n            let type = message.type;\n            msg.payload.domoticz =  { name: message.name, sw: message.sw, idx: message.idx, idxoption1: message.idxoption1, idxoption2: message.idxoption2, idxoption3: message.idxoption3, idxoption4: message.idxoption4, idxoption5: message.idxoption5, idxoption6: message.idxoption6, idxoption7: message.idxoption7, idxoption8: message.idxoption8, offline: message.offline, addon: message.addon, gen: message.gen };\n            msg.payload.script = { source: \"Domoticz\" }\n                        \n            if (type === \"Shelly Plug S\") {\n                if (messageidx === msg.payload.idx) {\n                    return [msg, null, null, null, null, null]\n                }\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                if (messageidx === msg.payload.idx) {\n                    return [null, null, msg, null, null, null];\n                }\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null, null];\n            } else if (type === \"Shelly pro 2PM\") {\n                return [null, null, null, null, msg, null];    \n            } else {\n                if (messageidx === msg.payload.idx) {\n                    return [null, null, null, null, null, msg];\n                }\n            }\n        }\n    }\n}\n\nreturn [null, null, null, null, null, msg];",
        "outputs": 6,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 840,
        "wires": [
            [
                "fa8a8e735bc89e55"
            ],
            [
                "01137e4043754771"
            ],
            [
                "1a894e509c55deeb"
            ],
            [
                "09aadf5f9c263b40"
            ],
            [
                "021a652eec2880d7"
            ],
            [
                "2ac4341fa81dda55"
            ]
        ]
    },
    {
        "id": "168f4c44499ca695",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "IDX not in filter",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 1000,
        "wires": []
    },
    {
        "id": "8f90adf150c98930",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4670,
        "y": 280,
        "wires": [
            [
                "52510ffad0a5ea79"
            ]
        ]
    },
    {
        "id": "a767ea3c7c819a61",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":false, \"apower\":0.0, \"voltage\":0.0, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 260,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "1d4fa7a805dc568d",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "b48a0a1bf220 : 0 Status false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 260,
        "wires": [
            [
                "a767ea3c7c819a61"
            ]
        ]
    },
    {
        "id": "df6511b0b8e3ada9",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":0.053, \"voltage\":231.3, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 300,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "a3346f97261cdd86",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "b48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 300,
        "wires": [
            [
                "df6511b0b8e3ada9"
            ]
        ]
    },
    {
        "id": "c6a078b55b0f8a25",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":12.0, \"voltage\":231.3, \"current\":7.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 340,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "2c19472ed947cbef",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "c48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 340,
        "wires": [
            [
                "c6a078b55b0f8a25"
            ]
        ]
    },
    {
        "id": "ddfa01b865761f8e",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "Shelly, Update table out",
        "mode": "link",
        "links": [
            "e5138d845d050ccd"
        ],
        "x": 1625,
        "y": 2160,
        "wires": []
    },
    {
        "id": "4b237a23849a5d48",
        "type": "ui_toast",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1450,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "a8bde6ce1b5cedf0",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "Del shelly device status list",
        "func": "if (msg.topic === \"del\") {\n    let devs = flow.get(\"sh2dz-status\") || {};\n    delete devs[(msg.payload.name)];\n    \n    msg.topic = msg.payload.name + \" removed from status table\";\n    msg.payload = \"Device is removed.\"\n    return msg;\n}\n\nmsg.topic = msg.payload.label;\n\nlet str = JSON.stringify(msg.payload, null, 2);\ndelete msg.payload;\nmsg.payload = \"<pre>\" + str + \"</pre>\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 2160,
        "wires": [
            [
                "4b237a23849a5d48",
                "ddfa01b865761f8e"
            ]
        ]
    },
    {
        "id": "daa00fa3085ff2c8",
        "type": "ui_table",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "group": "5d07dbcaa2c15860",
        "name": "Shelly Devices",
        "order": 1,
        "width": 30,
        "height": 11,
        "columns": [
            {
                "field": "name",
                "title": "Topic name",
                "width": "15%",
                "align": "left",
                "formatter": "html",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "command",
                "title": "Command",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "output",
                "title": "Payload",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "seen",
                "title": "Last seen",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "status",
                "title": "Status",
                "width": "59%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "del",
                "title": "Remove",
                "width": "7%",
                "align": "center",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 880,
        "y": 2160,
        "wires": [
            [
                "a8bde6ce1b5cedf0"
            ]
        ]
    },
    {
        "id": "e77e20fd5deca7e8",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "store shelly devices",
        "func": "let devs; \nlet status = \"update\";\n\nif ( msg.src === 'restore' ) {\n    devs = flow.get(\"sh2dz-status\") || {};\n    Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime() - element[1].lastTime) / 60000) + \"m\");\n\n    flow.set(\"sh2dz-status\", devs);\n    return [{payload:Object.values(devs)}];\n} else {\n    if (msg.source === 'gen1') {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload === \"announce\") {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [];\n\n            // properties that should not show up in the status\n            let notStatus = [\"name\", \"status\"];\n \n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {};\n\n            let devt = flow.get(\"sh2dz-idx\") || {};\n            let length = Object.keys(devt).length;\n\n            let receivedSensors = [];\n            let sw;\n            if (msg.topic.split(\"/\")[3] === undefined) {\n                sw = msg.topic.split(\"/\")[2];\n            } else {\n                sw = msg.topic.split(\"/\")[2] + \" \" + msg.topic.split(\"/\")[3];\n            }\n            let ID = (msg.topic.split(\"/\")[1]);\n            let dev = devs[ID] || {};\n\n            dev.name = msg.topic.split(\"/\")[1];\n            dev.sw = sw;\n            dev.output = msg.payload;\n            //dev.power = msg.payload.apower;\n            //dev.voltage = msg.payload.voltage;\n            //dev.current = msg.payload.current;\n\n            dev.lastTime = new Date().getTime();\n\n            // create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (inStatus.includes(prop)) {\n                    status += \" \" + prop + \": \" + dev[prop];\n                }\n            }\n            if (status === \"\") {\n                for (let prop in dev) {\n                    if (!notStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop];\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n\n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime() - element[1].lastTime) / 60000) + \"m\");\n\n            flow.set(\"sh2dz-status\", devs);\n\n            return [{ topic: status, payload: Object.values(devs) }];\n        }\n    } else {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\" ) {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [\"power\", \"voltage\", \"current\", \"total\", \"temperature\"];\n   \n            // properties that should not show up in the status\n            let notStatus = [\"id\", \"source\"];\n\n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {}; \n         \n            let receivedSensors = [];\n            let ID = (msg.topic.split(\"/\")[0]);\n            let dev = devs[ID] || {};\n\n            dev.name = ID;\n            dev.command = (msg.topic.split(\"/\")[2]);;\n            if ((msg.payload.output === true) || (msg.payload.output === false)) {\n              dev.output = \"output = \" + msg.payload.output;\n            } else {\n              dev.output = null;  \n            }\n\n            dev.lastTime = new Date().getTime();    \n\n            dev.power = msg.payload.apower;\n            dev.voltage = msg.payload.voltage;\n            dev.current = msg.payload.current;\n            \n            //create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (dev[prop] === undefined) {\n                    null;\n                } else {\n                    if (inStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop] + \", \";\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n       \n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime()-element[1].lastTime)/60000)+\"m\");\n    \n            flow.set(\"sh2dz-status\", devs);\n\n            return [{topic: status, payload:Object.values(devs)}];\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 2160,
        "wires": [
            [
                "daa00fa3085ff2c8"
            ]
        ]
    },
    {
        "id": "cb75ecdda1a1afbe",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "add src",
        "func": "msg.src = 'restore';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 2160,
        "wires": [
            [
                "e77e20fd5deca7e8"
            ]
        ]
    },
    {
        "id": "e7b24ae597c4e863",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "Shelly message received",
        "links": [
            "1145fcc9acf3d9af"
        ],
        "x": 425,
        "y": 2120,
        "wires": [
            [
                "e77e20fd5deca7e8"
            ]
        ]
    },
    {
        "id": "e5138d845d050ccd",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "Shelly, restore/update table",
        "links": [
            "ddfa01b865761f8e"
        ],
        "x": 205,
        "y": 2120,
        "wires": [
            [
                "cb75ecdda1a1afbe"
            ]
        ]
    },
    {
        "id": "9d63320360ac75c6",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "ec98a9e37e566593",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 2160,
        "wires": [
            [
                "cb75ecdda1a1afbe"
            ]
        ]
    },
    {
        "id": "7dd90562d7687965",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":21.0, \"voltage\":213.3, \"current\":17.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 380,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "6a27eafd6ee10704",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "c48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 380,
        "wires": [
            [
                "7dd90562d7687965"
            ]
        ]
    },
    {
        "id": "b9a572ccaf9553e0",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":false, \"apower\":0.0, \"voltage\":0.0, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 420,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "d9d9a728289db90b",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "b48a0a1bf220 : 1 Status false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 420,
        "wires": [
            [
                "b9a572ccaf9553e0"
            ]
        ]
    },
    {
        "id": "26ea029153dbb122",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":0.053, \"voltage\":231.3, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 460,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "a870e525613f4f3c",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "b48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 460,
        "wires": [
            [
                "26ea029153dbb122"
            ]
        ]
    },
    {
        "id": "92646751eb838e75",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":12.0, \"voltage\":231.3, \"current\":7.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 500,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "efe14eafead58026",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "c48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 500,
        "wires": [
            [
                "92646751eb838e75"
            ]
        ]
    },
    {
        "id": "0f77a20991559859",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":21.0, \"voltage\":213.3, \"current\":17.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 540,
        "wires": [
            [
                "8f90adf150c98930"
            ]
        ]
    },
    {
        "id": "6bcd3ad6c6bc93d7",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "98b014cc250aa60f",
        "name": "c48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 540,
        "wires": [
            [
                "0f77a20991559859"
            ]
        ]
    },
    {
        "id": "8d78d3552e502f99",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "gen2 Shelly Plus Plug S",
        "func": "let d = new Date();\nlet apower, voltage, current, total;\n\nif (msg.payload.script.source === \"Shelly_gen2-3\") {\n    let info = msg.topic.split(\"/\")[1];\n    let output;\n    \n    if (info === \"status\") {\n      let domoticz = flow.get(\"dz-state\") || {};\n      let idxstate = [];\n      let ID = \"idx:\" + msg.payload.domoticz.idx\n      let dev = domoticz[ID] || {};\n      let length = Object.keys(domoticz).length;\n\n      dev.lasttime = d.getTime();\n      dev.offline = msg.payload.domoticz.offline;\n      dev.name = msg.payload.domoticz.name;\n      if (dev.online === false) {\n        let bot = flow.get(\"bot\") || {};\n        let chatid = flow.get(\"chatid\") || {};\n\n        node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n\n        let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n        msg.payload = '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online';\n        node.send([null, msg]);\n      }\n      dev.online = true;\n\n      for (let i = 0; i < length; i++) {\n        let keys = Object.keys(domoticz);\n        let IDkey = keys[i];\n        let dev = domoticz[IDkey] || {};\n\n        if (IDkey === ID) {\n          output = dev.output;\n        }\n      }\n\n      //apower\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined || msg.payload.domoticz.idxoption1 === \"N/A\" || msg.payload.domoticz.idxoption1 === \"Not set\") {\n        apower = null\n      } else {\n        apower = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption1),\n            svalue: msg.payload.apower.toString(),\n          }\n        }\n      }\n\n      //voltage\n      if (Number(msg.payload.domoticz.idxoption2) === 0 || msg.payload.domoticz.idxoption2 === undefined || msg.payload.domoticz.idxoption2 === \"N/A\" || msg.payload.domoticz.idxoption2 === \"Not set\") {\n        voltage = null;\n      } else {\n        voltage = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption2),\n            svalue: msg.payload.voltage.toString(),\n          }\n        }\n      }\n\n      //current\n      if (Number(msg.payload.domoticz.idxoption3) === 0 || msg.payload.domoticz.idxoption3 === undefined || msg.payload.domoticz.idxoption3 === \"N/A\" || msg.payload.domoticz.idxoption3 === \"Not set\") {\n        current = null;\n      } else {\n        current = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption3),\n            svalue: msg.payload.current.toString(),\n          }\n        }\n      }\n\n      //total\n      if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined || msg.payload.domoticz.idxoption4 === \"N/A\" || msg.payload.domoticz.idxoption4 === \"Not set\") {\n        total = null;\n      } else {\n        total = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption4),\n            nvalue: 0,\n            svalue: msg.payload.aenergy.total + \"\\\";\\\"\" + 0,\n          }\n        }\n      }\n\n      //Output\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg = null\n      } else {\n        if (output == msg.payload.output) {\n          msg = null;\n        } else {\n          dev.output = msg.payload.output\n          let val = msg.payload.output == true ? 1 : 0;\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: val,\n            }\n          }\n        }\n      }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  msg.topic = msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  \n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2490,
        "y": 880,
        "wires": [
            [
                "395b797b820e467c",
                "155c8d497f7d9280",
                "0c8b6e0ac4103dbd"
            ]
        ]
    },
    {
        "id": "926c4c1cc51ec205",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Heartbeat check every minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"script\":{\"source\":\"Heartbeat\"}}",
        "payloadType": "json",
        "x": 2010,
        "y": 720,
        "wires": [
            [
                "b179283e080d8798"
            ]
        ]
    },
    {
        "id": "c23d1ad50c957212",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "IDX Check",
        "func": "let filter = flow.get(\"dz-idx-filter\") || [];\n\nif (msg.payload.hasOwnProperty(\"idx\")) {\n    if (filter.includes(msg.payload.idx.toString())) {\n        return [null, msg];\n        } else {\n        return [msg, null]; \n    }\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1080,
        "wires": [
            [
                "168f4c44499ca695"
            ],
            [
                "83b7fe554ae23c89",
                "1c3e2947d4526955"
            ]
        ]
    },
    {
        "id": "0b7895c6dc63149d",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Shelly, message idx tabel",
        "links": [
            "1145fcc9acf3d9af"
        ],
        "x": 245,
        "y": 1280,
        "wires": [
            [
                "af3f88e50ad02e74"
            ]
        ]
    },
    {
        "id": "af3f88e50ad02e74",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Prepare for device table",
        "func": "let devs; \ndevs = flow.get(\"sh2dz-idx\") || {};\n\nif ( msg.src === 'restore' ) {\n    return [{payload:Object.values(devs)}];\n} else if (msg.source === 'gen1') {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let relay = msg.topic.split(\"/\")[3];\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[1];\n        let ID = name;\n        let dev = devs[ID] || {};\n        if (relay === \"energy\") {\n            return;\n        }\n\n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        dev.sw = relay;\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        } \n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }\n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }    \n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }\n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }\n\n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n} else {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[0];\n        let relay = msg.topic.split(\":\")[1];\n        if (relay === undefined) {\n            relay = (Object.keys(msg.payload[\"params\"])[1]).split(\":\")[1];\n        }\n        if (relay === undefined) {\n            //return;\n            relay = null;\n        }\n\n        let ID = name;\n        let dev = devs[ID] || {};\n        if (relay === \"energy\") {\n            return;\n        }\n\n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        //if (dev.type === undefined) {\n            //dev.sw = msg.payload.params[(Object.keys(msg.payload[\"params\"])[1])].id;\n        //} else {\n            //dev.sw = relay;\n        //}\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n            dev.sw = relay;\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        }\n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }\n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }\n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }\n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }\n\n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1240,
        "wires": [
            [
                "52e8171859bea37d",
                "0f9ef404ee764b34"
            ]
        ]
    },
    {
        "id": "0f9ef404ee764b34",
        "type": "ui_table",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "group": "e151206531f4336f",
        "name": "Shelly tabel",
        "order": 16,
        "width": 30,
        "height": 4,
        "columns": [
            {
                "field": "name",
                "title": "Name",
                "width": "23%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "type",
                "title": "Type",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idx",
                "title": "IDX",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption1",
                "title": "Option 1",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption2",
                "title": "Option 2",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption3",
                "title": "Option 3",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption4",
                "title": "Option 4",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption5",
                "title": "Option 5",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption6",
                "title": "Option 6",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption7",
                "title": "Option 7",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption8",
                "title": "Option 8",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "offline",
                "title": "Offline (sec)",
                "width": "9%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "del",
                "title": "Remove",
                "width": "10%",
                "align": "center",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 670,
        "y": 1260,
        "wires": [
            [
                "bb94cb1060b6b06c"
            ]
        ]
    },
    {
        "id": "bb94cb1060b6b06c",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Prefix for asking del?",
        "func": "if (msg.topic === \"del\") {\n    flow.set(\"delbuffer\", msg.payload)\n    \n    msg.topic = \"IDX tabel: Delete \" + msg.payload.name + \", switch \" + msg.payload.sw + \"?\";\n    msg.payload = \"Do you want to remove this device out the IDX list?\"\nreturn [msg, null];    \n}\n\n\n//msg.topic = msg.payload.name + \" (sw:\" + msg.payload.sw + \")\";\nmsg.topic = msg.payload.name;\n\nlet str = JSON.stringify(msg.payload, null, 2);\ndelete msg.payload;\nmsg.payload = \"<pre>\" + str + \"</pre>\";\n\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1320,
        "wires": [
            [
                "1e34b5df6a63bf13"
            ],
            [
                "eb32a5f00cddfa0c"
            ]
        ]
    },
    {
        "id": "1e34b5df6a63bf13",
        "type": "ui_toast",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Cancel",
        "cancel": "Remove",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Del asking pop-up",
        "x": 690,
        "y": 1300,
        "wires": [
            [
                "bcafaf08d92caf75"
            ]
        ]
    },
    {
        "id": "bcafaf08d92caf75",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Del in shelly tabel",
        "func": "if (msg.payload === \"Cancel\"){\n    flow.set(\"delbuffer\", \"\");\n    return;\n} else {\n    let dev = flow.get(\"sh2dz-idx\") || {};\n    let devs = flow.get(\"dz-state\") || {};\n    let filter = flow.get(\"dz-idx-filter\") || {};\n    let remove = flow.get(\"delbuffer\")   \n\n    delete dev[remove.name];\n    delete devs[\"idx:\"+remove.idx];\n\n    for (var i = 0; i < filter.length; i++) {\n        if (filter[i] === remove.idx) {\n            filter.splice(i, 1);\n        }\n    }\n    flow.set(\"dz-idx-filter\", filter);\n\n    msg.topic = \"Removing shelly device from list.\"\n    msg.payload = remove.name + \", is removed from IDX list.\";\n\n    let reconfig = flow.get(\"sh2dz-idx\") || {}\n    flow.set(\"delbuffer\", \"\");\n    return [msg,{payload:Object.values(reconfig)}];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 1320,
        "wires": [
            [
                "8b3f9821f648e607",
                "81752e16603830e9"
            ],
            [
                "3595d5f7c4977056"
            ]
        ]
    },
    {
        "id": "eb32a5f00cddfa0c",
        "type": "ui_toast",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Show detail info",
        "x": 680,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "8b3f9821f648e607",
        "type": "ui_toast",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1190,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "81752e16603830e9",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Shelly, Restore in (shelly table)",
        "mode": "link",
        "links": [
            "3d10c70462eca2b6"
        ],
        "x": 1115,
        "y": 1260,
        "wires": []
    },
    {
        "id": "b26ff514cf8bbec7",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "add src",
        "func": "msg.src = 'restore';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 1240,
        "wires": [
            [
                "af3f88e50ad02e74"
            ]
        ]
    },
    {
        "id": "3d10c70462eca2b6",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Shelly, restore idxtable out",
        "links": [
            "8d90f2f1ab00542c",
            "81752e16603830e9",
            "15401017791a176a"
        ],
        "x": 75,
        "y": 1240,
        "wires": [
            [
                "b26ff514cf8bbec7"
            ]
        ]
    },
    {
        "id": "3595d5f7c4977056",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1150,
        "y": 1340,
        "wires": [
            [
                "6fbcc16c92d44e61"
            ]
        ]
    },
    {
        "id": "3ee91e17ccc4fb71",
        "type": "file",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "6fbcc16c92d44e61",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1340,
        "wires": [
            [
                "3ee91e17ccc4fb71"
            ]
        ]
    },
    {
        "id": "155c8d497f7d9280",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly to mqtt",
        "mode": "link",
        "links": [
            "d61bf0737bbe5d26",
            "9b3576adfd857fdb"
        ],
        "x": 2695,
        "y": 760,
        "wires": []
    },
    {
        "id": "395b797b820e467c",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "gen2 shelly plus plug s",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2780,
        "y": 880,
        "wires": []
    },
    {
        "id": "20a6d58af853d59a",
        "type": "ui_button",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "",
        "group": "e151206531f4336f",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Show discovered shellies",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 1340,
        "wires": [
            [
                "b26ff514cf8bbec7"
            ]
        ]
    },
    {
        "id": "52e8171859bea37d",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "2ed2aca7ee26a013",
        "name": "Shelly, Device discovered",
        "mode": "link",
        "links": [
            "7940c2cf97052fdd"
        ],
        "x": 615,
        "y": 1220,
        "wires": []
    },
    {
        "id": "2ac4341fa81dda55",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Not (yet) supported",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1530,
        "y": 980,
        "wires": []
    },
    {
        "id": "f607fa0e36bbdcd1",
        "type": "ui_text",
        "z": "92d196b8dd5edc6f",
        "group": "61d922efb8a113fa",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Github URL: https://github.com/Hoeby/V1-Shelly-Nodered-flow",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 250,
        "y": 80,
        "wires": []
    },
    {
        "id": "c139d896b383bce5",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "gen1 Shelly Plug S",
        "func": "let d = new Date();\nlet apower, voltage, current, total;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n  let info = msg.topic.split(\"/\")[2];\n  let energy = msg.topic.split(\"/\")[4];\n  let output;\n\n  if (info === \"relay\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx:\" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload; \n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.name = msg.payload.domoticz.name;\n    if (dev.online === false) {\n      let bot = flow.get(\"bot\") || {};\n      let chatid = flow.get(\"chatid\") || {};\n\n      node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n\n      let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n      msg.payload = '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online';\n      node.send([null, msg]);\n    }\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        output = dev.output;\n      }\n    }\n      \n    //Output\n    let val;\n    if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n      msg = null\n    } else {\n      if (msg.payload.output === \"on\") {\n        dev.output = true;\n        val = 1;\n      } else if (msg.payload.output === \"off\") {\n        dev.output = false;\n        val = 0;\n      }\n      if (output == dev.output) {\n        msg = null;\n      } else {\n        msg = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idx),\n            nvalue: val,\n          }\n        }\n      }\n    }\n\n    //apower\n    if (dev.output === true) {\n      if (energy === \"energy\") {\n        if (Number(save.domoticz.idxoption1) === 0 || save.domoticz.idxoption1 === undefined || save.domoticz.idxoption1 === \"N/A\" || save.domoticz.idxoption1 === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption1),\n              svalue: save.output.output.toString(),\n            }\n          }\n        }\n      }\n    } else if (dev.output === false) {\n      if (output == dev.output) {\n        msg = null;\n      } else {\n        if (Number(save.domoticz.idxoption1) === 0 || save.domoticz.idxoption1 === undefined || save.domoticz.idxoption1 === \"N/A\" || save.domoticz.idxoption1 === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption1),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n  \n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 800,
        "wires": [
            [
                "3860bc834882a3ba",
                "155c8d497f7d9280",
                "0c8b6e0ac4103dbd"
            ]
        ]
    },
    {
        "id": "3860bc834882a3ba",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "gen1 shelly plug s",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2770,
        "y": 800,
        "wires": []
    },
    {
        "id": "83430460b8152330",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "aa5b9df6db34883d",
        "name": "Shellies plug energy",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"output\":9,\"domoticz\":{\"name\":\"shellyplug-s-80646F817476\",\"sw\":\"0\",\"idx\":\"11\",\"idxoption1\":\"N/A\",\"idxoption2\":\"N/A\",\"idxoption3\":\"N/A\",\"idxoption4\":\"N/A\",\"idxoption5\":\"N/A\",\"idxoption6\":\"N/A\",\"idxoption7\":\"N/A\",\"idxoption8\":\"N/A\",\"offline\":\"N/A\",\"addon\":\"none\",\"gen\":\"gen1\"},\"script\":{\"source\":\"Shelly_gen1\"}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0/energy",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4460,
        "y": 680,
        "wires": [
            [
                "5e1121d6993021d7"
            ]
        ]
    },
    {
        "id": "042efe88bc1da655",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "aa5b9df6db34883d",
        "name": "Shellies plug on",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 640,
        "wires": [
            [
                "52510ffad0a5ea79"
            ]
        ]
    },
    {
        "id": "fa343fb45d7c0034",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "aa5b9df6db34883d",
        "name": "Shellies plug off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 720,
        "wires": [
            [
                "52510ffad0a5ea79"
            ]
        ]
    },
    {
        "id": "6019ed6ad1baf3b4",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "aa5b9df6db34883d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 640,
        "wires": [
            [
                "042efe88bc1da655"
            ]
        ]
    },
    {
        "id": "1656d435f5fb0b96",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "aa5b9df6db34883d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 680,
        "wires": [
            [
                "83430460b8152330"
            ]
        ]
    },
    {
        "id": "d979f950b1a18f2c",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "aa5b9df6db34883d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 720,
        "wires": [
            [
                "fa343fb45d7c0034"
            ]
        ]
    },
    {
        "id": "71edd660cefc9226",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX nummer",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idx",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1500,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "56824029e6f38b75",
        "type": "ui_button",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "group": "e151206531f4336f",
        "order": 15,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Set settings",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 550,
        "y": 1900,
        "wires": [
            [
                "5e08dd2f8ad71400",
                "fc932208fd217397"
            ]
        ]
    },
    {
        "id": "f37da88143021b4d",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Clear",
        "func": "delete msg.payload;\nmsg.payload =\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1980,
        "wires": [
            [
                "71edd660cefc9226",
                "65eaf22ab46f5b53",
                "1bdd1463bd9de7af",
                "8b5271b5e1e8c73e",
                "d9250757fb74989c",
                "4a8030fb86e585ec",
                "88cb9d4cb9ec641c",
                "719922f9fac16e4e",
                "0a5e15de869bd148",
                "91aca1d4c94f4e9c",
                "a2ac4abe5de37273"
            ]
        ]
    },
    {
        "id": "5e08dd2f8ad71400",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Set Device settings",
        "func": "let option1 = [\"Shelly Plug S\", \"Shelly Plus Plug S\", \"Shelly 1pm mini\", \"Shelly pro 2PM\"];\nlet option2 = [\"Shelly Plus Plug S\", \"Shelly pro 2PM\"];\nlet option3 = [\"Shelly Plus Plug S\", \"Shelly pro 2PM\"];\nlet option4 = [\"Shelly Plus Plug S\", \"Shelly pro 2PM\"];\nlet option5 = [\"Shelly pro 2PM\"];\nlet option6 = [\"Shelly pro 2PM\"];\nlet option7 = [\"Shelly pro 2PM\"];\nlet option8 = [];\nlet option13 = [\"Shelly 1pm mini\", \"Shelly pro 2PM\",];\nlet data1 = context.get(\"data1\") || null; //get from context or default to null\nlet data2 = context.get(\"data2\") || null; //get from context or default to null\nlet data3 = context.get(\"data3\") || null; //get from context or default to null\nlet data4 = context.get(\"data4\") || \"Not set\"; //get from context or default to 0\nlet data5 = context.get(\"data5\") || \"Not set\"; //get from context or default to 0\nlet data6 = context.get(\"data6\") || \"Not set\"; //get from context or default to 0\nlet data7 = context.get(\"data7\") || \"Not set\"; //get from context or default to 0\nlet data8 = context.get(\"data8\") || \"Not set\"; //get from context or default to 0\nlet data9 = context.get(\"data9\") || \"Not set\"; //get from context or default to 0\nlet data10 = context.get(\"data10\") || \"Not set\"; //get from context or default to 0\nlet data11 = context.get(\"data11\") || \"Not set\"; //get from context or default to 0\nlet data12 = context.get(\"data12\") || \"Not set\"; //get from context or default to 0\nlet data13 = context.get(\"data13\") || \"Not set\"; //get from context or default to 0\n\n\nlet reconfig = flow.get(\"sh2dz-idx\") || {};\n\nswitch (msg.topic){\n\n    case \"device\":\n        //data1 = msg.payload; \n        data1 = msg.payload.split(\"/\")[0];\n        data2 = msg.payload.split(\"/\")[1];\n        context.set(\"data1\", data1);//store in context for next time \n        context.set(\"data2\", data2);//store in context for next time \n        return;\n\n    //case \"sw\":\n    //    data2 = msg.payload;\n    //    context.set(\"data2\", data2);//store in context for next time \n    //    return;\n\n    case \"type\":\n        data3 = msg.payload;\n        context.set(\"data3\", data3);//store in context for next time \n        return;\n    \n    case \"idx\":\n        data4 = msg.payload; \n        context.set(\"data4\", data4);//store in context for next time \n        return;\n        \n    case \"idxoption1\":\n        data5 = msg.payload;\n        context.set(\"data5\", data5); //store in context for next time \n        return;\n        \n    case \"idxoption2\":\n        data6 = msg.payload;\n        context.set(\"data6\", data6); //store in context for next time \n        return;\n    \n    case \"idxoption3\":\n        data7 = msg.payload;\n        context.set(\"data7\", data7); //store in context for next time \n        return;\n    \n    case \"idxoption4\":\n        data8 = msg.payload;\n        context.set(\"data8\", data8); //store in context for next time \n        return;\n\n    case \"idxoption5\":\n        data9 = msg.payload;\n        context.set(\"data9\", data9); //store in context for next time \n        return;\n\n    case \"idxoption6\":\n        data10 = msg.payload;\n        context.set(\"data10\", data10); //store in context for next time \n        return;\n    \n    case \"idxoption7\":\n        data11 = msg.payload;\n        context.set(\"data11\", data11); //store in context for next time \n        return;\n    \n    case \"idxoption8\":\n        data12 = msg.payload;\n        context.set(\"data12\", data12); //store in context for next time \n        return;\n\n    case \"offline\":\n        data13 = msg.payload;\n        context.set(\"data13\", data13); //store in context for next time \n        return;\n\n    case \"submit\":\n        if (data1 !== null ) {\n            let receivedSensors = [];\n            let dev = reconfig[(data1.split(\"/\")[0])] || {};\n            \n            dev.type = data3;\n\n            dev.name = data1.split(\":\")[0];\n            //dev.sw = data1.split(\":\")[1];\n            \n            if (data3 === \"Shelly pro 2PM\") {\n                dev.sw0 = \"0\";\n                dev.sw1 = \"1\";\n            } else {\n                dev.sw = data2;\n            }\n                     \n            if (data3 === \"Not (yet) supported\") {\n                dev.idx = \"N/A\";\n            } else {\n                dev.idx = data4;\n            }            \n            if (option1.includes(data3)) {\n                dev.idxoption1 = data5;\n            } else {\n                dev.idxoption1 = \"N/A\";\n            }\n            if (option2.includes(data3)) {\n                dev.idxoption2 = data6;\n            } else {\n                dev.idxoption2 = \"N/A\";\n            } \n            if (option3.includes(data3)) {\n                dev.idxoption3 = data7;\n            } else {\n                dev.idxoption3 = \"N/A\";\n            }\n            if (option4.includes(data3)) {\n                dev.idxoption4 = data8;\n            } else {\n                dev.idxoption4 = \"N/A\";\n            }\n            if (option5.includes(data3)) {\n                dev.idxoption5 = data9;\n            } else {\n                dev.idxoption5 = \"N/A\";\n            }\n            if (option6.includes(data3)) {\n                dev.idxoption6 = data10;\n            } else {\n                dev.idxoption6 = \"N/A\";\n            }\n            if (option7.includes(data3)) {\n                dev.idxoption7 = data11;\n            } else {\n                dev.idxoption7 = \"N/A\";\n            }\n            if (option8.includes(data3)) {\n                dev.idxoption8 = data12;\n            } else {\n                dev.idxoption8 = \"N/A\";\n            }\n            if (option13.includes(data3)) {\n                dev.offline = data13;                \n            } else {\n                dev.offline = \"N/A\";\n            }\n            // write back\n            reconfig[(data1.split(\"/\")[0])] = dev;\n            receivedSensors.push(dev);\n \n            flow.set(\"sh2dz-idx\", reconfig);\n            context.set(\"data1\", null);\n        } else {\n            return;\n        }\n    }\n\nreturn [{payload:Object.values(reconfig)},msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 1620,
        "wires": [
            [
                "258f80c01825e3f5",
                "68ca6aabf39d31c4"
            ],
            [
                "15401017791a176a"
            ]
        ]
    },
    {
        "id": "65eaf22ab46f5b53",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 1",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 7,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption1",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1540,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "1bdd1463bd9de7af",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 2",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 12,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption2",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1580,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "8b5271b5e1e8c73e",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 4",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 8,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption4",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1660,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "fc932208fd217397",
        "type": "delay",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 1980,
        "wires": [
            [
                "f37da88143021b4d"
            ]
        ]
    },
    {
        "id": "d9250757fb74989c",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 3",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption3",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1620,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "258f80c01825e3f5",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1150,
        "y": 1600,
        "wires": [
            [
                "d17447fde1d15eda"
            ]
        ]
    },
    {
        "id": "15401017791a176a",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Shelly, Restore idx table",
        "mode": "link",
        "links": [
            "3d10c70462eca2b6"
        ],
        "x": 1105,
        "y": 1640,
        "wires": []
    },
    {
        "id": "7940c2cf97052fdd",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Shelly, Device in",
        "links": [
            "452b38fec749323b",
            "6908453d834d5d49",
            "52e8171859bea37d"
        ],
        "x": 75,
        "y": 1440,
        "wires": [
            [
                "374aeba7c6298267"
            ]
        ]
    },
    {
        "id": "719922f9fac16e4e",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Device list",
        "func": "msg.payload = \"\"\nmsg.options = [\"Shelly Plug S\",\n               \"Shelly 2.5 shutter mode\",\n               \"Shelly 1pm mini\",\n               \"Shelly Plus Plug S\",\n               \"Shelly pro 2PM\",\n               \"Not (yet) supported\" ]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1960,
        "wires": [
            [
                "fe2c286acdd317a3"
            ]
        ]
    },
    {
        "id": "fe2c286acdd317a3",
        "type": "ui_dropdown",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "device type",
        "label": "",
        "tooltip": "",
        "place": "Device type",
        "group": "e151206531f4336f",
        "order": 11,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [],
        "payload": "",
        "topic": "type",
        "topicType": "str",
        "className": "",
        "x": 730,
        "y": 1960,
        "wires": [
            [
                "5e08dd2f8ad71400",
                "e5809c8f14fb37fc"
            ]
        ]
    },
    {
        "id": "4d905121d538dff2",
        "type": "ui_button",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "group": "e151206531f4336f",
        "order": 10,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "How setup device in domoticz",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 1490,
        "y": 1860,
        "wires": [
            [
                "e5809c8f14fb37fc"
            ]
        ]
    },
    {
        "id": "e5809c8f14fb37fc",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "How to setup device in domoticz",
        "func": "let device = context.get(\"type\") || 0; //get from context or default to 0\n\nswitch (msg.topic){\n\n    case \"type\":\n        device = msg.payload; \n        context.set(\"type\", device);//store in context for next time \n        return;\n\n    case \"submit\":\n        \n        //Shelly Plug s (gen1)\n        if (device === \"Shelly Plug S\") {\n            msg.topic = \"Shelly Plug S (generation 1)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch (Dummy = switch)</p><p>IDXoption1 = Power (Dummy = Usage, Electric)</p><p>IDXoption2 = Not available for this device</p><p>IDXoption3 = Not available for this device</p><p>IDXoption4 = Not available for this device</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n        \n        //Shelly 2.5 (gen1)\n        } else if (device === \"Shelly 2.5\") {\n            msg.topic = \"Shelly 2.5 (generation 1)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch relay 0 (Dummy = switch)</p><p>IDXoption1 = switch relay 1 (Dummy = switch)</p><p>IDXoption2 = input 0 (Dummy = switch)</p><p>IDXoption3 = input 1 (Dummy = switch)</p><p>IDXoption4 = Voltage (Dummy = General, Voltage)</p><p>IDXoption5 = Energy 0 (Dummy = General, kWh)</p><p>IDXoption6 = Energy 1 (Dummy = General, kWh)</p><p>IDXoption7 = Power 0 (Dummy = General, Electric)</p><p>IDXoption8 = Power 1 (Dummy = General, Electric)</p><p>Offline notify = Not available for this device</p>\"\n     \n        //Shelly Plus Plug S (gen2)    \n        } else if (device === \"Shelly Plus Plug S\" ) {   \n            msg.topic = \"Shelly Plus Plug S (generation 2)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch (Dummy = switch)</p><p>IDXoption1 = Power (Dummy = Usage, Electric)</p><p>IDXoption2 = Voltage (Dummy = General, Voltage)</p><p>IDXoption3 = Current (Dummy = General, Current)</p><p>IDXoption4 = Total power (Dummy = General, kWh)</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n\n        //Shelly 1PM mini (gen3)       \n        } else if (device === \"Shelly 1pm mini\") {\n            msg.topic = \"Shelly 1PM mini (generation 3)\"\n            msg.payload = \"<p>For heartbeat the 'Generic status update over MQTT' has to be set in 'MQTT settings' of the shelly device</p><p></p><p>Make dummy device in domoticz.</p><p>IDX = switch relay 0 (Dummy = switch)</p><p>IDXoption1 = input 0 (Dummy = switch)</p><p>IDXoption2 = Not available for this device</p><p>IDXoption3 = Not available for this device</p><p>IDXoption4 = Not available for this device</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = If set, then minimum value is 15 minutes</p>\"\n\n        //Shelly Pro 2PM (gen2)    \n        } else if (device === \"Shelly pro 2PM\") {\n            msg.topic = \"Shelly pro 2PM (generation 2)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX has to be set to work properly</p><p>IDX = Relay switch0 (Dummy = switch)</p><p>IDXoption1 = Power switch0 (Dummy = Usage, Electric)</p><p>IDXoption2 = Voltage switch0 (Dummy = General, Voltage)</p><p>IDXoption3 = Current switch0 (Dummy = General, Current)</p><p>IDXoption4 = Relay switch1 (Dummy = switch)</p><p>IDXoption5 = Power switch1 (Dummy = Usage, Electric)</p><p>IDXoption6 = Voltage switch1 (Dummy = General, Voltage)</p><p>IDXoption7 = Current switch1 (Dummy = General, Current)</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n\n\n        } else {\n            msg.topic = \"Device unknown\"\n            msg.payload = \"<p>First select device type, afterwards the info is shown</p>\"\n        }\n        return msg;\n    }",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 1900,
        "wires": [
            [
                "b74a4f656fd434d1"
            ]
        ]
    },
    {
        "id": "b74a4f656fd434d1",
        "type": "ui_toast",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1450,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "878523dd4ea8b869",
        "type": "ui_dropdown",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "",
        "tooltip": "",
        "place": "Device",
        "group": "e151206531f4336f",
        "order": 6,
        "width": 6,
        "height": 1,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "device",
        "topicType": "str",
        "className": "",
        "x": 540,
        "y": 1440,
        "wires": [
            [
                "5e08dd2f8ad71400",
                "5ea23a0d0eb1223c",
                "758680b394f241ed"
            ]
        ]
    },
    {
        "id": "374aeba7c6298267",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "extract devicenames",
        "func": "if (msg.topic === \"no-update\")  {\n   return;\n} else {\n   msg.options = msg.payload.map(obj => {\n      var rObj = {};\n      rObj[obj.name] = obj.name + \"/\" + obj.sw\n      return rObj;\n   });\n}\n\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1440,
        "wires": [
            [
                "878523dd4ea8b869"
            ]
        ]
    },
    {
        "id": "d17447fde1d15eda",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1600,
        "wires": [
            [
                "3cf568a0737e5ea1"
            ]
        ]
    },
    {
        "id": "3cf568a0737e5ea1",
        "type": "file",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 1600,
        "wires": [
            []
        ]
    },
    {
        "id": "4a8030fb86e585ec",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 5",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 13,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption5",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1700,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "88cb9d4cb9ec641c",
        "type": "ui_dropdown",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Offline notificatie",
        "label": "Offline notify",
        "tooltip": "",
        "place": "",
        "group": "e151206531f4336f",
        "order": 5,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Disable",
                "value": "Disable",
                "type": "str"
            },
            {
                "label": "5 minutes",
                "value": 300,
                "type": "num"
            },
            {
                "label": "10 minutes",
                "value": 600,
                "type": "num"
            },
            {
                "label": "15 minutes",
                "value": 900,
                "type": "num"
            },
            {
                "label": "20 minutes",
                "value": 1200,
                "type": "num"
            },
            {
                "label": "25 minutes",
                "value": "1500",
                "type": "str"
            },
            {
                "label": "30 minutes",
                "value": "1800",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "offline",
        "topicType": "str",
        "className": "",
        "x": 560,
        "y": 1860,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "f16058a97df52b5b",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Set device list",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 300,
        "y": 2020,
        "wires": [
            [
                "719922f9fac16e4e"
            ]
        ]
    },
    {
        "id": "0a5e15de869bd148",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 6",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption6",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1740,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "91aca1d4c94f4e9c",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 7",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 9,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption7",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1780,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "a2ac4abe5de37273",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "label": "IDX option 8",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 14,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption8",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1820,
        "wires": [
            [
                "5e08dd2f8ad71400"
            ]
        ]
    },
    {
        "id": "a8ce72f77b2fb794",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "Set stored value",
        "func": "if (msg.payload === undefined) {\n  return;\n} else {\n  let devicename = msg.payload.split(\"/\")[0];\n  let settings = flow.get(\"sh2dz-idx\") || {};\n  let length = Object.keys(settings).length;\n  let type, idx, idxoption1, idxoption2, idxoption3, idxoption4, idxoption5, idxoption6, idxoption7, idxoption8, offline\n\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(settings);\n    let IDkey = keys[i];\n    let dev = settings[IDkey] || {};\n\n    if (dev.name === devicename) {\n      if (dev.type === \"unknown\") {\n        node.log(\"unknown\")\n      } else {\n        type = dev.type\n        type = { payload: type,}\n      }\n      if (dev.idx === undefined ) {\n        node.log(\"unknown\")\n      } else if (dev.idx === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idx = dev.idx\n        idx = { payload: idx, }\n      }\n      if (dev.idxoption1 === undefined || dev.idxoption1 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption1 = dev.idxoption1\n        idxoption1 = { payload: idxoption1, }\n      }\n      if (dev.idxoption2 === undefined || dev.idxoption2 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption2 = dev.idxoption2\n        idxoption2 = { payload: idxoption2, }\n      }\n      if (dev.idxoption3 === undefined || dev.idxoption3 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption3 = dev.idxoption3\n        idxoption3 = { payload: idxoption3, }\n      }\n      if (dev.idxoption4 === undefined || dev.idxoption4 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption4 = dev.idxoption4\n        idxoption4 = { payload: idxoption4, }\n      }\n      if (dev.idxoption5 === undefined || dev.idxoption5 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption5 = dev.idxoption5\n        idxoption5 = { payload: idxoption5, }\n      }\n      if (dev.idxoption6 === undefined || dev.idxoption6 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption6 = dev.idxoption6\n        idxoption6 = { payload: idxoption6, }\n      }\n      if (dev.idxoption7 === undefined || dev.idxoption7 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption7 = dev.idxoption7\n        idxoption7 = { payload: idxoption7, }\n      }\n      if (dev.idxoption8 === undefined || dev.idxoption8 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption8 = dev.idxoption8\n        idxoption8 = { payload: idxoption8, }\n      }\n      if (dev.offline === undefined || dev.offline === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        offline = dev.offline\n        offline = { payload: offline, }\n      }\n    }\n  }\n  return [type, idx, idxoption1, idxoption2, idxoption3, idxoption4, idxoption5, idxoption6, idxoption7, idxoption8, offline];\n}\n\nreturn;",
        "outputs": 11,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 1800,
        "wires": [
            [
                "fe2c286acdd317a3"
            ],
            [
                "71edd660cefc9226"
            ],
            [
                "65eaf22ab46f5b53"
            ],
            [
                "1bdd1463bd9de7af"
            ],
            [
                "d9250757fb74989c"
            ],
            [
                "8b5271b5e1e8c73e"
            ],
            [
                "4a8030fb86e585ec"
            ],
            [
                "0a5e15de869bd148"
            ],
            [
                "91aca1d4c94f4e9c"
            ],
            [
                "a2ac4abe5de37273"
            ],
            [
                "88cb9d4cb9ec641c"
            ]
        ]
    },
    {
        "id": "5ea23a0d0eb1223c",
        "type": "delay",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 210,
        "y": 1680,
        "wires": [
            [
                "a8ce72f77b2fb794"
            ]
        ]
    },
    {
        "id": "758680b394f241ed",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 1540,
        "wires": [
            [
                "71edd660cefc9226",
                "65eaf22ab46f5b53",
                "1bdd1463bd9de7af",
                "8b5271b5e1e8c73e",
                "d9250757fb74989c",
                "fe2c286acdd317a3",
                "4a8030fb86e585ec",
                "88cb9d4cb9ec641c",
                "0a5e15de869bd148",
                "91aca1d4c94f4e9c",
                "a2ac4abe5de37273"
            ]
        ]
    },
    {
        "id": "52510ffad0a5ea79",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly manual test",
        "mode": "link",
        "links": [
            "f7c7a691f7a8a8aa"
        ],
        "x": 4885,
        "y": 680,
        "wires": []
    },
    {
        "id": "4a938f417f68a103",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 relay 1Off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 140,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "dbf3bbdb04596980",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Power relay 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1/power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "62.88",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 500,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "22271fbb8dbe3ba4",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Energy relay 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1/energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "23145",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 420,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "8d4068eaaf348f97",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Input 0 op 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 180,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "90e86d6b8e9fa079",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Temperature",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/temperature",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "56.73",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 600,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "768fe9fc70de4e98",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Overtemperature",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/overtemperature",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2760,
        "y": 640,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "d6cf4b7f01eab9de",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Overtemp status",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/temperature_status",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Normal",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2760,
        "y": 680,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "458a487fe0ad5dd7",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/voltage",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "229.35",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2730,
        "y": 340,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "37159475d241f77b",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 140,
        "wires": [
            [
                "ba625f0a2884086f"
            ]
        ]
    },
    {
        "id": "38e6abc57df32ea5",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 500,
        "wires": [
            [
                "57eab72566b9bcfa"
            ]
        ]
    },
    {
        "id": "d2af0fe4b93aaa87",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 420,
        "wires": [
            [
                "2b012dd5dfe6d0a2"
            ]
        ]
    },
    {
        "id": "9a1e0f74f6c5ca96",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 180,
        "wires": [
            [
                "449152afee8fd53d"
            ]
        ]
    },
    {
        "id": "cc49164a5862d9d1",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 600,
        "wires": [
            [
                "69cb8adb9866a3f2"
            ]
        ]
    },
    {
        "id": "aae2689535ac5a8a",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 640,
        "wires": [
            [
                "92fe0c477a059e70"
            ]
        ]
    },
    {
        "id": "263aea25bf49f2dc",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 680,
        "wires": [
            [
                "11a00e1f7817d6da"
            ]
        ]
    },
    {
        "id": "3a49ae333d7de364",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 340,
        "wires": [
            [
                "8e9cb7076e47e1d3"
            ]
        ]
    },
    {
        "id": "132011d15f020671",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly, test2",
        "mode": "link",
        "links": [
            "f7c7a691f7a8a8aa"
        ],
        "x": 3795,
        "y": 560,
        "wires": []
    },
    {
        "id": "3c4b6432d93c9e94",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "gen1 Shelly 2.5",
        "func": "let d = new Date();\nlet savetopic = msg.topic;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n    let info = msg.topic.split(\"/\")[2];\n    let variable = msg.topic.split(\"/\")[4];\n    let shutter;\n\n    if (variable === \"command\") {\n        return;\n    }\n\n    if (info === \"roller\") {\n        let domoticz = flow.get(\"dz-state\") || {};\n        let idxstate = [];\n        let ID = \"idx \" + msg.payload.domoticz.idx\n        let dev = domoticz[ID] || {};\n        let length = Object.keys(domoticz).length;\n        let save = msg.payload;\n\n        for (let i = 0; i < length; i++) {\n            let keys = Object.keys(domoticz);\n            let IDkey = keys[i];\n            let dev = domoticz[IDkey] || {};\n            if (IDkey === ID) {\n                shutter = dev.shutter;\n            }\n        }\n\n        //Position\n        if (variable === \"pos\") {\n            dev.lasttime = d.getTime();\n            dev.offline = msg.payload.domoticz.offline;\n            dev.name = msg.payload.domoticz.name;\n            if (dev.online === false) {\n                let bot = flow.get(\"bot\") || {};\n                let chatid = flow.get(\"chatid\") || {};\n\n                node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n\n                let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n                msg.payload = '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online';\n                node.send([null, msg]);\n            }\n            dev.online = true;\n\n            if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n                msg.payload = null;\n            } else {\n                dev.shutter = msg.payload.output;\n                if (shutter === dev.shutter) {\n                    msg = null;\n                } else {\n                    msg = {\n                        topic: \"domoticz/in\",\n                        payload:\n                        {\n                            command: \"switchlight\",\n                            idx: Number(msg.payload.domoticz.idx),\n                            switchcmd: \"Set Level\",\n                            level: msg.payload.output\n                        }\n                    }\n                }\n            }\n           \n        //Store stop_reason\n        } else if (variable === \"stop_reason\") {\n            if (msg.payload.output === \"normal\") {\n                dev.state = \"stop\"\n                msg = null;\n            } else {\n                msg = null;\n            }\n        } else {\n            msg = null;\n        }\n        domoticz[ID] = dev;\n        idxstate.push(dev);\n\n        flow.set(\"dz-state\", domoticz);\n        return msg;\n        \n    }\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n    let shelly = flow.get(\"dz-state\") || {};\n    let idxshellystate = [];\n    let IDidx = \"idx \" + msg.payload.domoticz.idx\n    let dev = shelly[IDidx] || {};\n\n    if (msg.payload.domoticz.addon === \"shellies\") {\n      return;\n    } else {\n        if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n            if (dev.shutter === msg.payload.Level) {\n                return;\n            } else{\n                if (msg.payload.hasOwnProperty(\"Level\")) {\n                    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n                    msg.payload = msg.payload.Level;\n                } else if (msg.payload.nvalue == 1) {\n                    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n                    msg.payload = \"on\";\n                } else if (msg.payload.nvalue == 0) {\n                    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n                    msg.payload = \"off\";\n                }\n            }\n        }\n    }\n    dev.shutter = String(msg.payload);\n\n    shelly[IDidx] = dev;\n    idxshellystate.push(dev);\n\n    flow.set(\"dz-state\", shelly);\n    return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 840,
        "wires": [
            [
                "28a98f0293c4a02d",
                "0c8b6e0ac4103dbd",
                "155c8d497f7d9280"
            ]
        ]
    },
    {
        "id": "44a388f260ca3882",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 relay 1 On",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 100,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "babf6eff6ef7d891",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 100,
        "wires": [
            [
                "f486312fc75ac00c"
            ]
        ]
    },
    {
        "id": "0262dd2784ddbcfb",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 relay 0 Off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 60,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "6042ae2db2da1e84",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 60,
        "wires": [
            [
                "fdc07d4f0662cef2"
            ]
        ]
    },
    {
        "id": "90a8ecc4054dd44e",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 relay 0 On",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 20,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "2773f31d434a6eb4",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 20,
        "wires": [
            [
                "f4a2d246807abe83"
            ]
        ]
    },
    {
        "id": "7d2f2990120a0f04",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Input 0 op 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 220,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "ab80d68d3d6a944b",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 220,
        "wires": [
            [
                "aa73787e5571da02"
            ]
        ]
    },
    {
        "id": "b35faf45bd224ee1",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Input 1 op 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 260,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "0e0d04d793e3e02c",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 260,
        "wires": [
            [
                "2e150fa0b29cae75"
            ]
        ]
    },
    {
        "id": "c7e15f19bf7030e4",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Input 1 op 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2740,
        "y": 300,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "ded96736aff59c58",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 300,
        "wires": [
            [
                "2bf1b03be21a804f"
            ]
        ]
    },
    {
        "id": "7ffccaf44bcb20f0",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Power relay 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0/power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "30.88",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 460,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "965a09d91d8b542f",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 460,
        "wires": [
            [
                "d742a2b1483d44e6"
            ]
        ]
    },
    {
        "id": "125514273a8a9cdb",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 Energy relay 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0/energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "17962",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 380,
        "wires": [
            [
                "a8faf980f2c83ade"
            ]
        ]
    },
    {
        "id": "914f1f9ecdae6d1a",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2520,
        "y": 380,
        "wires": [
            [
                "164d13892c7a7fd4"
            ]
        ]
    },
    {
        "id": "5e1121d6993021d7",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4650,
        "y": 680,
        "wires": [
            [
                "52510ffad0a5ea79"
            ]
        ]
    },
    {
        "id": "91249707778a902a",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "a56e0810e773e8af",
        "name": "Shelly to MQTT server",
        "mode": "link",
        "links": [
            "a0024720d71c4146"
        ],
        "x": 165,
        "y": 340,
        "wires": []
    },
    {
        "id": "4378d6ef181b88db",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "a56e0810e773e8af",
        "name": "Shelly from MQTT server",
        "links": [
            "815c5ae767ffd619",
            "ce6f5c18fd49fbc1"
        ],
        "x": 575,
        "y": 300,
        "wires": [
            [
                "20338ca523d880b5"
            ]
        ]
    },
    {
        "id": "43f62a97c408d326",
        "type": "ui_switch",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "",
        "label": "Shelly incoming messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 5,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 340,
        "y": 1040,
        "wires": [
            [
                "75f3f1056c55d850",
                "36ab8be5e8f0707a"
            ]
        ]
    },
    {
        "id": "75f3f1056c55d850",
        "type": "gate",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 730,
        "y": 1020,
        "wires": [
            [
                "36ab8be5e8f0707a"
            ]
        ]
    },
    {
        "id": "d9227172895afaed",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "name": "Debug switch empty payload",
        "func": "if (msg.payload === true) {\n    msg.topic = \"\"\n    msg.payload = \"\"\n    msg.debug_addon = \"\"\n}\nif (msg.payload === false) {\n    msg.payload = \"\"\n    msg.topic = \"\"\n    msg.debug_addon = \"\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 2260,
        "wires": [
            [
                "b59e45861a97561a",
                "40d8b23e65efdc8a",
                "44836a96444a97eb"
            ]
        ]
    },
    {
        "id": "b59e45861a97561a",
        "type": "ui_text",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "group": "240e8c09f225dbd4",
        "order": 3,
        "width": 30,
        "height": 1,
        "name": "",
        "label": "Switch source:",
        "format": "{{msg.debug_addon}}",
        "layout": "row-left",
        "className": "",
        "x": 1100,
        "y": 2300,
        "wires": []
    },
    {
        "id": "8e08f5823218b31d",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payloadType": "str",
        "x": 570,
        "y": 2320,
        "wires": [
            [
                "b59e45861a97561a",
                "5f07089ff3b349c9",
                "40d8b23e65efdc8a",
                "44836a96444a97eb"
            ]
        ]
    },
    {
        "id": "36ab8be5e8f0707a",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "bd3511f0fcc77098"
        ],
        "x": 875,
        "y": 1020,
        "wires": []
    },
    {
        "id": "bd3511f0fcc77098",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "name": "Shelly, show messages on UI",
        "links": [
            "36ab8be5e8f0707a",
            "f00b870a2b3a4ed8",
            "87e31541d693fbc1"
        ],
        "x": 75,
        "y": 2260,
        "wires": [
            [
                "d9227172895afaed"
            ]
        ]
    },
    {
        "id": "5f07089ff3b349c9",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "name": "Set debug switch off",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2260,
        "wires": [
            [
                "c034ca6144fdbb40"
            ]
        ]
    },
    {
        "id": "c034ca6144fdbb40",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "name": "Shelly, Debug off",
        "mode": "link",
        "links": [
            "0a5006d7941a403a",
            "ed5cd1243f511e69",
            "9e0bb0c7c2e71ed0"
        ],
        "x": 1555,
        "y": 2260,
        "wires": []
    },
    {
        "id": "0a5006d7941a403a",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "c034ca6144fdbb40"
        ],
        "x": 155,
        "y": 1040,
        "wires": [
            [
                "43f62a97c408d326"
            ]
        ]
    },
    {
        "id": "40d8b23e65efdc8a",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "name": "Debug topic2payload",
        "func": "msg.payload = msg.topic\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2380,
        "wires": [
            [
                "8f177732b930b22d"
            ]
        ]
    },
    {
        "id": "8f177732b930b22d",
        "type": "ui_text",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "group": "240e8c09f225dbd4",
        "order": 1,
        "width": 30,
        "height": 1,
        "name": "",
        "label": "Topic:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1590,
        "y": 2380,
        "wires": []
    },
    {
        "id": "ed5cd1243f511e69",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "c034ca6144fdbb40"
        ],
        "x": 155,
        "y": 1120,
        "wires": [
            [
                "b0a5802a67385d44"
            ]
        ]
    },
    {
        "id": "b0a5802a67385d44",
        "type": "ui_switch",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "",
        "label": "Domoticz incoming messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 6,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 350,
        "y": 1120,
        "wires": [
            [
                "1a221eee828825e7",
                "f00b870a2b3a4ed8"
            ]
        ]
    },
    {
        "id": "1a221eee828825e7",
        "type": "gate",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1130,
        "y": 1120,
        "wires": [
            [
                "f00b870a2b3a4ed8"
            ]
        ]
    },
    {
        "id": "f00b870a2b3a4ed8",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "bd3511f0fcc77098"
        ],
        "x": 1265,
        "y": 1120,
        "wires": []
    },
    {
        "id": "9e0bb0c7c2e71ed0",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "c034ca6144fdbb40"
        ],
        "x": 2395,
        "y": 1160,
        "wires": [
            [
                "07e494c4c7171903"
            ]
        ]
    },
    {
        "id": "07e494c4c7171903",
        "type": "ui_switch",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "label": "Shelly --> MQTT messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 4,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2570,
        "y": 1160,
        "wires": [
            [
                "2976d6b0bb5edf50",
                "87e31541d693fbc1"
            ]
        ]
    },
    {
        "id": "2976d6b0bb5edf50",
        "type": "gate",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 3000,
        "y": 1160,
        "wires": [
            [
                "87e31541d693fbc1"
            ]
        ]
    },
    {
        "id": "87e31541d693fbc1",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "bd3511f0fcc77098"
        ],
        "x": 3125,
        "y": 1160,
        "wires": []
    },
    {
        "id": "0c8b6e0ac4103dbd",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "add button label",
        "func": "msg.debug_addon = \"Shelly --> MQTT messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2760,
        "y": 1100,
        "wires": [
            [
                "2976d6b0bb5edf50"
            ]
        ]
    },
    {
        "id": "1c3e2947d4526955",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "add button label",
        "func": "msg.debug_addon = \"Domoticz incoming messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 1080,
        "wires": [
            [
                "1a221eee828825e7"
            ]
        ]
    },
    {
        "id": "02f4cc8719938f57",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "add button label",
        "func": "msg.debug_addon = \"Shelly incoming messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 960,
        "wires": [
            [
                "75f3f1056c55d850"
            ]
        ]
    },
    {
        "id": "44836a96444a97eb",
        "type": "ui_text",
        "z": "92d196b8dd5edc6f",
        "g": "e71056dc0b96e27a",
        "group": "240e8c09f225dbd4",
        "order": 2,
        "width": 30,
        "height": 2,
        "name": "",
        "label": "Payload:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1080,
        "y": 2340,
        "wires": []
    },
    {
        "id": "28a98f0293c4a02d",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "gen1 shelly 2.5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2760,
        "y": 840,
        "wires": []
    },
    {
        "id": "f65704acf6dbb366",
        "type": "switch",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Contain shelly message",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "events",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "status/switch",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "shellies",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 270,
        "y": 880,
        "wires": [
            [
                "02f4cc8719938f57",
                "fea73a18ebaa3187",
                "f0d35adec97431cf"
            ],
            [
                "fea73a18ebaa3187",
                "02f4cc8719938f57"
            ],
            [
                "4adece8fc99d62a4",
                "02f4cc8719938f57"
            ]
        ]
    },
    {
        "id": "248a71a2046c98c0",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\", \"dst\":\"Pomp wensput/events\", \"method\":\"NotifyStatus\", \"params\":{\"ts\":1713549431.88, \"input:0\":{\"id\":0, \"state\": true}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 440,
        "wires": [
            [
                "9bb3bc39f64448cf"
            ]
        ]
    },
    {
        "id": "2f30059452c23f07",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1PM ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1840,
        "y": 440,
        "wires": [
            [
                "248a71a2046c98c0"
            ]
        ]
    },
    {
        "id": "8f51e32b5a47a5f8",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1710,
        "y": 560,
        "wires": [
            [
                "cc84ffe8774363d4"
            ]
        ]
    },
    {
        "id": "7243ef8d351879e9",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\", \"dst\":\"Pomp wensput/events\", \"method\":\"NotifyStatus\", \"params\":{\"ts\":1713549431.88, \"input:0\":{\"id\":0, \"state\": false}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 480,
        "wires": [
            [
                "9bb3bc39f64448cf"
            ]
        ]
    },
    {
        "id": "1b946a73dfa7972c",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1PM OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1840,
        "y": 480,
        "wires": [
            [
                "7243ef8d351879e9"
            ]
        ]
    },
    {
        "id": "92db4a9a4876ba9c",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "gen3 shelly 1pm",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2760,
        "y": 920,
        "wires": []
    },
    {
        "id": "e068fa12497d183f",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 2480,
        "wires": [
            [
                "31fa01bc1ec2c935"
            ]
        ]
    },
    {
        "id": "c5378ba20d331918",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Debug flow.get",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 2520,
        "wires": []
    },
    {
        "id": "6c994ce1dd5db210",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Set flow.get test",
        "func": "let store =  msg.payload;\nflow.set(\"sh2dz-idx\", store);\nreturn [{payload:Object.values(store)}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 2480,
        "wires": [
            [
                "8d90f2f1ab00542c"
            ]
        ]
    },
    {
        "id": "31fa01bc1ec2c935",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Payload2Object",
        "func": "let store = msg.payload;\nlet msg2 = Object.assign({}, store);\nreturn [{payload:(msg2)}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 2480,
        "wires": [
            [
                "d6ea666edecc5841"
            ]
        ]
    },
    {
        "id": "d6ea666edecc5841",
        "type": "split",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 950,
        "y": 2480,
        "wires": [
            [
                "84b44f7ca04cc0f4"
            ]
        ]
    },
    {
        "id": "84b44f7ca04cc0f4",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "shelly2topic",
        "func": "let value = msg.payload.name\nmsg.topic = value;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 2480,
        "wires": [
            [
                "fea93a4a8223583a"
            ]
        ]
    },
    {
        "id": "fea93a4a8223583a",
        "type": "join",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1290,
        "y": 2480,
        "wires": [
            [
                "c5378ba20d331918",
                "6c994ce1dd5db210",
                "1765e2e6f41aca11"
            ]
        ]
    },
    {
        "id": "8d90f2f1ab00542c",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Shelly, Restore idx table (read file)",
        "mode": "link",
        "links": [
            "3d10c70462eca2b6"
        ],
        "x": 1625,
        "y": 2480,
        "wires": []
    },
    {
        "id": "c64ab87a306fe49e",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Get save location",
        "func": "delete msg.payload;\nlet destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 2480,
        "wires": [
            [
                "fbcf69ec97b52fb1"
            ]
        ]
    },
    {
        "id": "b997dae4a8bdff50",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Shelly, start UI",
        "links": [
            "e68df47c80fe8e65"
        ],
        "x": 75,
        "y": 2480,
        "wires": [
            [
                "c64ab87a306fe49e"
            ]
        ]
    },
    {
        "id": "fbcf69ec97b52fb1",
        "type": "file in",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "Read backup",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 410,
        "y": 2480,
        "wires": [
            [
                "e068fa12497d183f"
            ]
        ]
    },
    {
        "id": "1765e2e6f41aca11",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "fc8b35056f0e509b",
        "name": "set idx filter",
        "func": "let filter = [];\nlet length = Object.keys(msg.payload).length;\n\nfor (var devN in msg.payload) {\n    let devInfo = msg.payload[devN];\n    if (devInfo.type === \"Shelly Plug S\") {\n        if (devInfo.idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(devInfo.idx)\n        }\n    } else if (devInfo.type === \"Shelly 2.5 shutter mode\") {\n        if (devInfo.idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(devInfo.idx);\n        }\n        if (devInfo.idxoption1 === \"Not set\") {\n            null;\n        } else if (devInfo.idxoption1 === \"N/A\") {\n            null;\n        } else {\n            filter.push(devInfo.idxoption1)\n        }\n    } else if (devInfo.type === \"Shelly Plus Plug S\") {\n        if (devInfo.idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(devInfo.idx)\n        }\n    } else if (devInfo.type === \"Shelly 1pm mini\") {\n        if (devInfo.idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(devInfo.idx)\n        }\n        if (devInfo.idxoption1 === \"Not set\") {\n            null;\n        } else if (devInfo.idxoption1 === \"N/A\") {\n            null;\n        } else {\n            filter.push(devInfo.idxoption1)\n        }\n    } else if (devInfo.type === \"Shelly pro 2PM\") {\n        if (devInfo.idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(devInfo.idx)\n        }\n        if (devInfo.idxoption4 === \"Not set\") {\n            null;\n        } else if (devInfo.idxoption4 === \"N/A\") {\n            null;\n        } else {\n            filter.push(devInfo.idxoption4)\n        }\n    }\n}\n\nflow.set(\"dz-idx-filter\", filter);\nflow.set(\"dz-state\", {})\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 2520,
        "wires": [
            []
        ]
    },
    {
        "id": "42bc96a8b4b5522f",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\",\"dst\":\"Pomp wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1713556420.54,\"switch:0\":{\"id\":0,\"output\":true,\"source\":\"SHC\",\"timer_duration\":5,\"timer_started_at\":1713556420.54}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 60,
        "wires": [
            [
                "9bb3bc39f64448cf"
            ]
        ]
    },
    {
        "id": "e90d3aa2a9937164",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1PM switch ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1760,
        "y": 60,
        "wires": [
            [
                "42bc96a8b4b5522f"
            ]
        ]
    },
    {
        "id": "5856930d283d33aa",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\",\"dst\":\"Pomp wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1713556420.54,\"switch:0\":{\"id\":0,\"output\":false,\"source\":\"SHC\",\"timer_duration\":5,\"timer_started_at\":1713556420.54}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 100,
        "wires": [
            [
                "9bb3bc39f64448cf"
            ]
        ]
    },
    {
        "id": "603caf27c93c6848",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1PM switch OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1760,
        "y": 100,
        "wires": [
            [
                "5856930d283d33aa"
            ]
        ]
    },
    {
        "id": "ef25ad17b1968ba9",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "gen1 Shelly 2.5",
        "func": "let d = new Date();\nlet energy, energy0, energy1, power, power0, power1, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n  let info = msg.topic.split(\"/\")[2];\n  let relaynr = msg.topic.split(\"/\")[3];\n  let variable = msg.topic.split(\"/\")[4];\n  let input0, input1, output0, output1, shutter;\n\n  if (variable === \"command\") {\n    return;\n  }\n\n  if (info === \"roller\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n      if (IDkey === ID) {\n        shutter = dev.shutter;\n      }\n    }\n\n    //energy output\n    if (variable === \"energy\") {\n      if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n        msg = null\n        energy = null\n      } else {\n        msg = null\n        energy = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(save.domoticz.idxoption5),\n            svalue: save.output + \"\\\";\\\"\" + 0,\n          }\n        }\n      }\n\n      //power output\n    } else if (variable === \"power\") {\n      if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n        msg = null\n        power = null\n      } else {\n        msg = null\n        power = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(save.domoticz.idxoption7),\n            svalue: save.output.toString(),\n          }\n        }\n      }\n\n      //Position\n    } else if (variable === \"pos\") {\n      if (dev.state === \"stop\") {\n        dev.lasttime = d.getTime();\n        dev.offline = msg.payload.domoticz.offline;\n        dev.online = true;\n\n        if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n          msg.payload = null;\n        } else {\n          dev.shutter = msg.payload.output;\n          if (shutter === dev.shutter) {\n            msg = null;\n          } else {\n            msg = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"switchlight\",\n                idx: Number(msg.payload.domoticz.idx),\n                switchcmd: \"Set Level\",\n                level: msg.payload.output\n              }\n            }\n          }\n        }\n      } else {\n        msg = null;\n      }\n\n      //Store stop_reason\n    } else if (variable === \"stop_reason\") {\n      if (msg.payload.output === \"normal\") {\n        dev.state = \"stop\"\n        msg = null;\n      } else {\n        msg = null;\n      }\n\n\n    } else {\n      if (msg.payload.output === \"stop\") {\n        if (Number(msg.payload.domoticz.idxoption5) === 0 || msg.payload.domoticz.idxoption5 === undefined || msg.payload.domoticz.idxoption5 === \"N/A\" || msg.payload.domoticz.idxoption5 === \"Not set\") {\n          energy = null;\n        } else {\n          energy = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption5),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(msg.payload.domoticz.idxoption7) === 0 || msg.payload.domoticz.idxoption7 === undefined || msg.payload.domoticz.idxoption7 === \"N/A\" || msg.payload.domoticz.idxoption7 === \"Not set\") {\n          power = null;\n        } else {\n          power = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption7),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n      msg = null;\n    }\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy, power, voltage, current, total]];\n  }\n\n  if (info === \"relay\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input0 = dev.input0;\n        input1 = dev.input1;\n        output0 = dev.output0;\n        output1 = dev.output1;\n      }\n    }\n\n    //Output\n    if (Number(relaynr) === 0) {\n      let val0;\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg.payload = null;\n      } else {\n        if (msg.payload.output === \"on\") {\n          dev.output0 = true;\n          val0 = 1;\n        } else if (msg.payload.output === \"off\") {\n          dev.output0 = false;\n          val0 = 0;\n        }\n        if (output0 == dev.output0) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: val0,\n            }\n          }\n        }\n      }\n    } else if (Number(relaynr) === 1) {\n      let val1;\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === \"on\") {\n          dev.output1 = true;\n          val1 = 1;\n        } else if (msg.payload.output === \"off\") {\n          dev.output1 = false;\n          val1 = 0;\n        }\n        if (output1 == dev.output1) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption1),\n              nvalue: val1,\n            }\n          }\n        }\n      }\n    }\n\n    //power output 0\n    if (dev.output0 === true && (Number(relaynr) === 0)) {\n      if (info === \"relay\") {\n        if (variable === \"energy\") {\n          if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n            energy0 = null\n          } else {\n            energy0 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption5),\n                svalue: save.output + \"\\\";\\\"\" + 0,\n              }\n            }\n          }\n        }\n        if (variable === \"power\") {\n          if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n            power0 = null\n          } else {\n            power0 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption7),\n                svalue: save.output.toString(),\n              }\n            }\n          }\n        }\n      }\n    } else if (dev.output0 === false) {\n      if (output0 == dev.output0) {\n        energy0 = null;\n      } else {\n        if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n          energy0 = null\n        } else {\n          energy0 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption5),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n          power0 = null\n        } else {\n          power0 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption7),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    //power output 1\n    if (dev.output1 === true && (Number(relaynr) === 1)) {\n      if (info === \"relay\") {\n        if (variable === \"energy\") {\n          if (Number(save.domoticz.idxoption6) === 0 || save.domoticz.idxoption6 === undefined || save.domoticz.idxoption6 === \"N/A\" || save.domoticz.idxoption6 === \"Not set\") {\n            energy1 = null\n          } else {\n            energy1 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption6),\n                svalue: save.output + \"\\\";\\\"\" + 0,\n              }\n            }\n          }\n        }\n        if (variable === \"power\") {\n          if (Number(save.domoticz.idxoption8) === 0 || save.domoticz.idxoption8 === undefined || save.domoticz.idxoption8 === \"N/A\" || save.domoticz.idxoption8 === \"Not set\") {\n            power1 = null\n          } else {\n            power1 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption8),\n                svalue: save.output.toString(),\n              }\n            }\n          }\n        }\n      }\n    } else if (dev.output1 === false) {\n      if (output1 == dev.output1) {\n        energy1 = null;\n      } else {\n        if (Number(save.domoticz.idxoption6) === 0 || save.domoticz.idxoption6 === undefined || save.domoticz.idxoption6 === \"N/A\" || save.domoticz.idxoption6 === \"Not set\") {\n          energy1 = null\n        } else {\n          energy1 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption6),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(save.domoticz.idxoption8) === 0 || save.domoticz.idxoption8 === undefined || save.domoticz.idxoption8 === \"N/A\" || save.domoticz.idxoption8 === \"Not set\") {\n          power1 = null\n        } else {\n          power1 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption8),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n\n  if (info === \"input\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input0 = dev.input0;\n        input1 = dev.input1;\n      }\n    }\n\n    //Input\n    if (Number(relaynr) === 0) {\n      let val0;\n      if (Number(msg.payload.domoticz.idxoption2) === 0 || msg.payload.domoticz.idxoption2 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === 1) {\n          dev.input0 = true;\n        } else if (msg.payload.output === 0) {\n          dev.input0 = false;\n        }\n        if (input0 == dev.input0) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption2),\n              nvalue: msg.payload.output,\n            }\n          }\n        }\n      }\n    } else if (Number(relaynr) === 1) {\n      if (Number(msg.payload.domoticz.idxoption3) === 0 || msg.payload.domoticz.idxoption3 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === 1) {\n          dev.input1 = true;\n        } else if (msg.payload.output === 0) {\n          dev.input1 = false;\n        }\n        if (input1 == dev.input1) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption3),\n              nvalue: msg.payload.output,\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n\n  if (info === \"voltage\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n    }\n\n    //Voltage\n    if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined) {\n      msg = null\n    } else {\n      msg = {\n        topic: \"domoticz/in\",\n        payload:\n        {\n          command: \"udevice\",\n          idx: Number(msg.payload.domoticz.idxoption4),\n          svalue: msg.payload.output,\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx \" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.addon === \"shellies\") {\n    if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n      msg.topic = msg.payload.domoticz.name + \"/relay/0/command\";\n      if (msg.payload.nvalue == 1) {\n        msg.payload = \"on\";\n        dev.output0 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.payload = \"off\";\n        dev.output0 = false;\n      }\n    } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption1)) {\n      msg.topic = msg.payload.domoticz.name + \"/relay/1/command\";\n      if (msg.payload.nvalue == 1) {\n        msg.payload = \"on\";\n        dev.output1 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.payload = \"off\";\n        dev.output1 = false;\n      }\n    }\n  } else {\n    if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n      if (msg.payload.hasOwnProperty(\"Level\")) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n        msg.payload = msg.payload.Level\n        dev.state = \"moving\"\n      } else if (msg.payload.nvalue == 1) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n        msg.payload = \"on\";\n        dev.output0 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n        msg.payload = \"off\";\n        dev.output0 = false;\n      }\n    } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption1)) {\n      if (msg.payload.hasOwnProperty(\"Level\")) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n        msg.payload = msg.payload.Level;\n        dev.state = \"moving\";\n      } else if (msg.payload.nvalue == 1) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/1/command\";\n        msg.payload = \"on\";\n        dev.output1 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/1/command\";\n        msg.payload = \"off\";\n        dev.output1 = false;\n      }\n    }\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "8a8623e5bff1f0d2",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly command",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 780,
        "wires": []
    },
    {
        "id": "cbc87b5b74d88b6d",
        "type": "switch",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Contain shelly command",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "command",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 800,
        "wires": [
            [
                "8a8623e5bff1f0d2"
            ],
            [
                "f65704acf6dbb366"
            ]
        ]
    },
    {
        "id": "cd93615c6a6bc7f3",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1pm gen3 status output true",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/status/switch:0 ",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"apower\":0,\"current\":0,\"output\":true,\"source\":\"timer\",\"timer_duration\":null,\"timer_started_at\":null}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 360,
        "wires": [
            [
                "9bb3bc39f64448cf"
            ]
        ]
    },
    {
        "id": "bba6830beffa1e0e",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1PM status",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1770,
        "y": 360,
        "wires": [
            [
                "cd93615c6a6bc7f3"
            ]
        ]
    },
    {
        "id": "ef3690cac435b780",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1pm gen3 status output false",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/status/switch:0 ",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"apower\":0,\"current\":0,\"output\":false,\"source\":\"timer\",\"timer_duration\":null,\"timer_started_at\":null}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 400,
        "wires": [
            [
                "9bb3bc39f64448cf"
            ]
        ]
    },
    {
        "id": "c23338147fccefc2",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 1PM status",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1770,
        "y": 400,
        "wires": [
            [
                "ef3690cac435b780"
            ]
        ]
    },
    {
        "id": "62d1839a1fb06581",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "gen2 Shelly pro 2PM",
        "func": "let d = new Date();\nlet apower, voltage, current, total, idx, idxPower, idxVoltage, idxCurrent, idxMaster, output, ID, switchnr, telegrammessage;\n\nif (msg.payload.script.source === \"Shelly_gen2-3\") {\n    let info = msg.topic.split(\"/\")[1];\n    let switchinfo = msg.topic.split(\"/\")[2];\n    let sw_id = msg.topic.split(\":\")[1];\n    \n    if (info === \"events\") {\n      let domoticz = flow.get(\"dz-state\") || {};\n\n      if (msg.payload.params.hasOwnProperty(\"switch:0\")) {\n        ID = \"idx:\" + msg.payload.domoticz.idx;\n        idx = msg.payload.domoticz.idx;\n        idxPower = msg.payload.domoticz.idxoption1;\n        idxVoltage = msg.payload.domoticz.idxoption2;\n        idxCurrent = msg.payload.domoticz.idxoption3;\n        switchnr = \"switch:0\";\n        idxMaster = true;\n      } else if (msg.payload.params.hasOwnProperty(\"switch:1\")) {\n        ID = \"idx:\" + msg.payload.domoticz.idxoption4;\n        idx = msg.payload.domoticz.idxoption4;\n        idxPower = msg.payload.domoticz.idxoption5;\n        idxVoltage = msg.payload.domoticz.idxoption6;\n        idxCurrent = msg.payload.domoticz.idxoption7;\n        switchnr = \"switch:1\";\n        idxMaster = false;\n      }\n\n      //apower\n      if (msg.payload.params[switchnr].hasOwnProperty(\"apower\")) {\n        if (Number(idxPower) === 0 || idxPower === undefined || idxPower === \"N/A\" || idxPower === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(idxPower),\n              svalue: msg.payload.params[switchnr].apower.toString(),\n            }\n          }\n        }\n      } else {\n        apower = null;\n      }\n\n      //voltage\n      if (msg.payload.params[switchnr].hasOwnProperty(\"voltage\")) {\n        if (Number(idxVoltage) === 0 || idxVoltage === undefined || idxVoltage === \"N/A\" || idxVoltage === \"Not set\") {\n          voltage = null;\n        } else {\n          voltage = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(idxVoltage),\n              svalue: msg.payload.params[switchnr].voltage.toString(),\n            }\n          }\n        }\n      } else {\n        voltage = null;\n      }\n\n      //current\n      if (msg.payload.params[switchnr].hasOwnProperty(\"current\")) {\n        if (Number(idxCurrent) === 0 || idxCurrent === undefined || idxCurrent === \"N/A\" || idxCurrent === \"Not set\") {\n          current = null;\n        } else {\n          current = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(idxCurrent),\n              svalue: msg.payload.params[switchnr].current.toString(),\n            }\n          }\n        }\n      } else {\n        current = null;\n      }\n\n      let dev = domoticz[ID] || {};\n//      let length = Object.keys(domoticz).length;\n\n      dev.lasttime = d.getTime();\n      dev.offline = msg.payload.domoticz.offline;\n      dev.name = msg.payload.domoticz.name;\n      dev.device = \"Shelly pro 2PM\";\n      dev.master = idxMaster;\n      if (dev.online === false) {\n        let bot = flow.get(\"bot\") || 0;\n        let chatid = flow.get(\"chatid\") || 0;\n\n        node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n        \n        if ((bot !== 0) && (chatid !== 0)) {\n          let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n          telegrammessage = { \"topic\": \"\", \"payload\": '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online' };\n          node.send([[null], [telegrammessage]])    \n        }\n      }\n      dev.online = true;\n\n      domoticz[ID] = dev;\n\n      flow.set(\"dz-state\", domoticz);\n      return [[apower, voltage, current], null];\n    }\n     \n    if (info === \"status\") {\n      let domoticz = flow.get(\"dz-state\") || {};\n      let idxstate = [];\n      \n      if ((switchinfo === \"switch:0\") || (switchinfo === \"switch:1\")) {\n        if (sw_id === \"0\") {\n          ID = \"idx:\" + msg.payload.domoticz.idx;\n          idx = msg.payload.domoticz.idx;\n          idxPower = msg.payload.domoticz.idxoption1;\n          idxVoltage = msg.payload.domoticz.idxoption2;\n          idxCurrent = msg.payload.domoticz.idxoption3;\n          idxMaster = true;\n        } else if (sw_id === \"1\") {\n          ID = \"idx:\" + msg.payload.domoticz.idxoption4;\n          idx = msg.payload.domoticz.idxoption4;\n          idxPower = msg.payload.domoticz.idxoption5;\n          idxVoltage = msg.payload.domoticz.idxoption6;\n          idxCurrent = msg.payload.domoticz.idxoption7;\n          idxMaster = false;\n        }\n\n        let dev = domoticz[ID] || {};\n        let length = Object.keys(domoticz).length;\n\n        dev.lasttime = d.getTime();\n        dev.offline = msg.payload.domoticz.offline;\n        dev.name = msg.payload.domoticz.name;\n        dev.device = \"Shelly pro 2PM\"\n        dev.master = idxMaster;\n        if (dev.online === false) {\n          let bot = flow.get(\"bot\") || 0;\n          let chatid = flow.get(\"chatid\") || 0;\n\n          node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n        \n          if ((bot !== 0) && (chatid !== 0)) {\n            let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n            telegrammessage = { \"topic\": \"\", \"payload\": '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online' };\n            node.send([[null], [telegrammessage]])    \n         }\n        }\n        dev.online = true;\n\n        for (let i = 0; i < length; i++) {\n          let keys = Object.keys(domoticz);\n          let IDkey = keys[i];\n          let dev = domoticz[IDkey] || {};\n\n          if (IDkey === ID) {\n            output = dev.output;\n          }\n        }\n\n        //apower\n        if (msg.payload.hasOwnProperty(\"apower\")) {\n          if (Number(idxPower) === 0 || idxPower === undefined || idxPower === \"N/A\" || idxPower === \"Not set\") {\n            apower = null;\n          } else {\n            apower = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(idxPower),\n                svalue: msg.payload.apower.toString(),\n              } \n            }\n          }\n        } else {\n          apower = null;\n        }\n\n        //voltage\n        if (msg.payload.hasOwnProperty(\"voltage\")) {\n          if (Number(idxVoltage) === 0 || idxVoltage === undefined || idxVoltage === \"N/A\" || idxVoltage === \"Not set\") {\n            voltage = null;\n          } else {\n            voltage = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(idxVoltage),\n                svalue: msg.payload.voltage.toString(),\n              }\n            }\n          }\n        } else {\n          voltage = null;\n        }\n  \n        //current\n        if (msg.payload.hasOwnProperty(\"current\")) {\n          if (Number(idxCurrent) === 0 || idxCurrent === undefined || idxCurrent === \"N/A\" || idxCurrent === \"Not set\") {\n            current = null;\n          } else {\n            current = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(idxCurrent),\n                svalue: msg.payload.current.toString(),\n              }\n            }\n          }\n        } else {\n          current = null;\n        }\n  \n        //total\n        //if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined || msg.payload.domoticz.idxoption4 === \"N/A\" || msg.payload.domoticz.idxoption4 === \"Not set\") {\n        //  total = null;\n        //} else {\n        //  total = {\n        //    topic: \"domoticz/in\",\n        //    payload:\n        //    {\n        //      command: \"udevice\",\n        //      idx: Number(msg.payload.domoticz.idxoption4),\n        //     nvalue: 0,\n        //      svalue: msg.payload.aenergy.total + \"\\\";\\\"\" + 0,\n        //    }\n        //  }\n        //}\n  \n        //Output\n        if (Number(idx) === 0 || idx === undefined || idx === \"Not set\") {\n          msg = null\n        } else {\n          if (output === msg.payload.output) {\n            return;\n          } else {\n            dev.output = msg.payload.output\n            let val = msg.payload.output == true ? 1 : 0;\n            msg = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(idx),\n                nvalue: val,\n              }\n            }\n          }\n        domoticz[ID] = dev;\n        idxstate.push(dev);\n\n        flow.set(\"dz-state\", domoticz);\n        return [[msg, apower, voltage, current, total], null];\n      }\n    }\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx, dev;\n\n  if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n    msg.topic = msg.payload.domoticz.name + \"/command/switch:0\";\n    IDidx = \"idx:\" + msg.payload.domoticz.idx;\n    dev = shelly[IDidx] || {};\n  } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption4)) {\n    msg.topic = msg.payload.domoticz.name + \"/command/switch:1\";\n    IDidx = \"idx:\" + msg.payload.domoticz.idxoption4;\n    dev = shelly[IDidx] || {};\n  }\n\n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return [msg, null]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2480,
        "y": 960,
        "wires": [
            [
                "ba879db7f3788299",
                "155c8d497f7d9280",
                "0c8b6e0ac4103dbd"
            ],
            [
                "144028cd07e14cc0"
            ]
        ]
    },
    {
        "id": "ba879db7f3788299",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "gen2 shelly pro 2pm",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2780,
        "y": 960,
        "wires": []
    },
    {
        "id": "e6474be0a232f24a",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "wensput/status/switch:1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":1,\"source\":\"mqtt\",\"output\":true,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 140,
        "wires": [
            [
                "8f51e32b5a47a5f8"
            ]
        ]
    },
    {
        "id": "8e2deb4e4def7e8e",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM relay2 ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1110,
        "y": 140,
        "wires": [
            [
                "e6474be0a232f24a"
            ]
        ]
    },
    {
        "id": "9a77464678506995",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "wensput/status/switch:1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":1,\"source\":\"mqtt\",\"output\":false,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 180,
        "wires": [
            [
                "8f51e32b5a47a5f8"
            ]
        ]
    },
    {
        "id": "6962d71187fd765e",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM relay2 OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1110,
        "y": 180,
        "wires": [
            [
                "9a77464678506995"
            ]
        ]
    },
    {
        "id": "c4ba08c40df43b5f",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "wensput/status/switch:0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"source\":\"mqtt\",\"output\":true,\"apower\":1,\"voltage\":2,\"current\":3,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 60,
        "wires": [
            [
                "8f51e32b5a47a5f8"
            ]
        ]
    },
    {
        "id": "491afa89106fad5b",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM relay1 ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1110,
        "y": 60,
        "wires": [
            [
                "c4ba08c40df43b5f"
            ]
        ]
    },
    {
        "id": "1477840011ed5807",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "wensput/status/switch:0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"source\":\"mqtt\",\"output\":false,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 100,
        "wires": [
            [
                "8f51e32b5a47a5f8"
            ]
        ]
    },
    {
        "id": "7f83ca8cdadaef27",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM relay1 OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1110,
        "y": 100,
        "wires": [
            [
                "1477840011ed5807"
            ]
        ]
    },
    {
        "id": "b179283e080d8798",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "Heartbeat check",
        "func": "let d = new Date();\nlet idx; \n\nif (msg.payload.script.source === \"Heartbeat\") {\n    let heartbeat = flow.get(\"dz-state\") || {};\n    let length = Object.keys(heartbeat).length;\n    for (let i = 0; i < length; i++) {\n\n        let keys = Object.keys(heartbeat);\n        let IDkey = keys[i];\n        let dev = heartbeat[IDkey] || {};\n        if (dev.master === true) {\n            if (dev.offline === \"Not set\" || dev.offline === \"Disable\" || dev.offline === \"N/A\") {\n                return;\n                node.warn(\"There is a device which has no heartbeat set or disabled\")\n            } else {\n                if (d.getTime() - dev.lasttime > (dev.offline * 1000)) {\n                    if (dev.online === true) {\n                        let bot = flow.get(\"bot\") || 0;\n                        let chatid = flow.get(\"chatid\") || 0;\n\n                        node.warn(\"Shelly device is offline: \" + dev.name);\n                        dev.online = false\n                        heartbeat[IDkey] = dev;\n                        flow.set(\"dz-state\", heartbeat);\n                    \n                        if ((bot !== 0) && (chatid !== 0)) {\n                            let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n                            msg.payload = '' + telegram + 'Shelly device: ' + dev.name + ' is offline';\n                            node.send(msg, null);\n                        }\n                    }\n                } else if (d.getTime() - dev.lasttime > ((dev.offline * 1000) / 2 )) {\n                    //node.warn(\"2min reminder\")\n                    if (dev.device === \"Shelly 1pm mini\") {\n                        //node.warn(\"status update\")\n                        msg.topic = dev.name + \"/command\";\n                        //msg.topic = dev.device + \"/command\";\n                        msg.payload = \"status_update\"\n                        node.send([null, msg]);\n                    } \n                }\n            }\n        }\n    }\n    return;\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 720,
        "wires": [
            [
                "144028cd07e14cc0"
            ],
            [
                "155c8d497f7d9280"
            ]
        ]
    },
    {
        "id": "2d5dcb4304a0901a",
        "type": "link out",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "SZ2D, Restore telegram (read file)",
        "mode": "link",
        "links": [
            "21850dcc45e2382d",
            "0eadbde0bc90c9c8"
        ],
        "x": 1625,
        "y": 3100,
        "wires": []
    },
    {
        "id": "f897010fb19eecc9",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Get save location",
        "func": "delete msg.payload;\nlet destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/telegram-bot-credentials.txt\";\n\nlet version = flow.get(\"NoderedVersion\");\nlet array = version.split(\".\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 3060,
        "wires": [
            [
                "cf994b3878b086ab"
            ]
        ]
    },
    {
        "id": "24b8247762331bc4",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Shelly, start UI",
        "links": [
            "e68df47c80fe8e65"
        ],
        "x": 75,
        "y": 3100,
        "wires": [
            [
                "f897010fb19eecc9",
                "4ee5d0c3b24afb48"
            ]
        ]
    },
    {
        "id": "cf994b3878b086ab",
        "type": "file in",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Read telegram",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 520,
        "y": 3060,
        "wires": [
            [
                "8059f74a1505fd2d"
            ]
        ]
    },
    {
        "id": "6aba90f378f86134",
        "type": "file in",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Read telegram",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 520,
        "y": 3140,
        "wires": [
            [
                "2ddd3e5049ca712a"
            ]
        ]
    },
    {
        "id": "4ee5d0c3b24afb48",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Get save location",
        "func": "delete msg.payload;\nlet destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/telegram-chatid-credentials.txt\";\n\nlet version = flow.get(\"NoderedVersion\");\nlet array = version.split(\".\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 3140,
        "wires": [
            [
                "6aba90f378f86134"
            ]
        ]
    },
    {
        "id": "8059f74a1505fd2d",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Set Device settings",
        "func": "flow.set(\"bot\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 3060,
        "wires": [
            [
                "11baf83766458e57"
            ]
        ]
    },
    {
        "id": "2ddd3e5049ca712a",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "Set Device settings",
        "func": "flow.set(\"chatid\", msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 3140,
        "wires": [
            [
                "d0bde3c507cbec9f"
            ]
        ]
    },
    {
        "id": "11baf83766458e57",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "parts.index = 0",
        "rules": [
            {
                "t": "set",
                "p": "parts.index",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 3060,
        "wires": [
            [
                "65b7fc994ed8a9d5"
            ]
        ]
    },
    {
        "id": "d0bde3c507cbec9f",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "parts.index = 1",
        "rules": [
            {
                "t": "set",
                "p": "parts.index",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 3140,
        "wires": [
            [
                "65b7fc994ed8a9d5"
            ]
        ]
    },
    {
        "id": "65b7fc994ed8a9d5",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "group id and count",
        "rules": [
            {
                "t": "set",
                "p": "parts.id",
                "pt": "msg",
                "to": "mygroup",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "parts.count",
                "pt": "msg",
                "to": "2",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 3100,
        "wires": [
            [
                "1aa46d9667bcf55b"
            ]
        ]
    },
    {
        "id": "1aa46d9667bcf55b",
        "type": "join",
        "z": "92d196b8dd5edc6f",
        "g": "1b078b4e3cb34041",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1490,
        "y": 3100,
        "wires": [
            [
                "2d5dcb4304a0901a"
            ]
        ]
    },
    {
        "id": "ee14456093c642ae",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Get saved telegram info",
        "func": "delete msg.payload;\nlet bot = flow.get(\"bot\");\nlet chatid = flow.get(\"chatid\");\nlet setbot;\nlet setchatid\n\nif (bot === undefined) {\n    setbot = { topic: \"bot\", payload: 'Not defined' };\n} else {\n    setbot = { topic: \"bot\", payload: bot};\n}\n\nif (chatid === undefined) {\n    setchatid = { topic: \"chatid\", payload: 'Not defined' };\n} else {\n    setchatid = { topic: \"chatid\", payload: chatid };\n}\n\nreturn [setbot, setchatid];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 3280,
        "wires": [
            [
                "63f0dd7b943e2d88",
                "8df879b0f01694f6"
            ],
            [
                "cbf354f448d7609e",
                "8df879b0f01694f6"
            ]
        ]
    },
    {
        "id": "21850dcc45e2382d",
        "type": "link in",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Shelly, set telegram after deploy",
        "links": [
            "2d5dcb4304a0901a"
        ],
        "x": 75,
        "y": 3280,
        "wires": [
            [
                "ee14456093c642ae"
            ]
        ]
    },
    {
        "id": "63f0dd7b943e2d88",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "",
        "label": "Telegram BOT credentials",
        "tooltip": "",
        "group": "39ab554c802973bb",
        "order": 1,
        "width": "10",
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "bot",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 650,
        "y": 3240,
        "wires": [
            [
                "8df879b0f01694f6"
            ]
        ]
    },
    {
        "id": "cbf354f448d7609e",
        "type": "ui_text_input",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "",
        "label": "Telegram Chat ID credentials",
        "tooltip": "",
        "group": "39ab554c802973bb",
        "order": 2,
        "width": "10",
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "chatid",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 660,
        "y": 3320,
        "wires": [
            [
                "8df879b0f01694f6"
            ]
        ]
    },
    {
        "id": "8df879b0f01694f6",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Set Device settings",
        "func": "let data1 = context.get(\"data1\") || null; //get from context or default to 0\nlet data2 = context.get(\"data2\") || 0; //get from context or default to 0\n\n//var reconfig = flow.get(\"T2Zidx\") || {};\n\nswitch (msg.topic){\n\n    case \"bot\":\n        data1 = msg.payload; \n        context.set(\"data1\", data1);//store in context for next time \n        return;\n    \n    case \"chatid\":\n        data2 = msg.payload; \n        context.set(\"data2\", data2);//store in context for next time \n        return;\n            \n    case \"submit\":\n        if (data1 !== null ) {\n            if (data2 !== null) {\n                flow.set(\"bot\", data1);\n                flow.set(\"chatid\", data2);\n                let datasend1 = { payload: data1 };\n                let datasend2 = { payload: data2 };\n                context.set(\"data1\", null)\n                context.set(\"data2\", null)\n                return [datasend1, datasend2];\n            } else {\n                return;\n            }\n        } else {\n            return;\n        }\n    }",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 3280,
        "wires": [
            [
                "3be3c709f83c4a7c"
            ],
            [
                "8cd52e02a5b87194",
                "aaf1c3f5f04444e8"
            ]
        ]
    },
    {
        "id": "05c29c01d7a525f2",
        "type": "ui_button",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "",
        "group": "39ab554c802973bb",
        "order": 4,
        "width": "10",
        "height": 1,
        "passthru": false,
        "label": "Save telegram settings",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 640,
        "y": 3360,
        "wires": [
            [
                "8df879b0f01694f6"
            ]
        ]
    },
    {
        "id": "3be3c709f83c4a7c",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/telegram-bot-credentials.txt\";\nlet version = flow.get(\"NoderedVersion\");\nlet array = version.split(\".\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 3260,
        "wires": [
            [
                "7856886803b859f9"
            ]
        ]
    },
    {
        "id": "7856886803b859f9",
        "type": "file",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 3260,
        "wires": [
            []
        ]
    },
    {
        "id": "8cd52e02a5b87194",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/telegram-chatid-credentials.txt\";\nlet version = flow.get(\"NoderedVersion\");\nlet array = version.split(\".\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 3300,
        "wires": [
            [
                "956b8bc8609a7849"
            ]
        ]
    },
    {
        "id": "956b8bc8609a7849",
        "type": "file",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 3300,
        "wires": [
            []
        ]
    },
    {
        "id": "144028cd07e14cc0",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2750,
        "y": 720,
        "wires": [
            [
                "ba374ef64705c27c"
            ]
        ]
    },
    {
        "id": "ba374ef64705c27c",
        "type": "http request",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 2930,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "f21e4ee1e436e445",
        "type": "ui_toast",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "position": "top left",
        "displayTime": "5",
        "highlight": "",
        "sendall": false,
        "outputs": 0,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1330,
        "y": 3360,
        "wires": []
    },
    {
        "id": "aaf1c3f5f04444e8",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "f9c91086607bc42e",
        "name": "Store notification",
        "func": "delete msg.payload;\nmsg.topic = \"Telegram settings\";\nmsg.payload = \"Settings are saved.\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 3360,
        "wires": [
            [
                "f21e4ee1e436e445"
            ]
        ]
    },
    {
        "id": "f55bb2ebc67d5fe3",
        "type": "comment",
        "z": "92d196b8dd5edc6f",
        "name": "Old release notes",
        "info": "<b>V1 07-05-2024 R1: </b><br>\n- Add switching improvement Shelly 1pm mini <br>\n<b>V1 21-04-2024 R2: </b><br>\n- Bug: issues with status gen3 to switch gen 2 <br>\n<b>V1 21-04-2024 R1: </b><br>\n- New device added \"Shelly 1pm mini\" (only switch functions, not power reading)<br>\n<b>V1 03-02-2024 R1 beta: </b><br>\n- Bug: switch number was not stored in data-file <br>\n<b>V1 28-05-2023 R1 beta: </b><br>\n<p style=\"color:red\">unfortunately, by adding shelly 2.5, saving configuration has had to change <br> \nAs a result, the configuration of the older version cannot be read and the configuration will have to be redone </p>\n- New device added \"Shelly 2.5\" (only as relay/input module, not as shutter module (work in progress)) <br>\n<b>V1 26-05-2023 R1 beta: </b><br>\n- New device added \"Shelly Plug S\" <br>\n- When select device with a known config, the config is written in setup-nodes <br>\n- Announce message are stopped in the flow <br>\n<b>V1 24-05-2023 R1 beta: </b><br>\n- \"Show discovered shellies\" button added. To prevent that pull-down setup menu's clear itself <br>\n  &nbsp&nbsp&nbsp&nbsp It is not a network discovery option. The shelly first needs to send a message, before it will be added <br>\n- Not (yet) supported option added. To already add those devices to the config <br>\n<b>V1 18-05-2023 R1 beta: </b><br>\n- The first release of the shelly flow <br>\n- Only device \"Shelly Plus Plug S\" is available <br>\n<b>V1 14-11-2025 R1 beta: </b><br>\n- New device added \"Shelly pro 2PM\" (only switch functions, not input readings, still beta release)<br>\n<b>V1 15-11-2025 R1 beta: </b><br>\n- Change: Device heartbeat code refactored, only availble for \"Shelly pro 2PM\"<br>\n- Added: Telegram, for sending messages when device is offline<br>",
        "x": 120,
        "y": 420,
        "wires": []
    },
    {
        "id": "f3862902b5c2ee87",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM event switch0",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1100,
        "y": 220,
        "wires": [
            [
                "a9d5e260cc325ce9"
            ]
        ]
    },
    {
        "id": "a9d5e260cc325ce9",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shellypro2pm-ec5260a009f4\",\"dst\":\"shellypro2pm-Wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1763300820, \"switch:0\":{\"apower\":58,\"current\":12,\"voltage\":237}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 220,
        "wires": [
            [
                "8f51e32b5a47a5f8"
            ]
        ]
    },
    {
        "id": "9bb3bc39f64448cf",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 2350,
        "y": 540,
        "wires": [
            [
                "cc84ffe8774363d4"
            ]
        ]
    },
    {
        "id": "099ff7e1f775674c",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM event switch1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1100,
        "y": 260,
        "wires": [
            [
                "158f657db0c1bf32"
            ]
        ]
    },
    {
        "id": "158f657db0c1bf32",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly pro 2PM",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shellypro2pm-ec5260a009f4\",\"dst\":\"shellypro2pm-Wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1763300820, \"switch:1\":{\"apower\":85,\"current\":21,\"voltage\":327}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 260,
        "wires": [
            [
                "8f51e32b5a47a5f8"
            ]
        ]
    },
    {
        "id": "68ca6aabf39d31c4",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "g": "53310d80315438e7",
        "name": "set idx filter",
        "func": "let filter = [];\nlet array = msg.payload || {};\nlet length = Object.keys(array).length;\n\nfor (var i = 0; i < length; i++) {\n    if (msg.payload[i].type === \"Shelly Plug S\") {\n        if (msg.payload[i].idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idx)\n        }\n    } else if (msg.payload[i].type === \"Shelly 2.5 shutter mode\") {\n        if (msg.payload[i].idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idx)\n        }\n        if (msg.payload[i].idxoption1 === \"Not set\") {\n            null;\n        } else if (msg.payload[i].idxoption1 === \"N/A\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idxoption1)\n        }\n    } else if (msg.payload[i].type === \"Shelly Plus Plug S\") {\n        if (msg.payload[i].idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idx)\n        }\n    } else if (msg.payload[i].type === \"Shelly 1pm mini\") {\n        if (msg.payload[i].idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idx)\n        }\n        if (msg.payload[i].idxoption1 === \"Not set\") {\n            null;\n        } else if (msg.payload[i].idxoption1 === \"N/A\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idxoption1)\n        }\n    } else if (msg.payload[i].type === \"Shelly pro 2PM\") {\n        if (msg.payload[i].idx === \"Not set\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idx)\n        }\n        if (msg.payload[i].idxoption4 === \"Not set\") {\n            null;\n        } else if (msg.payload[i].idxoption4 === \"N/A\") {\n            null;\n        } else {\n            filter.push(msg.payload[i].idxoption4)\n        }\n    }\n}\n\nflow.set(\"dz-idx-filter\", filter);\nflow.set(\"dz-state\",{})\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "aa3999ab16b5478d",
        "type": "json",
        "z": "92d196b8dd5edc6f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 3650,
        "y": 540,
        "wires": [
            [
                "695a28cecce03922"
            ]
        ]
    },
    {
        "id": "0c437c18e7161830",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 share position 95",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyswitch25-68C63AF96C39/roller/0/pos",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "95",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3360,
        "y": 120,
        "wires": [
            [
                "aa3999ab16b5478d"
            ]
        ]
    },
    {
        "id": "4680fbaa58306416",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 share position",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3090,
        "y": 120,
        "wires": [
            [
                "0c437c18e7161830"
            ]
        ]
    },
    {
        "id": "e1b469270a5c05ef",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 share position 90",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyswitch25-68C63AF96C39/roller/0/pos",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "90",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3360,
        "y": 160,
        "wires": [
            [
                "aa3999ab16b5478d"
            ]
        ]
    },
    {
        "id": "f8fa6b3a6e0cc90a",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly 2.5 share position",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3090,
        "y": 160,
        "wires": [
            [
                "e1b469270a5c05ef"
            ]
        ]
    },
    {
        "id": "3d7937c1b3f73e00",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly plus plug",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Drink fontein/status/switch:0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"source\":\"mqtt\",\"output\":true,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3400,
        "y": 220,
        "wires": [
            [
                "aa3999ab16b5478d"
            ]
        ]
    },
    {
        "id": "bf71af71830ccd97",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly plus plug ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3150,
        "y": 220,
        "wires": [
            [
                "3d7937c1b3f73e00"
            ]
        ]
    },
    {
        "id": "d57a614b103119c1",
        "type": "change",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly plus plug",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Drink fontein/status/switch:0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"source\":\"mqtt\",\"output\":false,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3400,
        "y": 260,
        "wires": [
            [
                "aa3999ab16b5478d"
            ]
        ]
    },
    {
        "id": "e7633f34ebf3a2d4",
        "type": "inject",
        "z": "92d196b8dd5edc6f",
        "name": "Shelly plus plug OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3150,
        "y": 260,
        "wires": [
            [
                "d57a614b103119c1"
            ]
        ]
    },
    {
        "id": "35e16416965daf36",
        "type": "function",
        "z": "92d196b8dd5edc6f",
        "name": "gen3 Shelly 1PM mini",
        "func": "let d = new Date();\n\nif (msg.payload.script.source === \"Shelly_gen2-3\") {\n  let info = msg.topic.split(\"/\")[1];\n  let input, output;\n  \n  if (info === \"events\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID, dev, telegrammessage, idxMaster;\n    let length = Object.keys(domoticz).length;\n\n    if ((Object.keys(msg.payload[\"params\"])[1]) === \"input:0\") {\n      if (msg.payload.domoticz.idxoption1 === \"Not set\") {\n        return;\n      }\n      ID = \"idx:\" + msg.payload.domoticz.idxoption1;\n      idxMaster = false;\n    } else if ((Object.keys(msg.payload[\"params\"])[1]) === \"switch:0\") {\n      if (msg.payload.domoticz.idx === \"Not set\") {\n        return;\n      }\n      if (msg.payload.params[\"switch:0\"].hasOwnProperty(\"output\")) {\n        ID = \"idx:\" + msg.payload.domoticz.idx;\n        idxMaster = true;\n      }\n    } else {\n      return;\n    }\n\n    dev = domoticz[ID] || {};\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n\n      if (IDkey === ID) {\n        if ((Object.keys(msg.payload[\"params\"])[1]) === \"input:0\") {\n          input = dev.input;\n        } else if ((Object.keys(msg.payload[\"params\"])[1]) === \"switch:0\") {\n          output = dev.output;\n        }\n      }\n    }\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.name = msg.payload.domoticz.name;\n    dev.device = \"Shelly 1pm mini\"\n    dev.master = idxMaster;\n\n    if (dev.online === false) {\n      let bot = flow.get(\"bot\") || 0;\n      let chatid = flow.get(\"chatid\") || 0;\n\n      node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n      \n      if ((bot !== 0) && (chatid !== 0)) {\n        let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n        telegrammessage = { \"topic\": \"\", \"payload\": '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online' };  \n        node.send([[null], [telegrammessage]])    \n      }\n    } else {\n      telegrammessage = null;\n    }\n    dev.online = true;\n\n    //Input\n    if ((Object.keys(msg.payload[\"params\"])[1]) === \"input:0\"){\n      let value, state;\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.params[\"input:0\"].state === true) {\n          dev.input = true;\n          value = 1;\n          state = \"On\"\n        } else if (msg.payload.params[\"input:0\"].state === false) {\n          dev.input = false;\n          value = 0;\n          state = \"Off\"\n        }\n        if (input == dev.input) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption1),\n              nvalue: value,\n              svalue1: state\n            }\n          }\n        }\n      }\n    \n   \n    //Output\n    } else if ((Object.keys(msg.payload[\"params\"])[1]) === \"switch:0\") {\n      let value, state;\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.params[\"switch:0\"].output === true) {\n          if (msg.payload.params[\"switch:0\"].output === dev.output) {\n            return;\n          } else {\n            dev.output = true;\n            value = 1;\n            state = \"On\"\n          }\n        } else if (msg.payload.params[\"switch:0\"].output === false) {\n          if (msg.payload.params[\"switch:0\"].output === dev.output) {\n            return;\n          } else {\n            dev.output = false;\n            value = 0;\n            state = \"Off\"\n          }\n        }\n        msg = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idx),\n            nvalue: value,\n            svalue1: state\n          }\n        }\n      }\n    } else {\n      return;\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [msg, null];\n  } else if (info === \"status\") {\n\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID, dev, telegrammessage;\n    let length = Object.keys(domoticz).length;\n\n    ID = \"idx:\" + msg.payload.domoticz.idx;\n    dev = domoticz[ID] || {};\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      output = dev.output;\n    }\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.name = msg.payload.domoticz.name;\n    dev.device = \"Shelly 1pm mini\"\n    dev.master = true;\n\n    if (dev.online === false) {\n      let bot = flow.get(\"bot\") || 0;\n      let chatid = flow.get(\"chatid\") || 0;\n\n      node.warn(\"Shelly device if back online: \" + msg.payload.domoticz.name)\n\n      if ((bot !== 0) && (chatid !== 0)) {\n        let telegram = 'https://api.telegram.org/bot' + bot + '/sendMessage?chat_id=' + chatid + '&text=';\n        telegrammessage = { \"topic\": \"\", \"payload\": '' + telegram + 'Shelly device: ' + msg.payload.domoticz.name + ' is back online' };\n        node.send([[null], [telegrammessage]])    \n      }\n    }\n    dev.online = true;\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  //msg.topic = msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  msg.topic = msg.payload.domoticz.name + \"/command/switch:0\";\n  \n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  delete msg.source;\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  if (msg.topic === \"domoticz/out\") {\n    return;\n  } else {\n    return [msg, null];\n  }\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2480,
        "y": 920,
        "wires": [
            [
                "0c8b6e0ac4103dbd",
                "92db4a9a4876ba9c",
                "155c8d497f7d9280"
            ],
            [
                "144028cd07e14cc0"
            ]
        ]
    },
    {
        "id": "f0d35adec97431cf",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "g": "1d20c4592ce17a6c",
        "name": "Shelly message",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 820,
        "wires": []
    },
    {
        "id": "8fa664fb5c4558f2",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "Raw data gen1 Shelly Plug S",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2000,
        "y": 780,
        "wires": []
    },
    {
        "id": "81fc4311ae3cbdfc",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "Raw data gen1 Shelly 2.5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1990,
        "y": 820,
        "wires": []
    },
    {
        "id": "2a246aa1569e9bd4",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "Raw data gen2 Shelly Plus Plug S",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2020,
        "y": 860,
        "wires": []
    },
    {
        "id": "95edc9c75a937f1b",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "Raw data gen3 Shelly 1PM mini",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 900,
        "wires": []
    },
    {
        "id": "1413d3a57a7c415a",
        "type": "debug",
        "z": "92d196b8dd5edc6f",
        "name": "Raw data gen2 Shelly pro 2PM",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 940,
        "wires": []
    },
    {
        "id": "b6e6fa8f868e6d45",
        "type": "ui_spacer",
        "z": "92d196b8dd5edc6f",
        "name": "spacer",
        "group": "240e8c09f225dbd4",
        "order": 7,
        "width": 9,
        "height": 1
    },
    {
        "id": "8b0b1c62d0a392d2",
        "type": "mqtt-broker",
        "name": "",
        "broker": "192.168.178.14",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "d823ccdecb8e433a",
        "type": "ui_group",
        "name": "shelly update",
        "tab": "e3edb57efc8062a5",
        "order": 2,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "53b94e9a48b9cb3e",
        "type": "ui_group",
        "name": "Version number",
        "tab": "e3edb57efc8062a5",
        "order": 1,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ecbbb13f9bc2e1f2",
        "type": "ui_group",
        "name": "Github",
        "tab": "e3edb57efc8062a5",
        "order": 8,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5d07dbcaa2c15860",
        "type": "ui_group",
        "name": "status table",
        "tab": "e3edb57efc8062a5",
        "order": 4,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e151206531f4336f",
        "type": "ui_group",
        "name": "Idx table",
        "tab": "e3edb57efc8062a5",
        "order": 3,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "61d922efb8a113fa",
        "type": "ui_group",
        "name": "URL",
        "tab": "e3edb57efc8062a5",
        "order": 6,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "240e8c09f225dbd4",
        "type": "ui_group",
        "name": "Debug messages",
        "tab": "e3edb57efc8062a5",
        "order": 7,
        "disp": true,
        "width": 30,
        "collapse": false,
        "className": ""
    },
    {
        "id": "39ab554c802973bb",
        "type": "ui_group",
        "name": "Telegram (for device offline messages)",
        "tab": "e3edb57efc8062a5",
        "order": 5,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e3edb57efc8062a5",
        "type": "ui_tab",
        "name": "Shelly devices",
        "icon": "dashboard",
        "order": 3,
        "disabled": false,
        "hidden": false
    }
]
