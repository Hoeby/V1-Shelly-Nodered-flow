[
    {
        "id": "8bb526423a678cca",
        "type": "tab",
        "label": "V1 Shelly2Domoticz",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8b58851243a79e8e",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Receive shelly messages",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "ede2e147e77eabe6",
            "f090de3ff98c8810",
            "859285add8efe4a2",
            "61a23399b873f581",
            "d9a0b4db22f9b490",
            "14d33512c46bf3e9",
            "8b5f14603e8bc4ac",
            "7a82467c9059a7fa",
            "bbfef6795d6bf08f",
            "4e037c5f7744176f",
            "bf76ce94069d98de",
            "2356776172fa8761",
            "53fb22e45bd76c8a",
            "849f4abb82f1904e",
            "96f9f00e4c3dd4c6",
            "944e25a1280811f0",
            "106dd4dc7fcf24bc",
            "2777813b9aacdb66",
            "def1e08c580b35e3",
            "a28a45244ad2c324",
            "3d8a114e98fb8dcf",
            "002debc73d158869",
            "4405d33910cebb0b"
        ],
        "x": 34,
        "y": 739,
        "w": 1632,
        "h": 422
    },
    {
        "id": "0e9f6298736d65c4",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Central MQTT settings",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "2c18d8eceafe3f5a",
            "a1f4274021966266",
            "9553d6d2c20220e3",
            "85fdfac0f41f20d6",
            "1127a4f28075c812",
            "3cdffdceb4a7ab65"
        ],
        "x": 34,
        "y": 259,
        "w": 672,
        "h": 122
    },
    {
        "id": "d6889c294e5c1e67",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Central save file location",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "27bb16cf174b3277",
            "1c3017b3788fdef6",
            "358b8f6fc0fb4498",
            "460663c5e47674e2",
            "714ec8a7c660d63a",
            "277aa716aed80df5"
        ],
        "x": 34,
        "y": 119,
        "w": 432,
        "h": 122
    },
    {
        "id": "8439365cf3da8cab",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Download knop flows.json",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "395ba6a8bbc19655",
            "3821829d9f5c2de8",
            "624d109dd0d2c3d4",
            "83b27bc8c137aa1f",
            "e1ee3eb64fc348ec",
            "9cd418bc07c8de86",
            "a6fe2b419618c9ec",
            "8a8dbf94a3fd760c",
            "55337fa0c3d81df5",
            "ec166a5bba3518a3",
            "ef3fe1e77ef8fcbf",
            "6fe8bd61f4ef801a"
        ],
        "x": 34,
        "y": 2579,
        "w": 1632,
        "h": 122
    },
    {
        "id": "388f0f0e58e3f691",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Save file location",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "0c2cd5e6fc149464",
            "4faa439c1f5b054c",
            "4d6a6f543af16fc9",
            "61db6b58ec4fdf0c",
            "d716488ee1673c2b",
            "ccbd26bc83101075",
            "f1fba9c3d69d60a5",
            "4b2177f50156b543",
            "a57560cb78853f2a",
            "ca8b830118f00a87",
            "eeb0461989e33fa8",
            "04277b719579dcba",
            "a30f7a3bbb601990",
            "dbd2bd831a80ae4a",
            "1de8a7396bcde6a6",
            "7d8f827b93603aa4",
            "76c6c8ff75a3eb9c",
            "dbec6ea2402cee00"
        ],
        "x": 34,
        "y": 2719,
        "w": 1632,
        "h": 282
    },
    {
        "id": "b1efebefe4ba16c4",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Shelly status list",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "8b8f6f64d69f5d35",
            "7bb5aefceb71333e",
            "056a0759e4695110",
            "72a9089502408e90",
            "3538923ca32e73d1",
            "7421f9ac32df3ada",
            "21e5af0af9bbabca",
            "3ae2f58cdac3360a",
            "d57b30dfb5489a9d"
        ],
        "x": 34,
        "y": 2079,
        "w": 1632,
        "h": 122
    },
    {
        "id": "af671eefa098b860",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Shelly IDX table",
        "style": {
            "stroke": "#3f93cf",
            "label": true
        },
        "nodes": [
            "e704bc763f2d9730",
            "47c028065b8e619c",
            "b17df7dc68f8c9fb",
            "6fa873396269ac3d",
            "22789251357ade40",
            "4b9aeb60fe455655",
            "d1714a4cf325537d",
            "5eb6fe2ab8a42e4c",
            "3d039318d843c54c",
            "6620e620c86ecdfe",
            "95081cdef9f1d15d",
            "ae0770ae9e6a1df1",
            "c6c7cc872688fdca",
            "9ffb30200aa322fc",
            "fb4120cadd1f93da",
            "52d0b2732d74762d"
        ],
        "x": 34,
        "y": 1179,
        "w": 1632,
        "h": 202
    },
    {
        "id": "fbcb9861d6847b33",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Flow update nodes",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "14a53f4673e00fcd",
            "468dbdc63697814a",
            "3cc5ceef3a2bf52e",
            "da0aaa5ca184aace",
            "0d86368352ab511b",
            "fd49266055ccfa59",
            "e6bf18b3612157c8",
            "e94a5e88644c4a83",
            "374f020ae654c6d2",
            "6dd8366433136ea1",
            "b8f081148f78f13e",
            "5711026a82557c1f"
        ],
        "x": 34,
        "y": 439,
        "w": 752,
        "h": 262
    },
    {
        "id": "277baa548611193e",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "IDX shelly tabel",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "fe2e561d181efb9a",
            "107df705426ea170",
            "0265efcc212e0658",
            "9d0c2e25a12525c3",
            "7ed80bc4d1d1befe",
            "57305f4f3cace6c9",
            "37c98da5574d1f2d",
            "bea4c2da64154c9f",
            "1cc96017040251be",
            "579ebae7ced6c74b",
            "06e1b7aabb2f03b5",
            "22df1ba2343faff0",
            "89eeb1701cf3357f",
            "193606ae91cb6945",
            "666be2451fc99703",
            "8fba84446159dd35",
            "17589e2bba035dc5",
            "f6a3dba03f3790cb",
            "b114998cf9670520",
            "327e75bfa7bab97b",
            "3b066fbbda51ec9a",
            "bd6f3e43f7b9a3d0",
            "c9b7df9a4f724658",
            "be19b012024f9cda",
            "95d336bc9a027740",
            "88332fce42200e46",
            "f73fcf44abf3ad74",
            "7f3f4e68412e5f9a",
            "68a9c43e4cd47f8a",
            "8ae89b198eaf3384",
            "9b3b3d9295118404"
        ],
        "x": 34,
        "y": 1399,
        "w": 1632,
        "h": 662
    },
    {
        "id": "77fac4f8715c0b54",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "shelly plug s",
        "style": {
            "label": true
        },
        "nodes": [
            "f6c5301e6e25a3e2",
            "547b9b4ad5ada17d",
            "95d316d13e06c821",
            "376885f1d4903572",
            "791591278c96bb68",
            "c1c56806c42494b0"
        ],
        "x": 4134,
        "y": 599,
        "w": 452,
        "h": 162
    },
    {
        "id": "12ca6caf6ef01fc9",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Shelly plus plug s",
        "style": {
            "label": true
        },
        "nodes": [
            "cbb9c616862bca7c",
            "e17d9d84336480b7",
            "dcde98ad6a019d3b",
            "b87b4a698271e8ec",
            "e8fef75ce53dd743",
            "d51a0b3aefd1570a",
            "9643762012c8de07",
            "e925d723525f6446",
            "14e6e1953b8d8ce4",
            "1f239b701fc739fe",
            "1a50aa77c9390bce",
            "8331a0eb539bc510",
            "ab74ed56344248e5",
            "f47d57cb95a8b5f2",
            "a6a0ef966b21d3ba",
            "390a04387e47951e",
            "a69fa0a83846d2b9"
        ],
        "x": 4014,
        "y": 219,
        "w": 732,
        "h": 362
    },
    {
        "id": "fbb5adaf13346c8a",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Debug field",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "952096682259fa64",
            "e21d6b70d15c104e",
            "844b778512545fe0",
            "5180eae08fc53811",
            "5aaccf324d310e13",
            "fa0acbd6bf1f9e48",
            "4430cdc08221619e",
            "6c9be1bc275168ed",
            "ec9642e584862d07"
        ],
        "x": 34,
        "y": 2219,
        "w": 1632,
        "h": 202
    },
    {
        "id": "085be1b91cdd3f1b",
        "type": "group",
        "z": "8bb526423a678cca",
        "name": "Set flow.get(tztest) na deploy",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "b7f073b9eec08170",
            "a246587d211a29f6",
            "855e86cd3590bb86",
            "1e04fb25dcd23555",
            "9d8d58f47fa94da0",
            "f4d73432594f661a",
            "b06f27ca0cd6f9b0",
            "12f54806a8630b40",
            "2144c7794dc71175",
            "f6178536c8704c1a",
            "3119bcf6189c3819",
            "58d4a3586587bac8"
        ],
        "x": 34,
        "y": 2439,
        "w": 1632,
        "h": 122
    },
    {
        "id": "8967d573a12b79d3",
        "type": "comment",
        "z": "8bb526423a678cca",
        "name": "V1_21-04-2024_R2",
        "info": "<b>V1 21-04-2024 R2: </b><br>\n- Bug: issues with status gen3 to switch gen 2 <br>\n<b>V1 21-04-2024 R1: </b><br>\n- New device added \"Shelly 1pm mini\" (only switch functions, not power reading)<br>\n<b>V1 03-02-2024 R1 beta: </b><br>\n- Bug: switch number was not stored in data-file <br>\n<b>V1 28-05-2023 R1 beta: </b><br>\n<p style=\"color:red\">unfortunately, by adding shelly 2.5, saving configuration has had to change <br> \nAs a result, the configuration of the older version cannot be read and the configuration will have to be redone </p>\n- New device added \"Shelly 2.5\" (only as relay/input module, not as shutter module (work in progress)) <br>\n<b>V1 26-05-2023 R1 beta: </b><br>\n- New device added \"Shelly Plug S\" <br>\n- When select device with a known config, the config is written in setup-nodes <br>\n- Announce message are stopped in the flow <br>\n<b>V1 24-05-2023 R1 beta: </b><br>\n- \"Show discovered shellies\" button added. To prevent that pull-down setup menu's clear itself <br>\n  &nbsp&nbsp&nbsp&nbsp It is not a network discovery option. The shelly first needs to send a message, before it will be added <br>\n- Not (yet) supported option added. To already add those devices to the config <br>\n<b>V1 18-05-2023 R1 beta: </b><br>\n- The first release of the shelly flow <br>\n- Only device \"Shelly Plus Plug S\" is available <br>",
        "x": 110,
        "y": 40,
        "wires": []
    },
    {
        "id": "395ba6a8bbc19655",
        "type": "http in",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "url": "/shellyflow.json",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 2660,
        "wires": [
            [
                "624d109dd0d2c3d4"
            ]
        ]
    },
    {
        "id": "3821829d9f5c2de8",
        "type": "http response",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 770,
        "y": 2660,
        "wires": []
    },
    {
        "id": "624d109dd0d2c3d4",
        "type": "http request",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "body",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/flows.json",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 350,
        "y": 2660,
        "wires": [
            [
                "9cd418bc07c8de86"
            ]
        ]
    },
    {
        "id": "83b27bc8c137aa1f",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 2620,
        "wires": [
            [
                "e1ee3eb64fc348ec"
            ]
        ]
    },
    {
        "id": "e1ee3eb64fc348ec",
        "type": "http request",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/version",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 310,
        "y": 2620,
        "wires": [
            [
                "6fe8bd61f4ef801a"
            ]
        ]
    },
    {
        "id": "14a53f4673e00fcd",
        "type": "comment",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Wat aanpassen bij een nieuwe release",
        "info": "- De \"comment\" node van de release notes.\n- Node \"UPDATE RELEASE\", de versie in aanpassen.\n- Node \"SCRIPT VERSION\", de versie in aanpassen.\n- Op github de \"version\" file aanpassen.\n- Op github de \"releasenotes\" file aanpassen.",
        "x": 210,
        "y": 580,
        "wires": []
    },
    {
        "id": "9cd418bc07c8de86",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "Make http header",
        "func": "let store = flow.get(\"version\")\nmsg.headers['Content-Disposition'] = 'attachment; filename=\"Shelly-' + store + '.json\"'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 2660,
        "wires": [
            [
                "3821829d9f5c2de8"
            ]
        ]
    },
    {
        "id": "8a8dbf94a3fd760c",
        "type": "http request",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/releasenotes",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1090,
        "y": 2620,
        "wires": [
            [
                "ec166a5bba3518a3"
            ]
        ]
    },
    {
        "id": "ec166a5bba3518a3",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "Check response github",
        "func": "if (msg.statusCode === 200 || 201) {\n    return msg;\n} else {\n    msg.payload = '<p style=\"color:red;\">Error loading release notes from github</p><br><a href=\"https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/releasenotes\" target=\"_blank\">Hyperlink to github, for the release notes</a>'\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 2620,
        "wires": [
            [
                "55337fa0c3d81df5"
            ]
        ]
    },
    {
        "id": "468dbdc63697814a",
        "type": "comment",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Welke modules installeren voor deze flow",
        "info": "Via manage pallette, onderstaande modules toevoegen\n- node-red-dashboard\n- node-red-node-ui-table",
        "x": 220,
        "y": 620,
        "wires": []
    },
    {
        "id": "ede2e147e77eabe6",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly, MQTT ",
        "links": [
            "a1f4274021966266",
            "aa89d16778a4f77e",
            "b8d149035da9a846",
            "d0bc25e5421e0c7f"
        ],
        "x": 75,
        "y": 860,
        "wires": [
            [
                "859285add8efe4a2",
                "4405d33910cebb0b"
            ]
        ]
    },
    {
        "id": "2c18d8eceafe3f5a",
        "type": "mqtt in",
        "z": "8bb526423a678cca",
        "g": "0e9f6298736d65c4",
        "name": "Messages from MQTT-server",
        "topic": "#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6ffe1b28d49f4ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 360,
        "y": 340,
        "wires": [
            [
                "a1f4274021966266"
            ]
        ]
    },
    {
        "id": "a1f4274021966266",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "0e9f6298736d65c4",
        "name": "Shelly, Central MQTT-IN",
        "mode": "link",
        "links": [
            "ede2e147e77eabe6"
        ],
        "x": 665,
        "y": 320,
        "wires": []
    },
    {
        "id": "9553d6d2c20220e3",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "0e9f6298736d65c4",
        "name": "Shelly, Messages to MQTT-server",
        "links": [
            "0ac0e432f8c14166"
        ],
        "x": 75,
        "y": 320,
        "wires": [
            [
                "85fdfac0f41f20d6",
                "1127a4f28075c812"
            ]
        ]
    },
    {
        "id": "85fdfac0f41f20d6",
        "type": "mqtt out",
        "z": "8bb526423a678cca",
        "g": "0e9f6298736d65c4",
        "name": "Messages to MQTT-server",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "e6ffe1b28d49f4ed",
        "x": 360,
        "y": 300,
        "wires": []
    },
    {
        "id": "f090de3ff98c8810",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly, Shelly received message",
        "mode": "link",
        "links": [
            "21e5af0af9bbabca",
            "e704bc763f2d9730",
            "6a776ed98fa7d55f"
        ],
        "x": 1435,
        "y": 900,
        "wires": []
    },
    {
        "id": "a6fe2b419618c9ec",
        "type": "ui_button",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "",
        "group": "d823ccdecb8e433a",
        "order": 1,
        "width": 30,
        "height": 1,
        "passthru": false,
        "label": "{{text}}",
        "tooltip": "",
        "color": "white",
        "bgcolor": "{{background}}",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "show",
        "topicType": "str",
        "x": 890,
        "y": 2620,
        "wires": [
            [
                "8a8dbf94a3fd760c"
            ]
        ]
    },
    {
        "id": "3cc5ceef3a2bf52e",
        "type": "ui_text",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "group": "53b94e9a48b9cb3e",
        "order": 1,
        "width": 30,
        "height": 2,
        "name": "Top text info tab",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 680,
        "y": 500,
        "wires": []
    },
    {
        "id": "55337fa0c3d81df5",
        "type": "ui_template",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "group": "ecbbb13f9bc2e1f2",
        "name": "",
        "order": 1,
        "width": 30,
        "height": 1,
        "format": "<div ng-init=\"init()\" id=\"pin_insert\" class=\"dialog\">\n    \n    <div class=\"dialog_content\">\n        \n        <div class=\"dialog_header\">\n            <h2 style=\"margin:10px\">Release notes</h2>\n        </div>\n        \n        <div class=\"dialog_body\">\n            <div ng-bind-html=\"msg.payload\" style=\"height:400px;width:100%;margin: 4px 2px;overflow:auto;\"></div>\n            <!--<div ng-bind-html=\"msg.payload\"></div>-->\n            <form action=\"/shellyflow.json\" method=\"get\"><input type=\"submit\" class=\"buttons\" value=\"Download\" name=\"Submit\" id=\"frm1_submit\"/></form>\n            <button class=\"buttoncl\" id=\"myCls\" ng-click=\"closeDialog()\">Close</button>\n        </div> \n    </div> \n</div> \n\n<style>\n\n/* The Dialog (background) */\n.dialog {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index: 9999; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    color : rgb(255,255,255);\n\tbackground-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n    -webkit-transform: translateZ(0px);\n    -webkit-transform: translate3d(0,0,0);\n    -webkit-perspective: 1000;\n}\n\n.dialog_content {\n\tposition: absolute;\n    background-color: rgb(51,51,51);\n    left: 25%;\n    top: 30px;\n    border-radius: 3px;\n    padding: 0;\n    width: 50%;\n    /*height: 70%;*/\n    height: 550px;\n    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);\n    -webkit-animation-name: animatetop;\n    animation-name: animatetop;\n    animation-duration: 0.4s;\n}\n\n/* Dialog Header */\n.dialog_header {\n    padding: 2px 16px;\n    background-color: rgb(20,117,120);\n    border-radius: 3px 3px 0 0;\n    color: white;\n}\n\n/* Dialog Body */\n.dialog_body {padding: 5px;}\n\n/* The Close Button */\n.close {\n    color: #fff;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n}\n\n.close:hover,\n.close:focus {\n    color: #1565C0;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n\n.btn1 {\n  color : rgb(255,255,255);\n  background-color: rgb(20,117,120);\n  border-radius: 3px 3px 3px 3px;\n  font-size: 16px;\n}\n\n/* Button style */\n    .buttoncl {\n        position: absolute;\n        border: none;\n        /*border-radius: 2px;*/\n        padding: 15px 4.4%;\n        font-size: 16px;\n        font-weight:550;\n        font-family:arial;\n        margin: 4px 2px;\n        /*text-transform: uppercase;*/\n        display: inline-block;\n        cursor: pointer;\n        color: white;\n        background-color:  #0A8085;\n        outline: none;\n        left: 85%;\n        top: 88%;\n    } \n    \n    .buttons {\n        position: absolute;\n        background-color: #0A8085;\n        border: none;\n        color: #FFF7E0; \n        padding: 15px 4.4%;\n        text-align: center;\n        text-decoration: none;\n        display: inline-block;\n        font-size: 16px;\n        font-weight:550;\n        font-family:arial;\n        margin: 4px 2px;\n        cursor: pointer;\n        left: 65%;\n        top: 88%;\n    }\n\n</style>\n\n<script>\nvar dialog;\n\n\n/* ==== */\n(function(scope) {\n    \n    scope.passcode = \"\";\n    \n    scope.init = function() {\n        scope.send({payload : \"init\"});\n\t\tscope.passcode = \"\";\n        //Hide the md-panel\n        $('#pin_insert').parent().parent().css(\"display\", \"none\");\n        //This trick make it works on smartphones too :)\n        dialog = $('#pin_insert').detach();\n        //dialog.appendTo(document.body); // This leaves ghost numpads if pinpad is not opened!\n    }\n    \n    scope.showDialog = function() {\n        dialog.appendTo(document.body); // better to add the body only when the numpad is displayed (seams to be removed automatically)\n        dialog.css(\"display\", \"block\");\n    }\n    \n    scope.closeDialog = function(){\n        dialog.css(\"display\", \"none\");\n\t\tscope.send({payload : scope.passcode});\n    }\n     \n\n    scope.$watch('msg', function(data) {\n        if(data && data.topic){\n            switch(data.topic){\n               case \"show\":\n\t\t\t\t\t\tscope.passcode = \"\";\n                        scope.showDialog();\n                break;\n                case \"close\": \n                    dialog.css(\"display\", \"none\");\n                break;\n            }\n        }\n    });\n})(scope);\n\n</script>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1580,
        "y": 2620,
        "wires": [
            []
        ]
    },
    {
        "id": "27bb16cf174b3277",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "d6889c294e5c1e67",
        "name": "Pi file save location",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/home/pi/domoticz/plugins/shelly",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 160,
        "wires": [
            [
                "1c3017b3788fdef6"
            ]
        ]
    },
    {
        "id": "1c3017b3788fdef6",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "d6889c294e5c1e67",
        "name": "Shelly, Pi save location",
        "mode": "link",
        "links": [
            "f1fba9c3d69d60a5"
        ],
        "x": 425,
        "y": 160,
        "wires": []
    },
    {
        "id": "da0aaa5ca184aace",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "get file location",
        "func": "let location = flow.get(\"savefiledestination\")\nmsg.payload = \"<center>Data save folder: \" + location + \"</center>\"\nmsg.topic = \"Actuel version: <b>V1_18-05-2023_R1</b>\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 480,
        "wires": [
            [
                "e94a5e88644c4a83"
            ]
        ]
    },
    {
        "id": "0d86368352ab511b",
        "type": "comment",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Save data locaties",
        "info": "Native system:\n/home/pi/domoticz/plugins/shelly\n\nDocker system:\n/data/saved-files/shelly",
        "x": 150,
        "y": 660,
        "wires": []
    },
    {
        "id": "0c2cd5e6fc149464",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 850,
        "y": 2760,
        "wires": [
            [
                "dbd2bd831a80ae4a"
            ]
        ]
    },
    {
        "id": "4faa439c1f5b054c",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Get save location pi",
        "func": "let destination = msg.payload;\nmsg.filename = destination + \"/testPIdirectory\";\nflow.set(\"savefiledestination\", destination);\nmsg.delay = 5000;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 2800,
        "wires": [
            [
                "76c6c8ff75a3eb9c"
            ]
        ]
    },
    {
        "id": "4d6a6f543af16fc9",
        "type": "catch",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "",
        "scope": [
            "7ee6eacc2a5d9cd1",
            "76c6c8ff75a3eb9c"
        ],
        "uncaught": false,
        "x": 110,
        "y": 2880,
        "wires": [
            [
                "4b2177f50156b543"
            ]
        ]
    },
    {
        "id": "61db6b58ec4fdf0c",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Get save location docker",
        "func": "let destination = msg.payload;\nmsg.filename = destination + \"/testDOCKERdirectory\";\nflow.set(\"savefiledestination\", destination);\nmsg.delay = 5000;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 2880,
        "wires": [
            [
                "dbec6ea2402cee00"
            ]
        ]
    },
    {
        "id": "d716488ee1673c2b",
        "type": "catch",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "",
        "scope": [
            "082e0f0318b184c7",
            "dbec6ea2402cee00"
        ],
        "uncaught": false,
        "x": 110,
        "y": 2960,
        "wires": [
            [
                "ca8b830118f00a87"
            ]
        ]
    },
    {
        "id": "358b8f6fc0fb4498",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "d6889c294e5c1e67",
        "name": "Docker file save location",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/data/saved-files/shelly",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "460663c5e47674e2"
            ]
        ]
    },
    {
        "id": "460663c5e47674e2",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "d6889c294e5c1e67",
        "name": "Shelly, Docker save location",
        "mode": "link",
        "links": [
            "a57560cb78853f2a"
        ],
        "x": 425,
        "y": 200,
        "wires": []
    },
    {
        "id": "714ec8a7c660d63a",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "d6889c294e5c1e67",
        "name": "Shelly, Pi save location",
        "links": [
            "ccbd26bc83101075"
        ],
        "x": 75,
        "y": 160,
        "wires": [
            [
                "27bb16cf174b3277"
            ]
        ]
    },
    {
        "id": "277aa716aed80df5",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "d6889c294e5c1e67",
        "name": "Shelly, Docker save location",
        "links": [
            "4b2177f50156b543"
        ],
        "x": 75,
        "y": 200,
        "wires": [
            [
                "358b8f6fc0fb4498"
            ]
        ]
    },
    {
        "id": "ccbd26bc83101075",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Shelly, Start after deploy",
        "mode": "link",
        "links": [
            "374f020ae654c6d2",
            "714ec8a7c660d63a"
        ],
        "x": 1625,
        "y": 2760,
        "wires": []
    },
    {
        "id": "f1fba9c3d69d60a5",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Shelly, Pi data save location",
        "links": [
            "1c3017b3788fdef6"
        ],
        "x": 335,
        "y": 2800,
        "wires": [
            [
                "4faa439c1f5b054c"
            ]
        ]
    },
    {
        "id": "4b2177f50156b543",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Shelly, Get docker save location",
        "mode": "link",
        "links": [
            "277aa716aed80df5"
        ],
        "x": 265,
        "y": 2880,
        "wires": []
    },
    {
        "id": "a57560cb78853f2a",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Shelly, Docker data save location",
        "links": [
            "460663c5e47674e2"
        ],
        "x": 335,
        "y": 2880,
        "wires": [
            [
                "61db6b58ec4fdf0c",
                "04277b719579dcba"
            ]
        ]
    },
    {
        "id": "ca8b830118f00a87",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Error find directory",
        "func": "let error = \"ERROR, directory PI and DOCKER not found\"\nflow.set(\"savefiledestination\", error);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 2960,
        "wires": [
            [
                "04277b719579dcba"
            ]
        ]
    },
    {
        "id": "eeb0461989e33fa8",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Shelly, start UI",
        "mode": "link",
        "links": [
            "f6178536c8704c1a",
            "fd49266055ccfa59"
        ],
        "x": 1625,
        "y": 2960,
        "wires": []
    },
    {
        "id": "a30f7a3bbb601990",
        "type": "delay",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1460,
        "y": 2960,
        "wires": [
            [
                "eeb0461989e33fa8"
            ]
        ]
    },
    {
        "id": "04277b719579dcba",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "reset delay",
        "func": "delete msg.delay;\ndelete msg.error;\nmsg.reset = true;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 2960,
        "wires": [
            [
                "a30f7a3bbb601990"
            ]
        ]
    },
    {
        "id": "fd49266055ccfa59",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Shelly, start UI text bar",
        "links": [
            "eeb0461989e33fa8"
        ],
        "x": 75,
        "y": 480,
        "wires": [
            [
                "da0aaa5ca184aace"
            ]
        ]
    },
    {
        "id": "e6bf18b3612157c8",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "start after deploy",
        "func": "let location = \"please wait, loading config\"\nmsg.payload = \"Data save folder: \" + location\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 520,
        "wires": [
            [
                "e94a5e88644c4a83"
            ]
        ]
    },
    {
        "id": "e94a5e88644c4a83",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "SCRIPT VERSION",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Actuel version: V1_21-04-2024_R2",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 500,
        "wires": [
            [
                "3cc5ceef3a2bf52e"
            ]
        ]
    },
    {
        "id": "374f020ae654c6d2",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Shelly, startup",
        "links": [
            "ccbd26bc83101075"
        ],
        "x": 75,
        "y": 520,
        "wires": [
            [
                "e6bf18b3612157c8"
            ]
        ]
    },
    {
        "id": "dbd2bd831a80ae4a",
        "type": "http request",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://127.0.0.1:1880/settings",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 2760,
        "wires": [
            [
                "1de8a7396bcde6a6"
            ]
        ]
    },
    {
        "id": "1de8a7396bcde6a6",
        "type": "json",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1270,
        "y": 2760,
        "wires": [
            [
                "7d8f827b93603aa4"
            ]
        ]
    },
    {
        "id": "7d8f827b93603aa4",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "Get version",
        "func": "flow.set(\"NoderedVersion\",msg.payload.version);\nmsg.payload = new(Date);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 2760,
        "wires": [
            [
                "ccbd26bc83101075"
            ]
        ]
    },
    {
        "id": "76c6c8ff75a3eb9c",
        "type": "file",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "V3 Pi, test directory exists",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1110,
        "y": 2800,
        "wires": [
            [
                "a30f7a3bbb601990"
            ]
        ]
    },
    {
        "id": "dbec6ea2402cee00",
        "type": "file",
        "z": "8bb526423a678cca",
        "g": "388f0f0e58e3f691",
        "name": "V3 Docker, test directory exists",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1130,
        "y": 2880,
        "wires": [
            [
                "a30f7a3bbb601990"
            ]
        ]
    },
    {
        "id": "6dd8366433136ea1",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Shelly, update release in",
        "links": [
            "6fe8bd61f4ef801a"
        ],
        "x": 415,
        "y": 560,
        "wires": [
            [
                "5711026a82557c1f"
            ]
        ]
    },
    {
        "id": "b8f081148f78f13e",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "Shelly, update release out",
        "mode": "link",
        "links": [
            "ef3fe1e77ef8fcbf"
        ],
        "x": 705,
        "y": 560,
        "wires": []
    },
    {
        "id": "5711026a82557c1f",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "fbcb9861d6847b33",
        "name": "UPDATE RELEASE",
        "func": "let version = \"V1_21-04-2024_R2\"\nlet oldStr = msg.payload;\nlet newStr = oldStr.slice(0, oldStr.length-1);\nlet store = newStr;\nflow.set(\"version\", newStr);\nlet html = \"\";\nmsg.topic = \"Release notes\";\nif (msg.statusCode === 200 || 201) {\n    if (store === version) {\n        msg.text = \"FLOW IS UP TO DATE WITH GITHUB (\" + version + \")\"\n        msg.background = \"#0A8085\";\n        return msg;\n    } else {\n        msg.text = \"THERE IS AN UPDATE, CLICK HERE TO READ RELEASE-NOTES AND DOWNLOAD FLOW FILE FROM GITHUB\"\n        msg.background = \"#8C101C\";\n        return msg;\n    }\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 560,
        "wires": [
            [
                "b8f081148f78f13e"
            ]
        ]
    },
    {
        "id": "6fe8bd61f4ef801a",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "Shelly, update release in",
        "mode": "link",
        "links": [
            "6dd8366433136ea1"
        ],
        "x": 435,
        "y": 2620,
        "wires": []
    },
    {
        "id": "ef3fe1e77ef8fcbf",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "8439365cf3da8cab",
        "name": "Shelly, update release out",
        "links": [
            "b8f081148f78f13e"
        ],
        "x": 745,
        "y": 2620,
        "wires": [
            [
                "a6fe2b419618c9ec"
            ]
        ]
    },
    {
        "id": "859285add8efe4a2",
        "type": "switch",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Contain domoticz/out",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "domoticz/out",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 240,
        "y": 1080,
        "wires": [
            [
                "bbfef6795d6bf08f"
            ]
        ]
    },
    {
        "id": "61a23399b873f581",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Source domoticz",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "domoticz",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1040,
        "wires": [
            [
                "8b5f14603e8bc4ac"
            ]
        ]
    },
    {
        "id": "d9a0b4db22f9b490",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Source shelly gen 1",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 900,
        "wires": [
            [
                "8b5f14603e8bc4ac",
                "f090de3ff98c8810"
            ]
        ]
    },
    {
        "id": "14d33512c46bf3e9",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Source shelly gen 2 or 3",
        "rules": [
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen2-3",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 860,
        "wires": [
            [
                "8b5f14603e8bc4ac",
                "f090de3ff98c8810"
            ]
        ]
    },
    {
        "id": "8b5f14603e8bc4ac",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly ID filter on ui table",
        "func": "let storetopic = msg.topic;\nlet devs = flow.get(\"sh2dz-idx\") || {};\nlet length = Object.keys(devs).length;\n\nif (msg.source === 'gen1' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n             \n        if (IDkey === storetopic.split(\"/\")[1]) {\n            let type = dev.type;\n            let output = msg.payload;\n            msg.payload = { output, script: { source: \"Shelly_gen1\" }, domoticz : { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen}};\n            \n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, msg];\n            }\n        }\n    }\n} else {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n                \n        if (IDkey === storetopic.split(\"/\")[0]){\n            let type = dev.type;\n            msg.payload.domoticz = { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen };\n            msg.payload.script = { source: \"Shelly_gen2-3\" };\n\n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, msg];\n            }\n        }\n    }\n}\n\nif ( msg.source === 'domoticz' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let message = devs[IDkey];\n        let messageidx = parseInt(devs[IDkey].idx);\n        let messageidxoption1 = parseInt(devs[IDkey].idxoption1);\n\n        if (messageidx === msg.payload.idx || messageidxoption1 === msg.payload.idx) {\n            let type = message.type;\n            msg.payload.domoticz =  { name: message.name, sw: message.sw, idx: message.idx, idxoption1: message.idxoption1, idxoption2: message.idxoption2, idxoption3: message.idxoption3, idxoption4: message.idxoption4, idxoption5: message.idxoption5, idxoption6: message.idxoption6, idxoption7: message.idxoption7, idxoption8: message.idxoption8, offline: message.offline, addon: message.addon, gen: message.gen };\n            msg.payload.script = { source: \"Domoticz\" }\n                        \n            if (type === \"Shelly Plug S\") {\n                if (messageidx === msg.payload.idx) {\n                    return [msg, null, null, null, null]\n                }\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                if (messageidx === msg.payload.idx) {\n                    return [null, null, msg, null, null];\n                }\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                if (messageidx === msg.payload.idx) {\n                    return [null, null, null, null, msg];\n                }\n            }\n        }\n    }\n}\n\nreturn [null, null, null, null, msg];",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 840,
        "wires": [
            [
                "b9d5d35a3a2fc92e"
            ],
            [
                "f4aa9cb4b65eabb1"
            ],
            [
                "7bd28d17a7135a89"
            ],
            [
                "ce8f36ae9bcf6f26"
            ],
            [
                "4e037c5f7744176f"
            ]
        ]
    },
    {
        "id": "7a82467c9059a7fa",
        "type": "debug",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "IDX not in filter",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 1000,
        "wires": []
    },
    {
        "id": "cbb9c616862bca7c",
        "type": "json",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4670,
        "y": 280,
        "wires": [
            [
                "b8d149035da9a846"
            ]
        ]
    },
    {
        "id": "e17d9d84336480b7",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":false, \"apower\":0.0, \"voltage\":0.0, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 260,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "dcde98ad6a019d3b",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "b48a0a1bf220 : 0 Status false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 260,
        "wires": [
            [
                "e17d9d84336480b7"
            ]
        ]
    },
    {
        "id": "b87b4a698271e8ec",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":0.053, \"voltage\":231.3, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 300,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "e8fef75ce53dd743",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "b48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 300,
        "wires": [
            [
                "b87b4a698271e8ec"
            ]
        ]
    },
    {
        "id": "d51a0b3aefd1570a",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":12.0, \"voltage\":231.3, \"current\":7.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 340,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "9643762012c8de07",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "c48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 340,
        "wires": [
            [
                "d51a0b3aefd1570a"
            ]
        ]
    },
    {
        "id": "8b8f6f64d69f5d35",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "Shelly, Update table out",
        "mode": "link",
        "links": [
            "3ae2f58cdac3360a"
        ],
        "x": 1625,
        "y": 2160,
        "wires": []
    },
    {
        "id": "7bb5aefceb71333e",
        "type": "ui_toast",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1450,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "056a0759e4695110",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "Del shelly device status list",
        "func": "if (msg.topic === \"del\") {\n    let devs = flow.get(\"sh2dz-status\") || {};\n    delete devs[(msg.payload.name)];\n    \n    msg.topic = msg.payload.name + \" removed from status table\";\n    msg.payload = \"Device is removed.\"\n    return msg;\n}\n\nmsg.topic = msg.payload.label;\n\nlet str = JSON.stringify(msg.payload, null, 2);\ndelete msg.payload;\nmsg.payload = \"<pre>\" + str + \"</pre>\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 2160,
        "wires": [
            [
                "7bb5aefceb71333e",
                "8b8f6f64d69f5d35"
            ]
        ]
    },
    {
        "id": "72a9089502408e90",
        "type": "ui_table",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "group": "5d07dbcaa2c15860",
        "name": "Shelly Devices",
        "order": 1,
        "width": 30,
        "height": 11,
        "columns": [
            {
                "field": "name",
                "title": "Topic name",
                "width": "15%",
                "align": "left",
                "formatter": "html",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "sw",
                "title": "Input/Relay",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "output",
                "title": "Payload",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "power",
                "title": "Power",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "voltage",
                "title": "Voltage",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "current",
                "title": "Current",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "seen",
                "title": "Last",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "status",
                "title": "Status",
                "width": "39%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "del",
                "title": "Remove",
                "width": "7%",
                "align": "center",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 880,
        "y": 2160,
        "wires": [
            [
                "056a0759e4695110"
            ]
        ]
    },
    {
        "id": "3538923ca32e73d1",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "store shelly devices",
        "func": "let devs; \nlet status = \"update\";\n\nif ( msg.src === 'restore' ) {\n    devs = flow.get(\"sh2dz-status\") || {};\n    return [{payload:Object.values(devs)}];\n} else {\n    if (msg.source === 'gen1') {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload === \"announce\") {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [];\n\n            // properties that should not show up in the status\n            let notStatus = [\"name\", \"status\"];\n \n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {};\n\n            let devt = flow.get(\"sh2dz-idx\") || {};\n            let length = Object.keys(devt).length;\n\n            let receivedSensors = [];\n            let sw;\n            if (msg.topic.split(\"/\")[3] === undefined) {\n                sw = msg.topic.split(\"/\")[2];\n            } else {\n                sw = msg.topic.split(\"/\")[2] + \" \" + msg.topic.split(\"/\")[3];\n            }\n            let ID = (msg.topic.split(\"/\")[1]);\n            let dev = devs[ID] || {};\n\n            dev.name = msg.topic.split(\"/\")[1];\n            dev.sw = sw;\n            dev.output = msg.payload;\n            //dev.power = msg.payload.apower;\n            //dev.voltage = msg.payload.voltage;\n            //dev.current = msg.payload.current;\n\n            dev.lastTime = new Date().getTime();\n\n            // create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (inStatus.includes(prop)) {\n                    status += \" \" + prop + \": \" + dev[prop];\n                }\n            }\n            if (status === \"\") {\n                for (let prop in dev) {\n                    if (!notStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop];\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n\n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime() - element[1].lastTime) / 60000) + \"m\");\n\n            flow.set(\"sh2dz-status\", devs);\n\n            return [{ topic: status, payload: Object.values(devs) }];\n        }\n    } else {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\" ) {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [\"power\", \"voltage\", \"current\"];\n   \n            // properties that should not show up in the status\n            let notStatus = [\"id\", \"source\"];\n\n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {}; \n    \n            let devt = flow.get(\"sh2dz-idx\") || {};\n            let length = Object.keys(devt).length;\n       \n            let receivedSensors = [];\n            let ID = (msg.topic.split(\"/\")[1]);\n            let dev = devs[ID] || {};\n\n            dev.name = msg.topic.split(\"/\")[1];\n            dev.sw = msg.topic.split(\":\")[1];\n            dev.output = msg.payload.output;\n            dev.power = msg.payload.apower;\n            dev.voltage = msg.payload.voltage;\n            dev.current = msg.payload.current;\n\n            dev.lastTime = new Date().getTime();    \n\n            // create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (inStatus.includes(prop)) {\n                    status += \" \" + prop + \": \" + dev[prop];\n                }\n            }\n            if (status === \"\") {\n                for (let prop in dev) {\n                    if (!notStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop];\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n       \n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime()-element[1].lastTime)/60000)+\"m\");\n    \n            flow.set(\"sh2dz-status\", devs);\n\n            return [{topic: status, payload:Object.values(devs)}];\n        }\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 2160,
        "wires": [
            [
                "72a9089502408e90"
            ]
        ]
    },
    {
        "id": "7421f9ac32df3ada",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "add src",
        "func": "msg.src = 'restore';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 2160,
        "wires": [
            [
                "3538923ca32e73d1"
            ]
        ]
    },
    {
        "id": "21e5af0af9bbabca",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "Shelly message received",
        "links": [
            "f090de3ff98c8810"
        ],
        "x": 425,
        "y": 2120,
        "wires": [
            [
                "3538923ca32e73d1"
            ]
        ]
    },
    {
        "id": "3ae2f58cdac3360a",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "Shelly, restore/update table",
        "links": [
            "8b8f6f64d69f5d35"
        ],
        "x": 205,
        "y": 2120,
        "wires": [
            [
                "7421f9ac32df3ada"
            ]
        ]
    },
    {
        "id": "d57b30dfb5489a9d",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "b1efebefe4ba16c4",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 2160,
        "wires": [
            [
                "7421f9ac32df3ada"
            ]
        ]
    },
    {
        "id": "e925d723525f6446",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":21.0, \"voltage\":213.3, \"current\":17.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 380,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "14e6e1953b8d8ce4",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "c48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 380,
        "wires": [
            [
                "e925d723525f6446"
            ]
        ]
    },
    {
        "id": "1f239b701fc739fe",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":false, \"apower\":0.0, \"voltage\":0.0, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 420,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "1a50aa77c9390bce",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "b48a0a1bf220 : 1 Status false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 420,
        "wires": [
            [
                "1f239b701fc739fe"
            ]
        ]
    },
    {
        "id": "8331a0eb539bc510",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":0.053, \"voltage\":231.3, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 460,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "ab74ed56344248e5",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "b48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 460,
        "wires": [
            [
                "8331a0eb539bc510"
            ]
        ]
    },
    {
        "id": "f47d57cb95a8b5f2",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":12.0, \"voltage\":231.3, \"current\":7.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 500,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "a6a0ef966b21d3ba",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "c48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 500,
        "wires": [
            [
                "f47d57cb95a8b5f2"
            ]
        ]
    },
    {
        "id": "390a04387e47951e",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":21.0, \"voltage\":213.3, \"current\":17.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 540,
        "wires": [
            [
                "cbb9c616862bca7c"
            ]
        ]
    },
    {
        "id": "a69fa0a83846d2b9",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "12ca6caf6ef01fc9",
        "name": "c48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 540,
        "wires": [
            [
                "390a04387e47951e"
            ]
        ]
    },
    {
        "id": "7bd28d17a7135a89",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "gen2 Shelly Plus Plug S",
        "func": "let d = new Date();\nlet apower, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Heartbeat\") {\n  let heartbeat = flow.get(\"dz-state\") || {};\n  let idxstatus = [];\n  let length = Object.keys(heartbeat).length;\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(heartbeat);\n    let IDkey = keys[i];\n    let dev = heartbeat[IDkey] || {};\n    if (dev.offline === \"Not set\" || dev.offline === \"Disable\") {\n      node.log(\"There is a device which has no heartbeat set or disabled\" )  \n    } else {\n      if (d.getTime() - dev.lasttime > (dev.offline * 1000)) {\n        idx = Number(IDkey.split(\":\")[1])\n        let domoticz = flow.get(\"sh2dz-idx\") || {};\n        let objlength = Object.keys(domoticz).length;\n\n        for (let j = 0; j < objlength; j++) {\n          let objkeys = Object.keys(domoticz);\n          let objIDkey = objkeys[i];\n          let message = domoticz[objIDkey];\n          let messageidx = parseInt(domoticz[objIDkey].idx);\n\n          if (messageidx === idx) {\n            if (dev.online === true){\n              //apower\n              if (Number(message.idxoption1) === 0 || message.idxoption1 === undefined || message.idxoption1 === \"N/A\" || message.idxoption1 === \"Not set\") {\n                apower = null\n              } else {\n                apower = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption1),\n                    svalue: \"-1\",\n                  }\n                }\n              }\n    \n              //voltage\n              if (Number(message.idxoption2) === 0 || message.idxoption2 === undefined || message.idxoption2 === \"N/A\" || message.idxoption2 === \"Not set\") {\n                voltage = null;\n              } else {\n                voltage = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption2),\n                    svalue: \"-1\",\n                  }\n                }\n              }\n    \n              //current\n              if (Number(message.idxoption3) === 0 || message.idxoption3 === undefined || message.idxoption3 === \"N/A\" || message.idxoption3 === \"Not set\") {\n                current = null;\n              } else {\n                current = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption3),\n                    svalue: \"-1\",\n                  }\n                }\n              }\n    \n              //total\n              if (Number(message.idxoption4) === 0 || message.idxoption4 === undefined || message.idxoption4 === \"N/A\" || message.idxoption4 === \"Not set\") {\n                total = null;\n              } else {\n                total = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption4),\n                    nvalue: 0,\n                    svalue: \"0;0\",\n                  }\n                }\n              }\n  \n              //Output\n              if (Number(message.idx) === 0 || message.idx === undefined) {\n                msg = null\n              } else {\n                msg = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idx),\n                    nvalue: 0,\n                  }\n                }\n   \n                dev.online = false\n                dev.output = false\n              \n                heartbeat[IDkey] = dev;\n                idxstatus.push(dev);\n\n                flow.set(\"dz-state\", heartbeat);\n              }\n              return [[msg, apower, voltage, current]];\n            }\n          }\n        }\n      }  \n    }\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Shelly_gen2-3\") {\n    let info = msg.topic.split(\"/\")[1];\n    let output;\n    \n    if (info === \"status\") {\n      let domoticz = flow.get(\"dz-state\") || {};\n      let idxstate = [];\n      let ID = \"idx:\" + msg.payload.domoticz.idx\n      let dev = domoticz[ID] || {};\n      let length = Object.keys(domoticz).length;\n\n      dev.lasttime = d.getTime();\n      dev.offline = msg.payload.domoticz.offline;\n      dev.online = true;\n\n      for (let i = 0; i < length; i++) {\n        let keys = Object.keys(domoticz);\n        let IDkey = keys[i];\n        let dev = domoticz[IDkey] || {};\n\n        if (IDkey === ID) {\n          output = dev.output;\n        }\n      }\n\n      //apower\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined || msg.payload.domoticz.idxoption1 === \"N/A\" || msg.payload.domoticz.idxoption1 === \"Not set\") {\n        apower = null\n      } else {\n        apower = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption1),\n            svalue: msg.payload.apower.toString(),\n          }\n        }\n      }\n\n      //voltage\n      if (Number(msg.payload.domoticz.idxoption2) === 0 || msg.payload.domoticz.idxoption2 === undefined || msg.payload.domoticz.idxoption2 === \"N/A\" || msg.payload.domoticz.idxoption2 === \"Not set\") {\n        voltage = null;\n      } else {\n        voltage = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption2),\n            svalue: msg.payload.voltage.toString(),\n          }\n        }\n      }\n\n      //current\n      if (Number(msg.payload.domoticz.idxoption3) === 0 || msg.payload.domoticz.idxoption3 === undefined || msg.payload.domoticz.idxoption3 === \"N/A\" || msg.payload.domoticz.idxoption3 === \"Not set\") {\n        current = null;\n      } else {\n        current = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption3),\n            svalue: msg.payload.current.toString(),\n          }\n        }\n      }\n\n      //total\n      if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined || msg.payload.domoticz.idxoption4 === \"N/A\" || msg.payload.domoticz.idxoption4 === \"Not set\") {\n        total = null;\n      } else {\n        total = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption4),\n            nvalue: 0,\n            svalue: msg.payload.aenergy.total + \"\\\";\\\"\" + 0,\n          }\n        }\n      }\n\n      //Output\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg = null\n      } else {\n        if (output == msg.payload.output) {\n          msg = null;\n        } else {\n          dev.output = msg.payload.output\n          let val = msg.payload.output == true ? 1 : 0;\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: val,\n            }\n          }\n        }\n      }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  msg.topic = msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  \n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2490,
        "y": 880,
        "wires": [
            [
                "eb496807137ba35c",
                "0ac0e432f8c14166",
                "8c95c53727d84a96"
            ]
        ]
    },
    {
        "id": "ab83be9abe166bdb",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Heartbeat check every minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1910,
        "y": 720,
        "wires": [
            [
                "3ccbed77af5b7d39"
            ]
        ]
    },
    {
        "id": "3ccbed77af5b7d39",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "Source Heartbeat",
        "func": "msg.payload = { script: { source: \"Heartbeat\" }};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2170,
        "y": 720,
        "wires": [
            [
                "7bd28d17a7135a89",
                "b9d5d35a3a2fc92e"
            ]
        ]
    },
    {
        "id": "bbfef6795d6bf08f",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "IDX Check",
        "func": "let filter = flow.get(\"dz-idx-filter\") || [];\n\nif (msg.payload.hasOwnProperty(\"idx\")) {\n    if (filter.includes(msg.payload.idx.toString())) {\n        return [null, msg];\n        } else {\n        return [msg, null]; \n    }\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1080,
        "wires": [
            [
                "7a82467c9059a7fa"
            ],
            [
                "61a23399b873f581",
                "def1e08c580b35e3"
            ]
        ]
    },
    {
        "id": "e704bc763f2d9730",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Shelly, message idx tabel",
        "links": [
            "f090de3ff98c8810"
        ],
        "x": 245,
        "y": 1280,
        "wires": [
            [
                "47c028065b8e619c"
            ]
        ]
    },
    {
        "id": "47c028065b8e619c",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Prepare for device table",
        "func": "let devs; \ndevs = flow.get(\"sh2dz-idx\") || {};\n\nif ( msg.src === 'restore' ) {\n    return [{payload:Object.values(devs)}];\n} else if (msg.source === 'gen1') {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let relay = msg.topic.split(\"/\")[3];\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[1];\n        let ID = name;\n        let dev = devs[ID] || {};\n        if (relay === \"energy\") {\n            return;\n        }\n\n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        dev.sw = relay;\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        } \n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }\n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }    \n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }\n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }\n\n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n} else {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[0];\n        let relay = msg.topic.split(\":\")[1];\n        let ID = name;\n        let dev = devs[ID] || {};\n        if (relay === \"energy\") {\n            return;\n        }\n\n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        if (dev.type === undefined) {\n            dev.sw = msg.payload.params[(Object.keys(msg.payload[\"params\"])[1])].id;\n        } else {\n            dev.sw = relay;  \n        }\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        }\n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }  \n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }\n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }    \n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }   \n   \n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1240,
        "wires": [
            [
                "52d0b2732d74762d",
                "b17df7dc68f8c9fb"
            ]
        ]
    },
    {
        "id": "b17df7dc68f8c9fb",
        "type": "ui_table",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "group": "e151206531f4336f",
        "name": "Shelly tabel",
        "order": 16,
        "width": 30,
        "height": 4,
        "columns": [
            {
                "field": "name",
                "title": "Name",
                "width": "18%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "sw",
                "title": "Switch",
                "width": "5%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "type",
                "title": "Type",
                "width": "15%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idx",
                "title": "IDX",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption1",
                "title": "Option 1",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption2",
                "title": "Option 2",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption3",
                "title": "Option 3",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption4",
                "title": "Option 4",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption5",
                "title": "Option 5",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption6",
                "title": "Option 6",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption7",
                "title": "Option 7",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption8",
                "title": "Option 8",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "offline",
                "title": "Offline",
                "width": "9%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "del",
                "title": "Remove",
                "width": "10%",
                "align": "center",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 670,
        "y": 1260,
        "wires": [
            [
                "6fa873396269ac3d"
            ]
        ]
    },
    {
        "id": "6fa873396269ac3d",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Prefix for asking del?",
        "func": "if (msg.topic === \"del\") {\n    flow.set(\"delbuffer\", msg.payload)\n    \n    msg.topic = \"IDX tabel: Delete \" + msg.payload.name + \", switch \" + msg.payload.sw + \"?\";\n    msg.payload = \"Do you want to remove this device out the IDX list?\"\nreturn [msg, null];    \n}\n\n\nmsg.topic = msg.payload.name + \" (sw:\" + msg.payload.sw + \")\";\n\nlet str = JSON.stringify(msg.payload, null, 2);\ndelete msg.payload;\nmsg.payload = \"<pre>\" + str + \"</pre>\";\n\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1320,
        "wires": [
            [
                "22789251357ade40"
            ],
            [
                "d1714a4cf325537d"
            ]
        ]
    },
    {
        "id": "22789251357ade40",
        "type": "ui_toast",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Cancel",
        "cancel": "Remove",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Del asking pop-up",
        "x": 690,
        "y": 1300,
        "wires": [
            [
                "4b9aeb60fe455655"
            ]
        ]
    },
    {
        "id": "4b9aeb60fe455655",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Del in shelly tabel",
        "func": "if (msg.payload === \"Cancel\"){\n    flow.set(\"delbuffer\", \"\");\n    return;\n} else {\n    let dev = flow.get(\"sh2dz-idx\") || {};\n    let devs = flow.get(\"dz-state\") || {};\n    let filter = flow.get(\"dz-idx-filter\") || {};\n    let remove = flow.get(\"delbuffer\")   \n\n    delete dev[remove.name];\n    delete devs[\"idx:\"+remove.idx];\n\n    for (var i = 0; i < filter.length; i++) {\n        if (filter[i] === remove.idx) {\n            filter.splice(i, 1);\n        }\n    }\n    flow.set(\"dz-idx-filter\", filter);\n\n    msg.topic = \"Removing shelly device from list.\"\n    msg.payload = remove.name + \", is removed from IDX list.\";\n\n    let reconfig = flow.get(\"sh2dz-idx\") || {}\n    flow.set(\"delbuffer\", \"\");\n    return [msg,{payload:Object.values(reconfig)}];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 1320,
        "wires": [
            [
                "5eb6fe2ab8a42e4c",
                "3d039318d843c54c"
            ],
            [
                "ae0770ae9e6a1df1"
            ]
        ]
    },
    {
        "id": "d1714a4cf325537d",
        "type": "ui_toast",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Show detail info",
        "x": 680,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "5eb6fe2ab8a42e4c",
        "type": "ui_toast",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1190,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "3d039318d843c54c",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Shelly, Restore in (shelly table)",
        "mode": "link",
        "links": [
            "95081cdef9f1d15d"
        ],
        "x": 1115,
        "y": 1260,
        "wires": []
    },
    {
        "id": "6620e620c86ecdfe",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "add src",
        "func": "msg.src = 'restore';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 1240,
        "wires": [
            [
                "47c028065b8e619c"
            ]
        ]
    },
    {
        "id": "95081cdef9f1d15d",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Shelly, restore idxtable out",
        "links": [
            "12f54806a8630b40",
            "3d039318d843c54c",
            "06e1b7aabb2f03b5"
        ],
        "x": 75,
        "y": 1240,
        "wires": [
            [
                "6620e620c86ecdfe"
            ]
        ]
    },
    {
        "id": "ae0770ae9e6a1df1",
        "type": "json",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1150,
        "y": 1340,
        "wires": [
            [
                "9ffb30200aa322fc"
            ]
        ]
    },
    {
        "id": "c6c7cc872688fdca",
        "type": "file",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "9ffb30200aa322fc",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1340,
        "wires": [
            [
                "c6c7cc872688fdca"
            ]
        ]
    },
    {
        "id": "0ac0e432f8c14166",
        "type": "link out",
        "z": "8bb526423a678cca",
        "name": "Shelly to mqtt",
        "mode": "link",
        "links": [
            "9553d6d2c20220e3",
            "9b3576adfd857fdb"
        ],
        "x": 2695,
        "y": 760,
        "wires": []
    },
    {
        "id": "eb496807137ba35c",
        "type": "debug",
        "z": "8bb526423a678cca",
        "name": "gen2 shelly plus plug s",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2780,
        "y": 880,
        "wires": []
    },
    {
        "id": "fb4120cadd1f93da",
        "type": "ui_button",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "",
        "group": "e151206531f4336f",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Show discovered shellies",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 1340,
        "wires": [
            [
                "6620e620c86ecdfe"
            ]
        ]
    },
    {
        "id": "52d0b2732d74762d",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "af671eefa098b860",
        "name": "Shelly, Device discovered",
        "mode": "link",
        "links": [
            "22df1ba2343faff0"
        ],
        "x": 615,
        "y": 1220,
        "wires": []
    },
    {
        "id": "4e037c5f7744176f",
        "type": "debug",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Not (yet) supported",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1530,
        "y": 980,
        "wires": []
    },
    {
        "id": "52b06f5c2acb214b",
        "type": "ui_text",
        "z": "8bb526423a678cca",
        "group": "61d922efb8a113fa",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Github URL: https://github.com/Hoeby/V1-Shelly-Nodered-flow",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 250,
        "y": 80,
        "wires": []
    },
    {
        "id": "b9d5d35a3a2fc92e",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "gen1 Shelly Plug S",
        "func": "let d = new Date();\nlet apower, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Heartbeat\") {\n  let heartbeat = flow.get(\"dz-state\") || {};\n  let idxstatus = [];\n  let length = Object.keys(heartbeat).length;\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(heartbeat);\n    let IDkey = keys[i];\n    let dev = heartbeat[IDkey] || {};\n    if (dev.offline === \"Not set\" || dev.offline === \"Disable\") {\n      node.log(\"There is a device which has no heartbeat set or disabled\")\n    } else {\n      if (d.getTime() - dev.lasttime > (dev.offline * 1000)) {\n        idx = Number(IDkey.split(\":\")[1])\n        let domoticz = flow.get(\"sh2dz-idx\") || {};\n        let objlength = Object.keys(domoticz).length;\n \n        for (let j = 0; j < objlength; j++) {\n          let objkeys = Object.keys(domoticz);\n          let objIDkey = objkeys[j];\n          let message = domoticz[objIDkey];\n          let messageidx = parseInt(domoticz[objIDkey].idx);\n          if (messageidx === idx) {\n            if (dev.output === true) {\n              if (dev.online === true) {\n    \n                //apower\n                if (Number(message.idxoption1) === 0 || message.idxoption1 === undefined || message.idxoption1 === \"N/A\" || message.idxoption1 === \"Not set\") {\n                  apower = null\n                } else {\n                  apower = {\n                    topic: \"domoticz/in\",\n                    payload:\n                    {\n                      command: \"udevice\",\n                      idx: Number(message.idxoption1),\n                      svalue: \"-1\",\n                    }\n                  }\n                }\n\n                //Output\n                if (Number(message.idx) === 0 || message.idx === undefined) {\n                  msg = null\n                } else {\n                  msg = {\n                    topic: \"domoticz/in\",\n                    payload:\n                    {\n                      command: \"udevice\",\n                      idx: Number(message.idx),\n                      nvalue: 0,\n                    }\n                  }\n                }\n\n                dev.online = false\n                dev.output = false\n\n                heartbeat[IDkey] = dev;\n                idxstatus.push(dev);\n\n                flow.set(\"dz-state\", heartbeat);\n              }\n              return [[msg, apower, voltage, current]];\n            }\n          }\n        }\n      }\n    }\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n  let info = msg.topic.split(\"/\")[2];\n  let energy = msg.topic.split(\"/\")[4];\n  let output;\n\n  if (info === \"relay\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx:\" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload; \n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        output = dev.output;\n      }\n    }\n      \n    //Output\n    let val;\n    if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n      msg = null\n    } else {\n      if (msg.payload.output === \"on\") {\n        dev.output = true;\n        val = 1;\n      } else if (msg.payload.output === \"off\") {\n        dev.output = false;\n        val = 0;\n      }\n      if (output == dev.output) {\n        msg = null;\n      } else {\n        msg = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idx),\n            nvalue: val,\n          }\n        }\n      }\n    }\n\n    //apower\n    if (dev.output === true) {\n      if (energy === \"energy\") {\n        if (Number(save.domoticz.idxoption1) === 0 || save.domoticz.idxoption1 === undefined || save.domoticz.idxoption1 === \"N/A\" || save.domoticz.idxoption1 === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption1),\n              svalue: save.output.output.toString(),\n            }\n          }\n        }\n      }\n    } else if (dev.output === false) {\n      if (output == dev.output) {\n        msg = null;\n      } else {\n        if (Number(save.domoticz.idxoption1) === 0 || save.domoticz.idxoption1 === undefined || save.domoticz.idxoption1 === \"N/A\" || save.domoticz.idxoption1 === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption1),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n  \n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 800,
        "wires": [
            [
                "b0d6b4170b03e414",
                "0ac0e432f8c14166",
                "8c95c53727d84a96"
            ]
        ]
    },
    {
        "id": "b0d6b4170b03e414",
        "type": "debug",
        "z": "8bb526423a678cca",
        "name": "gen1 shelly plug s",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2770,
        "y": 800,
        "wires": []
    },
    {
        "id": "f6c5301e6e25a3e2",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "77fac4f8715c0b54",
        "name": "Shellies plug energy",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"output\":9,\"domoticz\":{\"name\":\"shellyplug-s-80646F817476\",\"sw\":\"0\",\"idx\":\"11\",\"idxoption1\":\"N/A\",\"idxoption2\":\"N/A\",\"idxoption3\":\"N/A\",\"idxoption4\":\"N/A\",\"idxoption5\":\"N/A\",\"idxoption6\":\"N/A\",\"idxoption7\":\"N/A\",\"idxoption8\":\"N/A\",\"offline\":\"N/A\",\"addon\":\"none\",\"gen\":\"gen1\"},\"script\":{\"source\":\"Shelly_gen1\"}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0/energy",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4460,
        "y": 680,
        "wires": [
            [
                "32906713453bd831"
            ]
        ]
    },
    {
        "id": "547b9b4ad5ada17d",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "77fac4f8715c0b54",
        "name": "Shellies plug on",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 640,
        "wires": [
            [
                "b8d149035da9a846"
            ]
        ]
    },
    {
        "id": "95d316d13e06c821",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "77fac4f8715c0b54",
        "name": "Shellies plug off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 720,
        "wires": [
            [
                "b8d149035da9a846"
            ]
        ]
    },
    {
        "id": "376885f1d4903572",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "77fac4f8715c0b54",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 640,
        "wires": [
            [
                "547b9b4ad5ada17d"
            ]
        ]
    },
    {
        "id": "791591278c96bb68",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "77fac4f8715c0b54",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 680,
        "wires": [
            [
                "f6c5301e6e25a3e2"
            ]
        ]
    },
    {
        "id": "c1c56806c42494b0",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "77fac4f8715c0b54",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 720,
        "wires": [
            [
                "95d316d13e06c821"
            ]
        ]
    },
    {
        "id": "fe2e561d181efb9a",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX nummer",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idx",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1500,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "107df705426ea170",
        "type": "ui_button",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "group": "e151206531f4336f",
        "order": 15,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Set settings",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 550,
        "y": 1900,
        "wires": [
            [
                "9d0c2e25a12525c3",
                "bea4c2da64154c9f"
            ]
        ]
    },
    {
        "id": "0265efcc212e0658",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Clear",
        "func": "delete msg.payload;\nmsg.payload =\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1980,
        "wires": [
            [
                "fe2e561d181efb9a",
                "7ed80bc4d1d1befe",
                "57305f4f3cace6c9",
                "37c98da5574d1f2d",
                "1cc96017040251be",
                "bd6f3e43f7b9a3d0",
                "c9b7df9a4f724658",
                "89eeb1701cf3357f",
                "95d336bc9a027740",
                "88332fce42200e46",
                "f73fcf44abf3ad74"
            ]
        ]
    },
    {
        "id": "9d0c2e25a12525c3",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Set Device settings",
        "func": "let option1 = [\"Shelly Plug S\", \"Shelly Plus Plug S\", \"Shelly 1pm mini\"];\nlet option2 = [\"Shelly Plus Plug S\"];\nlet option3 = [\"Shelly Plus Plug S\"];\nlet option4 = [\"Shelly Plus Plug S\"];\nlet option5 = [];\nlet option6 = [];\nlet option7 = [];\nlet option8 = [];\nlet option13 = [\"Shelly Plug S\", \"Shelly Plus Plug S\"];\nlet data1 = context.get(\"data1\") || null; //get from context or default to null\nlet data2 = context.get(\"data2\") || null; //get from context or default to null\nlet data3 = context.get(\"data3\") || null; //get from context or default to null\nlet data4 = context.get(\"data4\") || \"Not set\"; //get from context or default to 0\nlet data5 = context.get(\"data5\") || \"Not set\"; //get from context or default to 0\nlet data6 = context.get(\"data6\") || \"Not set\"; //get from context or default to 0\nlet data7 = context.get(\"data7\") || \"Not set\"; //get from context or default to 0\nlet data8 = context.get(\"data8\") || \"Not set\"; //get from context or default to 0\nlet data9 = context.get(\"data9\") || \"Not set\"; //get from context or default to 0\nlet data10 = context.get(\"data10\") || \"Not set\"; //get from context or default to 0\nlet data11 = context.get(\"data11\") || \"Not set\"; //get from context or default to 0\nlet data12 = context.get(\"data12\") || \"Not set\"; //get from context or default to 0\nlet data13 = context.get(\"data13\") || \"Not set\"; //get from context or default to 0\n\n\nlet reconfig = flow.get(\"sh2dz-idx\") || {};\n\nswitch (msg.topic){\n\n    case \"device\":\n        //data1 = msg.payload; \n        data1 = msg.payload.split(\"/\")[0];\n        data2 = msg.payload.split(\"/\")[1];\n        context.set(\"data1\", data1);//store in context for next time \n        context.set(\"data2\", data2);//store in context for next time \n        return;\n\n    //case \"sw\":\n    //    data2 = msg.payload;\n    //    context.set(\"data2\", data2);//store in context for next time \n    //    return;\n\n    case \"type\":\n        data3 = msg.payload;\n        context.set(\"data3\", data3);//store in context for next time \n        return;\n    \n    case \"idx\":\n        data4 = msg.payload; \n        context.set(\"data4\", data4);//store in context for next time \n        return;\n        \n    case \"idxoption1\":\n        data5 = msg.payload;\n        context.set(\"data5\", data5); //store in context for next time \n        return;\n        \n    case \"idxoption2\":\n        data6 = msg.payload;\n        context.set(\"data6\", data6); //store in context for next time \n        return;\n    \n    case \"idxoption3\":\n        data7 = msg.payload;\n        context.set(\"data7\", data7); //store in context for next time \n        return;\n    \n    case \"idxoption4\":\n        data8 = msg.payload;\n        context.set(\"data8\", data8); //store in context for next time \n        return;\n\n    case \"idxoption5\":\n        data9 = msg.payload;\n        context.set(\"data9\", data9); //store in context for next time \n        return;\n\n    case \"idxoption6\":\n        data10 = msg.payload;\n        context.set(\"data10\", data10); //store in context for next time \n        return;\n    \n    case \"idxoption7\":\n        data11 = msg.payload;\n        context.set(\"data11\", data11); //store in context for next time \n        return;\n    \n    case \"idxoption8\":\n        data12 = msg.payload;\n        context.set(\"data12\", data12); //store in context for next time \n        return;\n\n    case \"offline\":\n        data13 = msg.payload;\n        context.set(\"data13\", data13); //store in context for next time \n        return;\n\n    case \"submit\":\n        if (data1 !== null ) {\n            let receivedSensors = [];\n            let dev = reconfig[(data1.split(\"/\")[0])] || {};\n            \n            dev.type = data3;\n\n            dev.name = data1.split(\":\")[0];\n            //dev.sw = data1.split(\":\")[1];\n            dev.sw = data2;\n                        \n            if (data3 === \"Not (yet) supported\") {\n                dev.idx = \"N/A\";\n            } else {\n                dev.idx = data4;\n            }            \n            if (option1.includes(data3)) {\n                dev.idxoption1 = data5;\n            } else {\n                dev.idxoption1 = \"N/A\";\n            }\n            if (option2.includes(data3)) {\n                dev.idxoption2 = data6;\n            } else {\n                dev.idxoption2 = \"N/A\";\n            } \n            if (option3.includes(data3)) {\n                dev.idxoption3 = data7;\n            } else {\n                dev.idxoption3 = \"N/A\";\n            }\n            if (option4.includes(data3)) {\n                dev.idxoption4 = data8;\n            } else {\n                dev.idxoption4 = \"N/A\";\n            }\n            if (option5.includes(data3)) {\n                dev.idxoption5 = data9;\n            } else {\n                dev.idxoption5 = \"N/A\";\n            }\n            if (option6.includes(data3)) {\n                dev.idxoption6 = data10;\n            } else {\n                dev.idxoption6 = \"N/A\";\n            }\n            if (option7.includes(data3)) {\n                dev.idxoption7 = data11;\n            } else {\n                dev.idxoption7 = \"N/A\";\n            }\n            if (option8.includes(data3)) {\n                dev.idxoption8 = data12;\n            } else {\n                dev.idxoption8 = \"N/A\";\n            }\n            if (option13.includes(data3)) {\n                dev.offline = data13;\n            } else {\n                dev.offline = \"N/A\";\n            }\n            // write back\n            reconfig[(data1.split(\"/\")[0])] = dev;\n            receivedSensors.push(dev);\n \n            flow.set(\"sh2dz-idx\", reconfig);\n            context.set(\"data1\", null);\n        } else {\n            return;\n        }\n    }\n\nreturn [{payload:Object.values(reconfig)},msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 1620,
        "wires": [
            [
                "579ebae7ced6c74b",
                "7f3f4e68412e5f9a"
            ],
            [
                "06e1b7aabb2f03b5"
            ]
        ]
    },
    {
        "id": "7ed80bc4d1d1befe",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 1",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 7,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption1",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1540,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "57305f4f3cace6c9",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 2",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 12,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption2",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1580,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "37c98da5574d1f2d",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 4",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 8,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption4",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1660,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "bea4c2da64154c9f",
        "type": "delay",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 1980,
        "wires": [
            [
                "0265efcc212e0658"
            ]
        ]
    },
    {
        "id": "1cc96017040251be",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 3",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption3",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1620,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "579ebae7ced6c74b",
        "type": "json",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1150,
        "y": 1600,
        "wires": [
            [
                "327e75bfa7bab97b"
            ]
        ]
    },
    {
        "id": "06e1b7aabb2f03b5",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Shelly, Restore idx table",
        "mode": "link",
        "links": [
            "95081cdef9f1d15d"
        ],
        "x": 1105,
        "y": 1640,
        "wires": []
    },
    {
        "id": "22df1ba2343faff0",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Shelly, Device in",
        "links": [
            "452b38fec749323b",
            "6908453d834d5d49",
            "52d0b2732d74762d"
        ],
        "x": 75,
        "y": 1440,
        "wires": [
            [
                "b114998cf9670520"
            ]
        ]
    },
    {
        "id": "89eeb1701cf3357f",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Device list",
        "func": "msg.payload = \"\"\nmsg.options = [\"Shelly Plug S\",\n               \"Shelly 2.5 shutter mode\",\n               \"Shelly 1pm mini\",\n               \"Shelly Plus Plug S\",\n               \"Not (yet) supported\" ]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1960,
        "wires": [
            [
                "193606ae91cb6945"
            ]
        ]
    },
    {
        "id": "193606ae91cb6945",
        "type": "ui_dropdown",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "device type",
        "label": "",
        "tooltip": "",
        "place": "Device type",
        "group": "e151206531f4336f",
        "order": 11,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [],
        "payload": "",
        "topic": "type",
        "topicType": "str",
        "className": "",
        "x": 730,
        "y": 1960,
        "wires": [
            [
                "9d0c2e25a12525c3",
                "8fba84446159dd35"
            ]
        ]
    },
    {
        "id": "666be2451fc99703",
        "type": "ui_button",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "group": "e151206531f4336f",
        "order": 10,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "How setup device in domoticz",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 1490,
        "y": 1860,
        "wires": [
            [
                "8fba84446159dd35"
            ]
        ]
    },
    {
        "id": "8fba84446159dd35",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "How to setup device in domoticz",
        "func": "let device = context.get(\"type\") || 0; //get from context or default to 0\n\nswitch (msg.topic){\n\n    case \"type\":\n        device = msg.payload; \n        context.set(\"type\", device);//store in context for next time \n        return;\n\n    case \"submit\":\n        \n        //Shelly Plug s (gen1)\n        if (device === \"Shelly Plug S\") {\n            msg.topic = \"Shelly Plug S (generation 1)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch (Dummy = switch)</p><p>IDXoption1 = Power (Dummy = Usage, Electric)</p><p>IDXoption2 = Not available for this device</p><p>IDXoption3 = Not available for this device</p><p>IDXoption4 = Not available for this device</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n        \n        //Shelly 2.5 (gen1)\n        } else if (device === \"Shelly 2.5\") {\n            msg.topic = \"Shelly 2.5 (generation 1)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch relay 0 (Dummy = switch)</p><p>IDXoption1 = switch relay 1 (Dummy = switch)</p><p>IDXoption2 = input 0 (Dummy = switch)</p><p>IDXoption3 = input 1 (Dummy = switch)</p><p>IDXoption4 = Voltage (Dummy = General, Voltage)</p><p>IDXoption5 = Energy 0 (Dummy = General, kWh)</p><p>IDXoption6 = Energy 1 (Dummy = General, kWh)</p><p>IDXoption7 = Power 0 (Dummy = General, Electric)</p><p>IDXoption8 = Power 1 (Dummy = General, Electric)</p><p>Offline notify = Not available for this device</p>\"\n     \n        //Shelly Plus Plug S (gen2)    \n        } else if (device === \"Shelly Plus Plug S\" ) {   \n            msg.topic = \"Shelly Plus Plug S (generation 2)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch (Dummy = switch)</p><p>IDXoption1 = Power (Dummy = Usage, Electric)</p><p>IDXoption2 = Voltage (Dummy = General, Voltage)</p><p>IDXoption3 = Current (Dummy = General, Current)</p><p>IDXoption4 = Total power (Dummy = General, kWh)</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n\n        //Shelly 1PM mini (gen3)       \n        } else if (device === \"Shelly 1pm mini\") {\n            msg.topic = \"Shelly 1PM mini (generation 3)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch relay 0 (Dummy = switch)</p><p>IDXoption1 = input 0 (Dummy = switch)</p><p>IDXoption2 = Not available for this device</p><p>IDXoption3 = Not available for this device</p><p>IDXoption4 = Not available for this device</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Not available for this device</p>\"\n\n        } else {\n            msg.topic = \"Device unknown\"\n            msg.payload = \"<p>First select device type, afterwards the info is shown</p>\"\n        }\n        return msg;\n    }",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 1900,
        "wires": [
            [
                "17589e2bba035dc5"
            ]
        ]
    },
    {
        "id": "17589e2bba035dc5",
        "type": "ui_toast",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1450,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "f6a3dba03f3790cb",
        "type": "ui_dropdown",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "",
        "tooltip": "",
        "place": "Device",
        "group": "e151206531f4336f",
        "order": 6,
        "width": 6,
        "height": 1,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "device",
        "topicType": "str",
        "className": "",
        "x": 540,
        "y": 1440,
        "wires": [
            [
                "9d0c2e25a12525c3",
                "8ae89b198eaf3384",
                "9b3b3d9295118404"
            ]
        ]
    },
    {
        "id": "b114998cf9670520",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "extract devicenames",
        "func": "if (msg.topic === \"no-update\")  {\n   return;\n} else {\n   msg.options = msg.payload.map(obj => {\n      var rObj = {};\n      rObj[obj.name] = obj.name + \"/\" + obj.sw\n      return rObj;\n   });\n}\n\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1440,
        "wires": [
            [
                "f6a3dba03f3790cb"
            ]
        ]
    },
    {
        "id": "327e75bfa7bab97b",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1600,
        "wires": [
            [
                "3b066fbbda51ec9a"
            ]
        ]
    },
    {
        "id": "3b066fbbda51ec9a",
        "type": "file",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 1600,
        "wires": [
            []
        ]
    },
    {
        "id": "bd6f3e43f7b9a3d0",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 5",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 13,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption5",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1700,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "c9b7df9a4f724658",
        "type": "ui_dropdown",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Offline notificatie",
        "label": "Offline notify",
        "tooltip": "",
        "place": "",
        "group": "e151206531f4336f",
        "order": 5,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Disable",
                "value": "Disable",
                "type": "str"
            },
            {
                "label": "60 seconds",
                "value": 60,
                "type": "num"
            },
            {
                "label": "120 seconds",
                "value": 120,
                "type": "num"
            },
            {
                "label": "180 seconds",
                "value": 180,
                "type": "num"
            },
            {
                "label": "240 seconds",
                "value": 240,
                "type": "num"
            },
            {
                "label": "300 seconds",
                "value": 300,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "offline",
        "topicType": "str",
        "className": "",
        "x": 560,
        "y": 1860,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "be19b012024f9cda",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Set device list",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 300,
        "y": 2020,
        "wires": [
            [
                "89eeb1701cf3357f"
            ]
        ]
    },
    {
        "id": "95d336bc9a027740",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 6",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption6",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1740,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "88332fce42200e46",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 7",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 9,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption7",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1780,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "f73fcf44abf3ad74",
        "type": "ui_text_input",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "label": "IDX option 8",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 14,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption8",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1820,
        "wires": [
            [
                "9d0c2e25a12525c3"
            ]
        ]
    },
    {
        "id": "7f3f4e68412e5f9a",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "set idx filter",
        "func": "let filter = [];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    if (msg.payload[i].type === \"Shelly Plug S\") {\n        filter.push(msg.payload[i].idx)\n    } else if (msg.payload[i].type === \"Shelly 2.5 shutter mode\") {\n        filter.push(msg.payload[i].idx)\n        if (msg.payload[i].idxoption1 === \"Not set\") {\n        } else if (msg.payload[i].idxoption1 === \"N/A\") {\n        } else {\n            filter.push(msg.payload[i].idxoption1)\n        }\n    } else if (msg.payload[i].type === \"Shelly Plus Plug S\") {\n        filter.push(msg.payload[i].idx)\n    } else if (msg.payload[i].type === \"Shelly 1pm mini\") {\n        filter.push(msg.payload[i].idx)\n        if (msg.payload[i].idxoption1 === \"Not set\") {\n        } else {\n            filter.push(msg.payload[i].idxoption1)\n        }\n    }\n}\n\nflow.set(\"dz-idx-filter\", filter);\nflow.set(\"dz-state\",{})\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "68a9c43e4cd47f8a",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "Set stored value",
        "func": "if (msg.payload === undefined) {\n  return;\n} else {\n  let devicename = msg.payload.split(\"/\")[0];\n  let settings = flow.get(\"sh2dz-idx\") || {};\n  let length = Object.keys(settings).length;\n  let type, idx, idxoption1, idxoption2, idxoption3, idxoption4, idxoption5, idxoption6, idxoption7, idxoption8, offline\n\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(settings);\n    let IDkey = keys[i];\n    let dev = settings[IDkey] || {};\n\n    if (dev.name === devicename) {\n      if (dev.type === \"unknown\") {\n        node.log(\"unknown\")\n      } else {\n        type = dev.type\n        type = { payload: type,}\n      }\n      if (dev.idx === undefined ) {\n        node.log(\"unknown\")\n      } else if (dev.idx === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idx = dev.idx\n        idx = { payload: idx, }\n      }\n      if (dev.idxoption1 === undefined || dev.idxoption1 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption1 = dev.idxoption1\n        idxoption1 = { payload: idxoption1, }\n      }\n      if (dev.idxoption2 === undefined || dev.idxoption2 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption2 = dev.idxoption2\n        idxoption2 = { payload: idxoption2, }\n      }\n      if (dev.idxoption3 === undefined || dev.idxoption3 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption3 = dev.idxoption3\n        idxoption3 = { payload: idxoption3, }\n      }\n      if (dev.idxoption4 === undefined || dev.idxoption4 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption4 = dev.idxoption4\n        idxoption4 = { payload: idxoption4, }\n      }\n      if (dev.idxoption5 === undefined || dev.idxoption5 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption5 = dev.idxoption5\n        idxoption5 = { payload: idxoption5, }\n      }\n      if (dev.idxoption6 === undefined || dev.idxoption6 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption6 = dev.idxoption6\n        idxoption6 = { payload: idxoption6, }\n      }\n      if (dev.idxoption7 === undefined || dev.idxoption7 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption7 = dev.idxoption7\n        idxoption7 = { payload: idxoption7, }\n      }\n      if (dev.idxoption8 === undefined || dev.idxoption8 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption8 = dev.idxoption8\n        idxoption8 = { payload: idxoption8, }\n      }\n      if (dev.offline === undefined || dev.offline === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        offline = dev.offline\n        offline = { payload: offline, }\n      }\n    }\n  }\n  return [type, idx, idxoption1, idxoption2, idxoption3, idxoption4, idxoption5, idxoption6, idxoption7, idxoption8, offline];\n}\n\nreturn;",
        "outputs": 11,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 1800,
        "wires": [
            [
                "193606ae91cb6945"
            ],
            [
                "fe2e561d181efb9a"
            ],
            [
                "7ed80bc4d1d1befe"
            ],
            [
                "57305f4f3cace6c9"
            ],
            [
                "1cc96017040251be"
            ],
            [
                "37c98da5574d1f2d"
            ],
            [
                "bd6f3e43f7b9a3d0"
            ],
            [
                "95d336bc9a027740"
            ],
            [
                "88332fce42200e46"
            ],
            [
                "f73fcf44abf3ad74"
            ],
            [
                "c9b7df9a4f724658"
            ]
        ]
    },
    {
        "id": "8ae89b198eaf3384",
        "type": "delay",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 210,
        "y": 1680,
        "wires": [
            [
                "68a9c43e4cd47f8a"
            ]
        ]
    },
    {
        "id": "9b3b3d9295118404",
        "type": "change",
        "z": "8bb526423a678cca",
        "g": "277baa548611193e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 1540,
        "wires": [
            [
                "fe2e561d181efb9a",
                "7ed80bc4d1d1befe",
                "57305f4f3cace6c9",
                "37c98da5574d1f2d",
                "1cc96017040251be",
                "193606ae91cb6945",
                "bd6f3e43f7b9a3d0",
                "c9b7df9a4f724658",
                "95d336bc9a027740",
                "88332fce42200e46",
                "f73fcf44abf3ad74"
            ]
        ]
    },
    {
        "id": "b8d149035da9a846",
        "type": "link out",
        "z": "8bb526423a678cca",
        "name": "Shelly manual test",
        "mode": "link",
        "links": [
            "ede2e147e77eabe6"
        ],
        "x": 4885,
        "y": 680,
        "wires": []
    },
    {
        "id": "d72e09a8a06ff957",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 relay 1Off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 140,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "aa4a236f21a58ca1",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Power relay 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1/power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "62.88",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 500,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "cd31431595de4e16",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Energy relay 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1/energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "23145",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 420,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "f356243ee1dabd5b",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Input 0 op 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 180,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "3e31535eaec72798",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Temperature",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/temperature",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "56.73",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 600,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "553f4b797e13dc3d",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Overtemperature",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/overtemperature",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2280,
        "y": 640,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "15af2a63b2736235",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Overtemp status",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/temperature_status",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Normal",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2280,
        "y": 680,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "7433885f835d6fcb",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/voltage",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "229.35",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2250,
        "y": 340,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "423a083a7cc1eb09",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 140,
        "wires": [
            [
                "d72e09a8a06ff957"
            ]
        ]
    },
    {
        "id": "71be32bb353ab3d9",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 500,
        "wires": [
            [
                "aa4a236f21a58ca1"
            ]
        ]
    },
    {
        "id": "2840507a4a8a78bd",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 420,
        "wires": [
            [
                "cd31431595de4e16"
            ]
        ]
    },
    {
        "id": "51da7ee77349da7c",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 180,
        "wires": [
            [
                "f356243ee1dabd5b"
            ]
        ]
    },
    {
        "id": "fa432107d110582c",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 600,
        "wires": [
            [
                "3e31535eaec72798"
            ]
        ]
    },
    {
        "id": "1fb31b176eb7fe78",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 640,
        "wires": [
            [
                "553f4b797e13dc3d"
            ]
        ]
    },
    {
        "id": "47b9efd88918d9f6",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 680,
        "wires": [
            [
                "15af2a63b2736235"
            ]
        ]
    },
    {
        "id": "73c70351b7b6d23d",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 340,
        "wires": [
            [
                "7433885f835d6fcb"
            ]
        ]
    },
    {
        "id": "aa89d16778a4f77e",
        "type": "link out",
        "z": "8bb526423a678cca",
        "name": "Shelly, test2",
        "mode": "link",
        "links": [
            "ede2e147e77eabe6"
        ],
        "x": 2615,
        "y": 560,
        "wires": []
    },
    {
        "id": "f4aa9cb4b65eabb1",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "gen1 Shelly 2.5",
        "func": "let d = new Date();\nlet savetopic = msg.topic;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n    let info = msg.topic.split(\"/\")[2];\n    let variable = msg.topic.split(\"/\")[4];\n    let shutter;\n\n    if (variable === \"command\") {\n        return;\n    }\n\n    if (info === \"roller\") {\n        let domoticz = flow.get(\"dz-state\") || {};\n        let idxstate = [];\n        let ID = \"idx \" + msg.payload.domoticz.idx\n        let dev = domoticz[ID] || {};\n        let length = Object.keys(domoticz).length;\n        let save = msg.payload;\n\n        for (let i = 0; i < length; i++) {\n            let keys = Object.keys(domoticz);\n            let IDkey = keys[i];\n            let dev = domoticz[IDkey] || {};\n            if (IDkey === ID) {\n                shutter = dev.shutter;\n            }\n        }\n\n        //Position\n        if (variable === \"pos\") {\n            dev.lasttime = d.getTime();\n            dev.offline = msg.payload.domoticz.offline;\n            dev.online = true;\n\n            if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n                msg.payload = null;\n            } else {\n                dev.shutter = msg.payload.output;\n                if (shutter === dev.shutter) {\n                    msg = null;\n                } else {\n                    msg = {\n                        topic: \"domoticz/in\",\n                        payload:\n                        {\n                            command: \"switchlight\",\n                            idx: Number(msg.payload.domoticz.idx),\n                            switchcmd: \"Set Level\",\n                            level: msg.payload.output\n                        }\n                    }\n                }\n            }\n           \n        //Store stop_reason\n        } else if (variable === \"stop_reason\") {\n            if (msg.payload.output === \"normal\") {\n                dev.state = \"stop\"\n                msg = null;\n            } else {\n                msg = null;\n            }\n        } else {\n            msg = null;\n        }\n        domoticz[ID] = dev;\n        idxstate.push(dev);\n\n        flow.set(\"dz-state\", domoticz);\n        return msg;\n        \n    }\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n    let shelly = flow.get(\"dz-state\") || {};\n    let idxshellystate = [];\n    let IDidx = \"idx \" + msg.payload.domoticz.idx\n    let dev = shelly[IDidx] || {};\n\n    if (msg.payload.domoticz.addon === \"shellies\") {\n      return;\n    } else {\n        if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n            if (dev.shutter === msg.payload.Level) {\n                return;\n            } else{\n                if (msg.payload.hasOwnProperty(\"Level\")) {\n                    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n                    msg.payload = msg.payload.Level;\n                } else if (msg.payload.nvalue == 1) {\n                    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n                    msg.payload = \"on\";\n                } else if (msg.payload.nvalue == 0) {\n                    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n                    msg.payload = \"off\";\n                }\n            }\n        }\n    }\n    dev.shutter = String(msg.payload);\n\n    shelly[IDidx] = dev;\n    idxshellystate.push(dev);\n\n    flow.set(\"dz-state\", shelly);\n    return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 840,
        "wires": [
            [
                "20cbb249d37b3205",
                "8c95c53727d84a96",
                "0ac0e432f8c14166"
            ]
        ]
    },
    {
        "id": "8a3a944ac86a8e87",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 relay 1 On",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 100,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "355c640e6566c694",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 100,
        "wires": [
            [
                "8a3a944ac86a8e87"
            ]
        ]
    },
    {
        "id": "66cd7749e5337512",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 relay 0 Off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 60,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "24dcf99d27dd20dc",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 60,
        "wires": [
            [
                "66cd7749e5337512"
            ]
        ]
    },
    {
        "id": "a9d2585b104b5760",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 relay 0 On",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 20,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "83cecfa60ce5b70e",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 20,
        "wires": [
            [
                "a9d2585b104b5760"
            ]
        ]
    },
    {
        "id": "ccb15938eea9df93",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Input 0 op 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 220,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "41d8dfe772392c5d",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 220,
        "wires": [
            [
                "ccb15938eea9df93"
            ]
        ]
    },
    {
        "id": "74abd26d07fb0240",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Input 1 op 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 260,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "33336072db3e11c9",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 260,
        "wires": [
            [
                "74abd26d07fb0240"
            ]
        ]
    },
    {
        "id": "a1eec65d9d3668ac",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Input 1 op 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 300,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "3e5a02abbd47d7a9",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 300,
        "wires": [
            [
                "a1eec65d9d3668ac"
            ]
        ]
    },
    {
        "id": "83c93b80a813c10b",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Power relay 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0/power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "30.88",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 460,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "80cfd7de1f5bec14",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 460,
        "wires": [
            [
                "83c93b80a813c10b"
            ]
        ]
    },
    {
        "id": "f040b1e94aefb0fb",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 Energy relay 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0/energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "17962",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 380,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "62bdbfffc3b6eaaf",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 380,
        "wires": [
            [
                "f040b1e94aefb0fb"
            ]
        ]
    },
    {
        "id": "32906713453bd831",
        "type": "json",
        "z": "8bb526423a678cca",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4650,
        "y": 680,
        "wires": [
            [
                "b8d149035da9a846"
            ]
        ]
    },
    {
        "id": "1127a4f28075c812",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "0e9f6298736d65c4",
        "name": "Shelly to MQTT server",
        "mode": "link",
        "links": [
            "a0024720d71c4146"
        ],
        "x": 165,
        "y": 340,
        "wires": []
    },
    {
        "id": "3cdffdceb4a7ab65",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "0e9f6298736d65c4",
        "name": "Shelly from MQTT server",
        "links": [
            "815c5ae767ffd619",
            "ce6f5c18fd49fbc1"
        ],
        "x": 575,
        "y": 300,
        "wires": [
            [
                "a1f4274021966266"
            ]
        ]
    },
    {
        "id": "bf76ce94069d98de",
        "type": "ui_switch",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "",
        "label": "Shelly incoming messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 5,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 340,
        "y": 1040,
        "wires": [
            [
                "2356776172fa8761",
                "53fb22e45bd76c8a"
            ]
        ]
    },
    {
        "id": "2356776172fa8761",
        "type": "gate",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 730,
        "y": 1020,
        "wires": [
            [
                "53fb22e45bd76c8a"
            ]
        ]
    },
    {
        "id": "952096682259fa64",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "name": "Debug switch empty payload",
        "func": "if (msg.payload === true) {\n    msg.topic = \"\"\n    msg.payload = \"\"\n    msg.debug_addon = \"\"\n}\nif (msg.payload === false) {\n    msg.payload = \"\"\n    msg.topic = \"\"\n    msg.debug_addon = \"\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 2260,
        "wires": [
            [
                "e21d6b70d15c104e",
                "4430cdc08221619e",
                "ec9642e584862d07"
            ]
        ]
    },
    {
        "id": "e21d6b70d15c104e",
        "type": "ui_text",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "group": "240e8c09f225dbd4",
        "order": 3,
        "width": 30,
        "height": 1,
        "name": "",
        "label": "Switch source:",
        "format": "{{msg.debug_addon}}",
        "layout": "row-left",
        "className": "",
        "x": 1100,
        "y": 2300,
        "wires": []
    },
    {
        "id": "844b778512545fe0",
        "type": "inject",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payloadType": "str",
        "x": 570,
        "y": 2320,
        "wires": [
            [
                "e21d6b70d15c104e",
                "5aaccf324d310e13",
                "4430cdc08221619e",
                "ec9642e584862d07"
            ]
        ]
    },
    {
        "id": "53fb22e45bd76c8a",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "5180eae08fc53811"
        ],
        "x": 875,
        "y": 1020,
        "wires": []
    },
    {
        "id": "5180eae08fc53811",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "name": "Shelly, show messages on UI",
        "links": [
            "53fb22e45bd76c8a",
            "2777813b9aacdb66",
            "4688098442e9083b"
        ],
        "x": 75,
        "y": 2260,
        "wires": [
            [
                "952096682259fa64"
            ]
        ]
    },
    {
        "id": "5aaccf324d310e13",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "name": "Set debug switch off",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2260,
        "wires": [
            [
                "fa0acbd6bf1f9e48"
            ]
        ]
    },
    {
        "id": "fa0acbd6bf1f9e48",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "name": "Shelly, Debug off",
        "mode": "link",
        "links": [
            "849f4abb82f1904e",
            "96f9f00e4c3dd4c6",
            "6a541ca465c81a0b"
        ],
        "x": 1555,
        "y": 2260,
        "wires": []
    },
    {
        "id": "849f4abb82f1904e",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "fa0acbd6bf1f9e48"
        ],
        "x": 155,
        "y": 1040,
        "wires": [
            [
                "bf76ce94069d98de"
            ]
        ]
    },
    {
        "id": "4430cdc08221619e",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "name": "Debug topic2payload",
        "func": "msg.payload = msg.topic\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2380,
        "wires": [
            [
                "6c9be1bc275168ed"
            ]
        ]
    },
    {
        "id": "6c9be1bc275168ed",
        "type": "ui_text",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "group": "240e8c09f225dbd4",
        "order": 1,
        "width": 30,
        "height": 1,
        "name": "",
        "label": "Topic:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1590,
        "y": 2380,
        "wires": []
    },
    {
        "id": "96f9f00e4c3dd4c6",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "fa0acbd6bf1f9e48"
        ],
        "x": 155,
        "y": 1120,
        "wires": [
            [
                "944e25a1280811f0"
            ]
        ]
    },
    {
        "id": "944e25a1280811f0",
        "type": "ui_switch",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "",
        "label": "Domoticz incoming messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 6,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 350,
        "y": 1120,
        "wires": [
            [
                "106dd4dc7fcf24bc",
                "2777813b9aacdb66"
            ]
        ]
    },
    {
        "id": "106dd4dc7fcf24bc",
        "type": "gate",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1130,
        "y": 1120,
        "wires": [
            [
                "2777813b9aacdb66"
            ]
        ]
    },
    {
        "id": "2777813b9aacdb66",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "5180eae08fc53811"
        ],
        "x": 1265,
        "y": 1120,
        "wires": []
    },
    {
        "id": "6a541ca465c81a0b",
        "type": "link in",
        "z": "8bb526423a678cca",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "fa0acbd6bf1f9e48"
        ],
        "x": 2395,
        "y": 1020,
        "wires": [
            [
                "77cf63b009a0e13e"
            ]
        ]
    },
    {
        "id": "77cf63b009a0e13e",
        "type": "ui_switch",
        "z": "8bb526423a678cca",
        "name": "",
        "label": "Shelly --> MQTT messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 4,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2570,
        "y": 1020,
        "wires": [
            [
                "d4b249b83b1a672c",
                "4688098442e9083b"
            ]
        ]
    },
    {
        "id": "d4b249b83b1a672c",
        "type": "gate",
        "z": "8bb526423a678cca",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 3000,
        "y": 1020,
        "wires": [
            [
                "4688098442e9083b"
            ]
        ]
    },
    {
        "id": "4688098442e9083b",
        "type": "link out",
        "z": "8bb526423a678cca",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "5180eae08fc53811"
        ],
        "x": 3125,
        "y": 1020,
        "wires": []
    },
    {
        "id": "8c95c53727d84a96",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "add button label",
        "func": "msg.debug_addon = \"Shelly --> MQTT messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2790,
        "y": 980,
        "wires": [
            [
                "d4b249b83b1a672c"
            ]
        ]
    },
    {
        "id": "def1e08c580b35e3",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "add button label",
        "func": "msg.debug_addon = \"Domoticz incoming messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 1080,
        "wires": [
            [
                "106dd4dc7fcf24bc"
            ]
        ]
    },
    {
        "id": "a28a45244ad2c324",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "add button label",
        "func": "msg.debug_addon = \"Shelly incoming messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 960,
        "wires": [
            [
                "2356776172fa8761"
            ]
        ]
    },
    {
        "id": "ec9642e584862d07",
        "type": "ui_text",
        "z": "8bb526423a678cca",
        "g": "fbb5adaf13346c8a",
        "group": "240e8c09f225dbd4",
        "order": 2,
        "width": 30,
        "height": 2,
        "name": "",
        "label": "Payload:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1080,
        "y": 2340,
        "wires": []
    },
    {
        "id": "20cbb249d37b3205",
        "type": "debug",
        "z": "8bb526423a678cca",
        "name": "gen1 shelly 2.5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2760,
        "y": 840,
        "wires": []
    },
    {
        "id": "3d8a114e98fb8dcf",
        "type": "switch",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Contain shelly message",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "events",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "status/switch",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "shellies",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 270,
        "y": 880,
        "wires": [
            [
                "a28a45244ad2c324",
                "14d33512c46bf3e9"
            ],
            [
                "14d33512c46bf3e9",
                "a28a45244ad2c324"
            ],
            [
                "d9a0b4db22f9b490",
                "a28a45244ad2c324"
            ]
        ]
    },
    {
        "id": "2f99fcb2c0796873",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\", \"dst\":\"Pomp wensput/events\", \"method\":\"NotifyStatus\", \"params\":{\"ts\":1713549431.88, \"input:0\":{\"id\":0, \"state\": true}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 540,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "348b6a804b9ee517",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 1PM ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1420,
        "y": 540,
        "wires": [
            [
                "2f99fcb2c0796873"
            ]
        ]
    },
    {
        "id": "ccda9a1eaab165dd",
        "type": "json",
        "z": "8bb526423a678cca",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 560,
        "wires": [
            [
                "aa89d16778a4f77e"
            ]
        ]
    },
    {
        "id": "9c5736b5cfc183fa",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\", \"dst\":\"Pomp wensput/events\", \"method\":\"NotifyStatus\", \"params\":{\"ts\":1713549431.88, \"input:0\":{\"id\":0, \"state\": false}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 580,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "b2cc692d4bfa6132",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 1PM OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1420,
        "y": 580,
        "wires": [
            [
                "9c5736b5cfc183fa"
            ]
        ]
    },
    {
        "id": "ce8f36ae9bcf6f26",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "gen3 Shelly 1PM mini",
        "func": "let d = new Date();\nlet idx;\n\nif (msg.payload.script.source === \"Shelly_gen2-3\") {\n  let info = msg.topic.split(\"/\")[1];\n  let input, output;\n\n  if (info === \"events\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID\n    if ((Object.keys(msg.payload[\"params\"])[1]) === \"input:0\") {\n      ID = \"idx:\" + msg.payload.domoticz.idx;\n    } else if ((Object.keys(msg.payload[\"params\"])[1]) === \"switch:0\") {\n      ID = \"idx:\" + msg.payload.domoticz.idxoption1;\n    }\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n    \n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input = dev.input;\n        output = dev.output;\n      }\n    }\n      \n    //Input\n    if ((Object.keys(msg.payload[\"params\"])[1]) === \"input:0\"){\n      let value, state;\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.params[\"input:0\"].state === true) {\n          dev.input = true;\n          value = 1;\n          state = \"On\"\n        } else if (msg.payload.params[\"input:0\"].state === false) {\n          dev.input = false;\n          value = 0;\n          state = \"Off\"\n        }\n        if (input == dev.input) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption1),\n              nvalue: value,\n              svalue1: state\n            }\n          }\n        }\n      }\n    //Output\n    } else if ((Object.keys(msg.payload[\"params\"])[1]) === \"switch:0\") {\n      let value, state;\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.params[\"switch:0\"].output === true) {\n          dev.output = true;\n          value = 1;\n          state = \"On\"\n        } else if (msg.payload.params[\"switch:0\"].output === false) {\n          dev.output = false;\n          value = 0;\n          state = \"Off\"\n        }\n        if (output == dev.output) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: value,\n              svalue1: state\n            }\n          }\n        }\n      }\n    } else {\n      return;\n    }\n\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return msg;\n    //return [[msg, apower, voltage, current, total]];\n  } \n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.gen === \"gen1\") {\n    msg.topic = msg.payload.domoticz.name + \"/command/\" + msg.payload.domoticz.sw;\n  } else if (msg.payload.domoticz.gen === \"gen2\") {\n    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  } else if (msg.payload.domoticz.gen === \"gen3\") {\n    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  } else {\n    return;\n  }\n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  if (msg.topic === \"domoticz/out\") {\n    return;\n  } else {\n    return msg;\n  }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2480,
        "y": 920,
        "wires": [
            [
                "be11eb72aef6c018",
                "8c95c53727d84a96",
                "0ac0e432f8c14166"
            ]
        ]
    },
    {
        "id": "be11eb72aef6c018",
        "type": "debug",
        "z": "8bb526423a678cca",
        "name": "gen3 shelly 1pm",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2760,
        "y": 920,
        "wires": []
    },
    {
        "id": "b7f073b9eec08170",
        "type": "json",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 2480,
        "wires": [
            [
                "1e04fb25dcd23555"
            ]
        ]
    },
    {
        "id": "a246587d211a29f6",
        "type": "debug",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Debug flow.get",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 2520,
        "wires": []
    },
    {
        "id": "855e86cd3590bb86",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Set flow.get test",
        "func": "let store =  msg.payload;\nflow.set(\"sh2dz-idx\", store);\nreturn [{payload:Object.values(store)}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 2480,
        "wires": [
            [
                "12f54806a8630b40"
            ]
        ]
    },
    {
        "id": "1e04fb25dcd23555",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Payload2Object",
        "func": "let store = msg.payload;\nlet msg2 = Object.assign({}, store);\nreturn [{payload:(msg2)}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 2480,
        "wires": [
            [
                "9d8d58f47fa94da0"
            ]
        ]
    },
    {
        "id": "9d8d58f47fa94da0",
        "type": "split",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 950,
        "y": 2480,
        "wires": [
            [
                "f4d73432594f661a"
            ]
        ]
    },
    {
        "id": "f4d73432594f661a",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "shelly2topic",
        "func": "let value = msg.payload.name\nmsg.topic = value;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 2480,
        "wires": [
            [
                "b06f27ca0cd6f9b0"
            ]
        ]
    },
    {
        "id": "b06f27ca0cd6f9b0",
        "type": "join",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1290,
        "y": 2480,
        "wires": [
            [
                "a246587d211a29f6",
                "855e86cd3590bb86",
                "58d4a3586587bac8"
            ]
        ]
    },
    {
        "id": "12f54806a8630b40",
        "type": "link out",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Shelly, Restore idx table (read file)",
        "mode": "link",
        "links": [
            "95081cdef9f1d15d"
        ],
        "x": 1625,
        "y": 2480,
        "wires": []
    },
    {
        "id": "2144c7794dc71175",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Get save location",
        "func": "delete msg.payload;\nlet destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 2480,
        "wires": [
            [
                "3119bcf6189c3819"
            ]
        ]
    },
    {
        "id": "f6178536c8704c1a",
        "type": "link in",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Shelly, start UI",
        "links": [
            "eeb0461989e33fa8"
        ],
        "x": 75,
        "y": 2480,
        "wires": [
            [
                "2144c7794dc71175"
            ]
        ]
    },
    {
        "id": "3119bcf6189c3819",
        "type": "file in",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "Read backup",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 410,
        "y": 2480,
        "wires": [
            [
                "b7f073b9eec08170"
            ]
        ]
    },
    {
        "id": "58d4a3586587bac8",
        "type": "function",
        "z": "8bb526423a678cca",
        "g": "085be1b91cdd3f1b",
        "name": "set idx filter",
        "func": "let filter = [];\nlet length = Object.keys(msg.payload).length;\n\nfor (var devN in msg.payload) {\n    let devInfo = msg.payload[devN];\n    if (devInfo.type === \"Shelly Plug S\") {\n        filter.push(devInfo.idx)\n    } else if (devInfo.type === \"Shelly 2.5 shutter mode\") {\n        filter.push(devInfo.idx)\n        if (devInfo.idxoption1 === \"Not set\") {\n        } else if (devInfo.idxoption1 === \"N/A\") {            \n        } else {\n            filter.push(devInfo.idxoption1)\n        }\n    } else if (devInfo.type === \"Shelly Plus Plug S\") {\n        filter.push(devInfo.idx)\n    } else if (devInfo.type === \"Shelly 1pm mini\") {\n        filter.push(devInfo.idx)\n        if (devInfo.idxoption1 === \"Not set\") {\n        } else {\n            filter.push(devInfo.idxoption1)\n        }\n    }\n}\n\nflow.set(\"dz-idx-filter\", filter);\nflow.set(\"dz-state\",{})\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 2520,
        "wires": [
            []
        ]
    },
    {
        "id": "17d94e111d9166ad",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\",\"dst\":\"Pomp wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1713556420.54,\"switch:0\":{\"id\":0,\"output\":true,\"source\":\"SHC\",\"timer_duration\":5,\"timer_started_at\":1713556420.54}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 460,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "d0ab1d946dd36867",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 1PM switch ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1400,
        "y": 460,
        "wires": [
            [
                "17d94e111d9166ad"
            ]
        ]
    },
    {
        "id": "b012d626b6c6edaa",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\",\"dst\":\"Pomp wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1713556420.54,\"switch:0\":{\"id\":0,\"output\":false,\"source\":\"SHC\",\"timer_duration\":5,\"timer_started_at\":1713556420.54}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 500,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "c822c09f100a4f23",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 1PM switch OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1400,
        "y": 500,
        "wires": [
            [
                "b012d626b6c6edaa"
            ]
        ]
    },
    {
        "id": "23b0100963675f54",
        "type": "function",
        "z": "8bb526423a678cca",
        "name": "gen1 Shelly 2.5",
        "func": "let d = new Date();\nlet energy, energy0, energy1, power, power0, power1, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n  let info = msg.topic.split(\"/\")[2];\n  let relaynr = msg.topic.split(\"/\")[3];\n  let variable = msg.topic.split(\"/\")[4];\n  let input0, input1, output0, output1, shutter;\n\n  if (variable === \"command\") {\n    return;\n  }\n\n  if (info === \"roller\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n      if (IDkey === ID) {\n        shutter = dev.shutter;\n      }\n    }\n\n    //energy output\n    if (variable === \"energy\") {\n      if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n        msg = null\n        energy = null\n      } else {\n        msg = null\n        energy = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(save.domoticz.idxoption5),\n            svalue: save.output + \"\\\";\\\"\" + 0,\n          }\n        }\n      }\n\n      //power output\n    } else if (variable === \"power\") {\n      if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n        msg = null\n        power = null\n      } else {\n        msg = null\n        power = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(save.domoticz.idxoption7),\n            svalue: save.output.toString(),\n          }\n        }\n      }\n\n      //Position\n    } else if (variable === \"pos\") {\n      if (dev.state === \"stop\") {\n        dev.lasttime = d.getTime();\n        dev.offline = msg.payload.domoticz.offline;\n        dev.online = true;\n\n        if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n          msg.payload = null;\n        } else {\n          dev.shutter = msg.payload.output;\n          if (shutter === dev.shutter) {\n            msg = null;\n          } else {\n            msg = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"switchlight\",\n                idx: Number(msg.payload.domoticz.idx),\n                switchcmd: \"Set Level\",\n                level: msg.payload.output\n              }\n            }\n          }\n        }\n      } else {\n        msg = null;\n      }\n\n      //Store stop_reason\n    } else if (variable === \"stop_reason\") {\n      if (msg.payload.output === \"normal\") {\n        dev.state = \"stop\"\n        msg = null;\n      } else {\n        msg = null;\n      }\n\n\n    } else {\n      if (msg.payload.output === \"stop\") {\n        if (Number(msg.payload.domoticz.idxoption5) === 0 || msg.payload.domoticz.idxoption5 === undefined || msg.payload.domoticz.idxoption5 === \"N/A\" || msg.payload.domoticz.idxoption5 === \"Not set\") {\n          energy = null;\n        } else {\n          energy = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption5),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(msg.payload.domoticz.idxoption7) === 0 || msg.payload.domoticz.idxoption7 === undefined || msg.payload.domoticz.idxoption7 === \"N/A\" || msg.payload.domoticz.idxoption7 === \"Not set\") {\n          power = null;\n        } else {\n          power = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption7),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n      msg = null;\n    }\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy, power, voltage, current, total]];\n  }\n\n  if (info === \"relay\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input0 = dev.input0;\n        input1 = dev.input1;\n        output0 = dev.output0;\n        output1 = dev.output1;\n      }\n    }\n\n    //Output\n    if (Number(relaynr) === 0) {\n      let val0;\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg.payload = null;\n      } else {\n        if (msg.payload.output === \"on\") {\n          dev.output0 = true;\n          val0 = 1;\n        } else if (msg.payload.output === \"off\") {\n          dev.output0 = false;\n          val0 = 0;\n        }\n        if (output0 == dev.output0) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: val0,\n            }\n          }\n        }\n      }\n    } else if (Number(relaynr) === 1) {\n      let val1;\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === \"on\") {\n          dev.output1 = true;\n          val1 = 1;\n        } else if (msg.payload.output === \"off\") {\n          dev.output1 = false;\n          val1 = 0;\n        }\n        if (output1 == dev.output1) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption1),\n              nvalue: val1,\n            }\n          }\n        }\n      }\n    }\n\n    //power output 0\n    if (dev.output0 === true && (Number(relaynr) === 0)) {\n      if (info === \"relay\") {\n        if (variable === \"energy\") {\n          if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n            energy0 = null\n          } else {\n            energy0 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption5),\n                svalue: save.output + \"\\\";\\\"\" + 0,\n              }\n            }\n          }\n        }\n        if (variable === \"power\") {\n          if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n            power0 = null\n          } else {\n            power0 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption7),\n                svalue: save.output.toString(),\n              }\n            }\n          }\n        }\n      }\n    } else if (dev.output0 === false) {\n      if (output0 == dev.output0) {\n        energy0 = null;\n      } else {\n        if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n          energy0 = null\n        } else {\n          energy0 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption5),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n          power0 = null\n        } else {\n          power0 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption7),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    //power output 1\n    if (dev.output1 === true && (Number(relaynr) === 1)) {\n      if (info === \"relay\") {\n        if (variable === \"energy\") {\n          if (Number(save.domoticz.idxoption6) === 0 || save.domoticz.idxoption6 === undefined || save.domoticz.idxoption6 === \"N/A\" || save.domoticz.idxoption6 === \"Not set\") {\n            energy1 = null\n          } else {\n            energy1 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption6),\n                svalue: save.output + \"\\\";\\\"\" + 0,\n              }\n            }\n          }\n        }\n        if (variable === \"power\") {\n          if (Number(save.domoticz.idxoption8) === 0 || save.domoticz.idxoption8 === undefined || save.domoticz.idxoption8 === \"N/A\" || save.domoticz.idxoption8 === \"Not set\") {\n            power1 = null\n          } else {\n            power1 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption8),\n                svalue: save.output.toString(),\n              }\n            }\n          }\n        }\n      }\n    } else if (dev.output1 === false) {\n      if (output1 == dev.output1) {\n        energy1 = null;\n      } else {\n        if (Number(save.domoticz.idxoption6) === 0 || save.domoticz.idxoption6 === undefined || save.domoticz.idxoption6 === \"N/A\" || save.domoticz.idxoption6 === \"Not set\") {\n          energy1 = null\n        } else {\n          energy1 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption6),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(save.domoticz.idxoption8) === 0 || save.domoticz.idxoption8 === undefined || save.domoticz.idxoption8 === \"N/A\" || save.domoticz.idxoption8 === \"Not set\") {\n          power1 = null\n        } else {\n          power1 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption8),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n\n  if (info === \"input\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input0 = dev.input0;\n        input1 = dev.input1;\n      }\n    }\n\n    //Input\n    if (Number(relaynr) === 0) {\n      let val0;\n      if (Number(msg.payload.domoticz.idxoption2) === 0 || msg.payload.domoticz.idxoption2 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === 1) {\n          dev.input0 = true;\n        } else if (msg.payload.output === 0) {\n          dev.input0 = false;\n        }\n        if (input0 == dev.input0) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption2),\n              nvalue: msg.payload.output,\n            }\n          }\n        }\n      }\n    } else if (Number(relaynr) === 1) {\n      if (Number(msg.payload.domoticz.idxoption3) === 0 || msg.payload.domoticz.idxoption3 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === 1) {\n          dev.input1 = true;\n        } else if (msg.payload.output === 0) {\n          dev.input1 = false;\n        }\n        if (input1 == dev.input1) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption3),\n              nvalue: msg.payload.output,\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n\n  if (info === \"voltage\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n    }\n\n    //Voltage\n    if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined) {\n      msg = null\n    } else {\n      msg = {\n        topic: \"domoticz/in\",\n        payload:\n        {\n          command: \"udevice\",\n          idx: Number(msg.payload.domoticz.idxoption4),\n          svalue: msg.payload.output,\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx \" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.addon === \"shellies\") {\n    if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n      msg.topic = msg.payload.domoticz.name + \"/relay/0/command\";\n      if (msg.payload.nvalue == 1) {\n        msg.payload = \"on\";\n        dev.output0 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.payload = \"off\";\n        dev.output0 = false;\n      }\n    } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption1)) {\n      msg.topic = msg.payload.domoticz.name + \"/relay/1/command\";\n      if (msg.payload.nvalue == 1) {\n        msg.payload = \"on\";\n        dev.output1 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.payload = \"off\";\n        dev.output1 = false;\n      }\n    }\n  } else {\n    if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n      if (msg.payload.hasOwnProperty(\"Level\")) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n        msg.payload = msg.payload.Level\n        dev.state = \"moving\"\n      } else if (msg.payload.nvalue == 1) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n        msg.payload = \"on\";\n        dev.output0 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n        msg.payload = \"off\";\n        dev.output0 = false;\n      }\n    } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption1)) {\n      if (msg.payload.hasOwnProperty(\"Level\")) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n        msg.payload = msg.payload.Level;\n        dev.state = \"moving\";\n      } else if (msg.payload.nvalue == 1) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/1/command\";\n        msg.payload = \"on\";\n        dev.output1 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/1/command\";\n        msg.payload = \"off\";\n        dev.output1 = false;\n      }\n    }\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "15c62e867c8c21c9",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 share position 95",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyswitch25-68C63AF96C39/roller/0/pos",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "95",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 240,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "87d1ce31c7dd5478",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 share position",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1350,
        "y": 240,
        "wires": [
            [
                "15c62e867c8c21c9"
            ]
        ]
    },
    {
        "id": "002debc73d158869",
        "type": "debug",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Shelly command",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 780,
        "wires": []
    },
    {
        "id": "4405d33910cebb0b",
        "type": "switch",
        "z": "8bb526423a678cca",
        "g": "8b58851243a79e8e",
        "name": "Contain shelly command",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "command",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 800,
        "wires": [
            [
                "002debc73d158869"
            ],
            [
                "3d8a114e98fb8dcf"
            ]
        ]
    },
    {
        "id": "44f4a9ccdd3bb35a",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 share position 90",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyswitch25-68C63AF96C39/roller/0/pos",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "90",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 280,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "79d23718f0e01902",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 2.5 share position",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1350,
        "y": 280,
        "wires": [
            [
                "44f4a9ccdd3bb35a"
            ]
        ]
    },
    {
        "id": "9ccb45cb18dbef78",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly plus plug",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Drink fontein/status/switch:0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"source\":\"mqtt\",\"output\":true,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1640,
        "y": 340,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "e13fd7aca2ab5ed5",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly plus plug ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1390,
        "y": 340,
        "wires": [
            [
                "9ccb45cb18dbef78"
            ]
        ]
    },
    {
        "id": "5a1b8f23e8e64181",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly plus plug",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Drink fontein/status/switch:0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"source\":\"mqtt\",\"output\":false,\"apower\":0,\"voltage\":0,\"current\":0,\"aenergy\":{\"total\":39.236,\"by_minute\":[0.429,1.718,0.859],\"minute_ts\":1713723900},\"temperature\":{\"tC\":37.8,\"tF\":100}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1640,
        "y": 380,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "9c3edd3b65960657",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly plus plug OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1390,
        "y": 380,
        "wires": [
            [
                "5a1b8f23e8e64181"
            ]
        ]
    },
    {
        "id": "31eef8f2237ab2d4",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 1pm gen3 status output true",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/status/switch:0 ",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"apower\":0,\"current\":0,\"output\":true,\"source\":\"timer\",\"timer_duration\":null,\"timer_started_at\":null}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1600,
        "y": 620,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "4d9366ca5db82d33",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 1PM status",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1350,
        "y": 620,
        "wires": [
            [
                "31eef8f2237ab2d4"
            ]
        ]
    },
    {
        "id": "6dd85f4e78787062",
        "type": "change",
        "z": "8bb526423a678cca",
        "name": "Shelly 1pm gen3 status output false",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/status/switch:0 ",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0,\"apower\":0,\"current\":0,\"output\":false,\"source\":\"timer\",\"timer_duration\":null,\"timer_started_at\":null}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1600,
        "y": 660,
        "wires": [
            [
                "ccda9a1eaab165dd"
            ]
        ]
    },
    {
        "id": "bb6732fad2ac3d7d",
        "type": "inject",
        "z": "8bb526423a678cca",
        "name": "Shelly 1PM status",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1350,
        "y": 660,
        "wires": [
            [
                "6dd85f4e78787062"
            ]
        ]
    },
    {
        "id": "c38f18ee68cc084b",
        "type": "ui_spacer",
        "z": "8bb526423a678cca",
        "name": "spacer",
        "group": "240e8c09f225dbd4",
        "order": 7,
        "width": 9,
        "height": 1
    },
    {
        "id": "e6ffe1b28d49f4ed",
        "type": "mqtt-broker",
        "name": "",
        "broker": "192.168.178.14",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "d823ccdecb8e433a",
        "type": "ui_group",
        "name": "shelly update",
        "tab": "e3edb57efc8062a5",
        "order": 2,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "53b94e9a48b9cb3e",
        "type": "ui_group",
        "name": "Version number",
        "tab": "e3edb57efc8062a5",
        "order": 1,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ecbbb13f9bc2e1f2",
        "type": "ui_group",
        "name": "",
        "tab": "e3edb57efc8062a5",
        "order": 6,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5d07dbcaa2c15860",
        "type": "ui_group",
        "name": "status table",
        "tab": "e3edb57efc8062a5",
        "order": 4,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e151206531f4336f",
        "type": "ui_group",
        "name": "Idx table",
        "tab": "e3edb57efc8062a5",
        "order": 3,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "61d922efb8a113fa",
        "type": "ui_group",
        "name": "URL",
        "tab": "e3edb57efc8062a5",
        "order": 5,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "240e8c09f225dbd4",
        "type": "ui_group",
        "name": "Debug messages",
        "tab": "e3edb57efc8062a5",
        "order": 5,
        "disp": true,
        "width": 30,
        "collapse": false,
        "className": ""
    },
    {
        "id": "e3edb57efc8062a5",
        "type": "ui_tab",
        "name": "Shelly devices",
        "icon": "dashboard",
        "order": 3,
        "disabled": false,
        "hidden": false
    }
]
