[
    {
        "id": "014bce9630cee13d",
        "type": "tab",
        "label": "V1 Shelly2Domoticz",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "73f5c74c76c54c87",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Receive shelly messages",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "7bd5bdb52cc2610c",
            "6e88df76a40ee5ae",
            "21a43ab534fefec4",
            "bf4f82a93656fb1b",
            "337c524cc4d460bb",
            "dfbb19f1974960be",
            "6fa45a9ed8a716e3",
            "86952b6ef3ada7ef",
            "fe3554b170178671",
            "6df6f9ea5f19a2d9",
            "86214df58ae13b4e",
            "18c55140d6034be0",
            "73b57c3aa8922a0b",
            "6225acbda42e4355",
            "e8be1692a322a0ee",
            "5f3bcb962f59cba9",
            "6a607d15db6ab0ae",
            "022f8f2ecb6be7ed",
            "e0df4111043ee574",
            "bca90b0c61805c9f",
            "265a7e03748e48b3",
            "915dfbe3b92ee028",
            "9f31b851488855ad",
            "98e57f7ff629d9b2",
            "a7df550693ea6f33",
            "709cb410f4aa0efb",
            "47b7c93947b1f26a"
        ],
        "x": 34,
        "y": 739,
        "w": 1632,
        "h": 422
    },
    {
        "id": "838d2403b660c12a",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Central MQTT settings",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "e6f23ffc5f379c0e",
            "0d1c8ee346214645",
            "70c57cd0b1560206",
            "56860753c5968233",
            "3b0722459279c780",
            "0df306c3cce61c15"
        ],
        "x": 34,
        "y": 259,
        "w": 672,
        "h": 122
    },
    {
        "id": "14bf633fafcb566b",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Central save file location",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "f59fd8cdcc7130b8",
            "6e02dd61154ee3c7",
            "160b6453afc0d67c",
            "455e619810a41ff3",
            "0aa78aca58d88556",
            "2b544f18baa51578"
        ],
        "x": 34,
        "y": 119,
        "w": 432,
        "h": 122
    },
    {
        "id": "caa93318ac4a6768",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Download knop flows.json",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "5899d173add8aad1",
            "81bbe5adbfe48052",
            "08fc553402b638ae",
            "4c6b0578ceba6285",
            "1c00afaa1339e635",
            "d811e5bf91815529",
            "fe8999794acd76d2",
            "3832224304c5b914",
            "898e191d4727745a",
            "a9a3a25c30dd6564",
            "311cf9c380b09b98",
            "145e6b9ced901126"
        ],
        "x": 34,
        "y": 2579,
        "w": 1632,
        "h": 122
    },
    {
        "id": "7aeaf1cd1c87b811",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Save file location",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "c4f400f706431fca",
            "7f29e1217af977d5",
            "3e76208b467d3bf3",
            "5544b26d64b060a6",
            "de6c39eaa0ba4286",
            "552774af28f7338a",
            "d58f131e9b602def",
            "fde7411c91ce324f",
            "7f3876eac033e454",
            "139a7d0257f004db",
            "27b9111680cb7c05",
            "396e35a1d32b1ef4",
            "1333c76bcc465e75",
            "e95c6af36aa0383f",
            "d81414fee16d756f",
            "64cb0b9f42d57b2e",
            "b7d1cf93f6d31d8e",
            "0482e6be8e100415"
        ],
        "x": 34,
        "y": 2719,
        "w": 1632,
        "h": 282
    },
    {
        "id": "54c1b9a97dcabe1d",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Shelly status list",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "9e6c5b8e5b80b749",
            "390133a2664e1bcd",
            "0d5bb70216a23ba6",
            "03523c5ceaf8e165",
            "02197b5c825733e3",
            "93acda876d6342a3",
            "5160cd2f3009f5e2",
            "66181444cc8ccc14",
            "f508848cfb3b905a"
        ],
        "x": 34,
        "y": 2079,
        "w": 1632,
        "h": 122
    },
    {
        "id": "aeb50f6f6458dd04",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Shelly IDX table",
        "style": {
            "stroke": "#3f93cf",
            "label": true
        },
        "nodes": [
            "2f93587300745922",
            "1fbc2a41de1f81b7",
            "025660def2133bcd",
            "fac4bd765c822b09",
            "17f88a48f74efe89",
            "870e7cf3b6e14b26",
            "aa289adfb7a90258",
            "4c71ba7862a7991d",
            "4e4472bc0363db90",
            "d70969a86f3fd6f0",
            "f475c5a3cf630886",
            "4f8d0cd8d65f76c4",
            "216f27245c48f89c",
            "2fb0671e822b55b8",
            "0b6f0127a51a5794",
            "2312178d86339f5a"
        ],
        "x": 34,
        "y": 1179,
        "w": 1632,
        "h": 202
    },
    {
        "id": "0309977c54ef868e",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Flow update nodes",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "7560aebf115ff37e",
            "c40e0926f4d9191f",
            "f9c8568712e4c6fc",
            "4aec194c155291c9",
            "77396a8f3c62e703",
            "c5c4c92c14f823f4",
            "cb4af16d862b8704",
            "19aee30154ceb34d",
            "9c1dab7fe8516d2a",
            "b9afaabc88e458df",
            "ace7db1b3c3118f0",
            "a556ba50e320ea35"
        ],
        "x": 34,
        "y": 439,
        "w": 752,
        "h": 262
    },
    {
        "id": "a0c043a73758d49b",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "IDX shelly tabel",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "081ad32ef73f0665",
            "d235df133b8ae5e9",
            "11ad633a4b29c1a1",
            "9fdd46eed38663c4",
            "459f9cefd7bed137",
            "21c8183ee9d9c0f7",
            "427dd897c6e891e2",
            "749f2e80124691b1",
            "4975d0fce7ab243e",
            "e05f22c2f65c3f2b",
            "54bc9f402683fdba",
            "fae8f67d3f65ac90",
            "6c59b4448b8a83e9",
            "7a30883b06858276",
            "35466ac1bfd4c2ee",
            "173e5476f10c6083",
            "29ec599449db2bc6",
            "c2b7a71b63a94da5",
            "b6a7dba6f12d5dfa",
            "6e7505348b6ade1e",
            "8812399cb0503b07",
            "040c2eaf08b37023",
            "ea1cd12882fe62f7",
            "6a23b269e1643faf",
            "550202f276b4e72b",
            "672b35d8fb3307ef",
            "e9a5b262408d6ea9",
            "04bf803a8d7fb812",
            "78c237144ef3eece",
            "4a05ac11c0b41cc7",
            "a86cf831495d53ae"
        ],
        "x": 34,
        "y": 1399,
        "w": 1632,
        "h": 662
    },
    {
        "id": "a36e460dd828ad01",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "shelly plug s",
        "style": {
            "label": true
        },
        "nodes": [
            "a9628f9152635559",
            "ce8d7e01db365347",
            "7598ca4c96174afa",
            "80615d2f35822dad",
            "a7ec4a729dfa69c6",
            "ef0c31489fca381d"
        ],
        "x": 4134,
        "y": 599,
        "w": 452,
        "h": 162
    },
    {
        "id": "b82b070a33fa8cd7",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Shelly plus plug s",
        "style": {
            "label": true
        },
        "nodes": [
            "0c72df2661b2e676",
            "646496ef910afd8e",
            "ee274ead99ab8199",
            "8c704db0ca75bed5",
            "4c4e3045c84acb2e",
            "df8a799cbf8b474d",
            "201c197b3e398468",
            "3ac37b30f3b8c41d",
            "19287b580d62a6b4",
            "d9004f4eba85befc",
            "3aead30b11bc9ca1",
            "9a680add2468703b",
            "c07381c22e92f51b",
            "28413473259527d3",
            "f398748840b73797",
            "04c964dd7417797f",
            "9e8a25841cdeb82b"
        ],
        "x": 4014,
        "y": 219,
        "w": 732,
        "h": 362
    },
    {
        "id": "b3137b38ca33dfeb",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Debug field",
        "style": {
            "stroke": "#3f93cf",
            "label": true,
            "color": "#3f93cf"
        },
        "nodes": [
            "874e52f1c09dd752",
            "262cdef7738fcde0",
            "df379d698487f160",
            "63f368d85c94ec56",
            "588d0eedab16a672",
            "4b735cc462e55242",
            "1742d6dac06785ee",
            "d8d6827992caba86",
            "1e7e4ce2e9dd64df"
        ],
        "x": 34,
        "y": 2219,
        "w": 1632,
        "h": 202
    },
    {
        "id": "18852a505197e53b",
        "type": "group",
        "z": "014bce9630cee13d",
        "name": "Set flow.get(tztest) na deploy",
        "style": {
            "label": true,
            "stroke": "#3f93cf",
            "color": "#3f93cf"
        },
        "nodes": [
            "9109c4d8fee2bdb8",
            "ad1c49aa6ab0d1fe",
            "188632209b4a081e",
            "c4b8d8a9736812b3",
            "0b10e0257f9e36db",
            "4b454a5eba8e9733",
            "b147434c8839e7b0",
            "c7b55ab3a1ba3ed1",
            "d494b5cd53674e51",
            "299933034d1680d9",
            "4592fa5aaa1228be",
            "3e8fddf55325e3a0"
        ],
        "x": 34,
        "y": 2439,
        "w": 1632,
        "h": 122
    },
    {
        "id": "7afdb738cc4c4521",
        "type": "comment",
        "z": "014bce9630cee13d",
        "name": "V1_21-04-2024_R1",
        "info": "<b>V1 21-04-2024 R1: </b><br>\n- New device added \"Shelly 1pm mini\" (only switch functions, not power reading)<br>\n<b>V1 03-02-2024 R1 beta: </b><br>\n- Bug: switch number was not stored in data-file <br>\n<b>V1 28-05-2023 R1 beta: </b><br>\n<p style=\"color:red\">unfortunately, by adding shelly 2.5, saving configuration has had to change <br> \nAs a result, the configuration of the older version cannot be read and the configuration will have to be redone </p>\n- New device added \"Shelly 2.5\" (only as relay/input module, not as shutter module (work in progress)) <br>\n<b>V1 26-05-2023 R1 beta: </b><br>\n- New device added \"Shelly Plug S\" <br>\n- When select device with a known config, the config is written in setup-nodes <br>\n- Announce message are stopped in the flow <br>\n<b>V1 24-05-2023 R1 beta: </b><br>\n- \"Show discovered shellies\" button added. To prevent that pull-down setup menu's clear itself <br>\n  &nbsp&nbsp&nbsp&nbsp It is not a network discovery option. The shelly first needs to send a message, before it will be added <br>\n- Not (yet) supported option added. To already add those devices to the config <br>\n<b>V1 18-05-2023 R1 beta: </b><br>\n- The first release of the shelly flow <br>\n- Only device \"Shelly Plus Plug S\" is available <br>",
        "x": 110,
        "y": 40,
        "wires": []
    },
    {
        "id": "5899d173add8aad1",
        "type": "http in",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "url": "/shellyflow.json",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 2660,
        "wires": [
            [
                "08fc553402b638ae"
            ]
        ]
    },
    {
        "id": "81bbe5adbfe48052",
        "type": "http response",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 770,
        "y": 2660,
        "wires": []
    },
    {
        "id": "08fc553402b638ae",
        "type": "http request",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "body",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/flows.json",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 350,
        "y": 2660,
        "wires": [
            [
                "d811e5bf91815529"
            ]
        ]
    },
    {
        "id": "4c6b0578ceba6285",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 2620,
        "wires": [
            [
                "1c00afaa1339e635"
            ]
        ]
    },
    {
        "id": "1c00afaa1339e635",
        "type": "http request",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/version",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 310,
        "y": 2620,
        "wires": [
            [
                "145e6b9ced901126"
            ]
        ]
    },
    {
        "id": "7560aebf115ff37e",
        "type": "comment",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Wat aanpassen bij een nieuwe release",
        "info": "- De \"comment\" node van de release notes.\n- Node \"UPDATE RELEASE\", de versie in aanpassen.\n- Node \"SCRIPT VERSION\", de versie in aanpassen.\n- Op github de \"version\" file aanpassen.\n- Op github de \"releasenotes\" file aanpassen.",
        "x": 210,
        "y": 580,
        "wires": []
    },
    {
        "id": "d811e5bf91815529",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "Make http header",
        "func": "let store = flow.get(\"version\")\nmsg.headers['Content-Disposition'] = 'attachment; filename=\"Shelly-' + store + '.json\"'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 2660,
        "wires": [
            [
                "81bbe5adbfe48052"
            ]
        ]
    },
    {
        "id": "3832224304c5b914",
        "type": "http request",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/releasenotes",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1090,
        "y": 2620,
        "wires": [
            [
                "a9a3a25c30dd6564"
            ]
        ]
    },
    {
        "id": "a9a3a25c30dd6564",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "Check response github",
        "func": "if (msg.statusCode === 200 || 201) {\n    return msg;\n} else {\n    msg.payload = '<p style=\"color:red;\">Error loading release notes from github</p><br><a href=\"https://raw.githubusercontent.com/Hoeby/V1-Shelly-Nodered-flow/main/releasenotes\" target=\"_blank\">Hyperlink to github, for the release notes</a>'\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 2620,
        "wires": [
            [
                "898e191d4727745a"
            ]
        ]
    },
    {
        "id": "c40e0926f4d9191f",
        "type": "comment",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Welke modules installeren voor deze flow",
        "info": "Via manage pallette, onderstaande modules toevoegen\n- node-red-dashboard\n- node-red-node-ui-table",
        "x": 220,
        "y": 620,
        "wires": []
    },
    {
        "id": "7bd5bdb52cc2610c",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly, MQTT ",
        "links": [
            "0d1c8ee346214645",
            "56e87e4e6be4dd76",
            "b96f1de2c6def3bd",
            "d0bc25e5421e0c7f"
        ],
        "x": 75,
        "y": 860,
        "wires": [
            [
                "21a43ab534fefec4",
                "47b7c93947b1f26a"
            ]
        ]
    },
    {
        "id": "e6f23ffc5f379c0e",
        "type": "mqtt in",
        "z": "014bce9630cee13d",
        "g": "838d2403b660c12a",
        "name": "Messages from MQTT-server",
        "topic": "#",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "e6ffe1b28d49f4ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 360,
        "y": 340,
        "wires": [
            [
                "0d1c8ee346214645"
            ]
        ]
    },
    {
        "id": "0d1c8ee346214645",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "838d2403b660c12a",
        "name": "Shelly, Central MQTT-IN",
        "mode": "link",
        "links": [
            "7bd5bdb52cc2610c"
        ],
        "x": 665,
        "y": 320,
        "wires": []
    },
    {
        "id": "70c57cd0b1560206",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "838d2403b660c12a",
        "name": "Shelly, Messages to MQTT-server",
        "links": [
            "a38242331e04ee32"
        ],
        "x": 75,
        "y": 320,
        "wires": [
            [
                "56860753c5968233",
                "3b0722459279c780"
            ]
        ]
    },
    {
        "id": "56860753c5968233",
        "type": "mqtt out",
        "z": "014bce9630cee13d",
        "g": "838d2403b660c12a",
        "name": "Messages to MQTT-server",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "e6ffe1b28d49f4ed",
        "x": 360,
        "y": 300,
        "wires": []
    },
    {
        "id": "6e88df76a40ee5ae",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly, Shelly received message",
        "mode": "link",
        "links": [
            "5160cd2f3009f5e2",
            "2f93587300745922",
            "6a776ed98fa7d55f"
        ],
        "x": 1435,
        "y": 900,
        "wires": []
    },
    {
        "id": "fe8999794acd76d2",
        "type": "ui_button",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "",
        "group": "d823ccdecb8e433a",
        "order": 1,
        "width": 30,
        "height": 1,
        "passthru": false,
        "label": "{{text}}",
        "tooltip": "",
        "color": "white",
        "bgcolor": "{{background}}",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "show",
        "topicType": "str",
        "x": 890,
        "y": 2620,
        "wires": [
            [
                "3832224304c5b914"
            ]
        ]
    },
    {
        "id": "f9c8568712e4c6fc",
        "type": "ui_text",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "group": "53b94e9a48b9cb3e",
        "order": 1,
        "width": 30,
        "height": 2,
        "name": "Top text info tab",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 680,
        "y": 500,
        "wires": []
    },
    {
        "id": "898e191d4727745a",
        "type": "ui_template",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "group": "ecbbb13f9bc2e1f2",
        "name": "",
        "order": 1,
        "width": 30,
        "height": 1,
        "format": "<div ng-init=\"init()\" id=\"pin_insert\" class=\"dialog\">\n    \n    <div class=\"dialog_content\">\n        \n        <div class=\"dialog_header\">\n            <h2 style=\"margin:10px\">Release notes</h2>\n        </div>\n        \n        <div class=\"dialog_body\">\n            <div ng-bind-html=\"msg.payload\" style=\"height:400px;width:100%;margin: 4px 2px;overflow:auto;\"></div>\n            <!--<div ng-bind-html=\"msg.payload\"></div>-->\n            <form action=\"/shellyflow.json\" method=\"get\"><input type=\"submit\" class=\"buttons\" value=\"Download\" name=\"Submit\" id=\"frm1_submit\"/></form>\n            <button class=\"buttoncl\" id=\"myCls\" ng-click=\"closeDialog()\">Close</button>\n        </div> \n    </div> \n</div> \n\n<style>\n\n/* The Dialog (background) */\n.dialog {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    z-index: 9999; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    color : rgb(255,255,255);\n\tbackground-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n    -webkit-transform: translateZ(0px);\n    -webkit-transform: translate3d(0,0,0);\n    -webkit-perspective: 1000;\n}\n\n.dialog_content {\n\tposition: absolute;\n    background-color: rgb(51,51,51);\n    left: 25%;\n    top: 30px;\n    border-radius: 3px;\n    padding: 0;\n    width: 50%;\n    /*height: 70%;*/\n    height: 550px;\n    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);\n    -webkit-animation-name: animatetop;\n    animation-name: animatetop;\n    animation-duration: 0.4s;\n}\n\n/* Dialog Header */\n.dialog_header {\n    padding: 2px 16px;\n    background-color: rgb(20,117,120);\n    border-radius: 3px 3px 0 0;\n    color: white;\n}\n\n/* Dialog Body */\n.dialog_body {padding: 5px;}\n\n/* The Close Button */\n.close {\n    color: #fff;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n}\n\n.close:hover,\n.close:focus {\n    color: #1565C0;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n\n.btn1 {\n  color : rgb(255,255,255);\n  background-color: rgb(20,117,120);\n  border-radius: 3px 3px 3px 3px;\n  font-size: 16px;\n}\n\n/* Button style */\n    .buttoncl {\n        position: absolute;\n        border: none;\n        /*border-radius: 2px;*/\n        padding: 15px 4.4%;\n        font-size: 16px;\n        font-weight:550;\n        font-family:arial;\n        margin: 4px 2px;\n        /*text-transform: uppercase;*/\n        display: inline-block;\n        cursor: pointer;\n        color: white;\n        background-color:  #0A8085;\n        outline: none;\n        left: 85%;\n        top: 88%;\n    } \n    \n    .buttons {\n        position: absolute;\n        background-color: #0A8085;\n        border: none;\n        color: #FFF7E0; \n        padding: 15px 4.4%;\n        text-align: center;\n        text-decoration: none;\n        display: inline-block;\n        font-size: 16px;\n        font-weight:550;\n        font-family:arial;\n        margin: 4px 2px;\n        cursor: pointer;\n        left: 65%;\n        top: 88%;\n    }\n\n</style>\n\n<script>\nvar dialog;\n\n\n/* ==== */\n(function(scope) {\n    \n    scope.passcode = \"\";\n    \n    scope.init = function() {\n        scope.send({payload : \"init\"});\n\t\tscope.passcode = \"\";\n        //Hide the md-panel\n        $('#pin_insert').parent().parent().css(\"display\", \"none\");\n        //This trick make it works on smartphones too :)\n        dialog = $('#pin_insert').detach();\n        //dialog.appendTo(document.body); // This leaves ghost numpads if pinpad is not opened!\n    }\n    \n    scope.showDialog = function() {\n        dialog.appendTo(document.body); // better to add the body only when the numpad is displayed (seams to be removed automatically)\n        dialog.css(\"display\", \"block\");\n    }\n    \n    scope.closeDialog = function(){\n        dialog.css(\"display\", \"none\");\n\t\tscope.send({payload : scope.passcode});\n    }\n     \n\n    scope.$watch('msg', function(data) {\n        if(data && data.topic){\n            switch(data.topic){\n               case \"show\":\n\t\t\t\t\t\tscope.passcode = \"\";\n                        scope.showDialog();\n                break;\n                case \"close\": \n                    dialog.css(\"display\", \"none\");\n                break;\n            }\n        }\n    });\n})(scope);\n\n</script>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1580,
        "y": 2620,
        "wires": [
            []
        ]
    },
    {
        "id": "f59fd8cdcc7130b8",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "14bf633fafcb566b",
        "name": "Pi file save location",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/home/pi/domoticz/plugins/shelly",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 160,
        "wires": [
            [
                "6e02dd61154ee3c7"
            ]
        ]
    },
    {
        "id": "6e02dd61154ee3c7",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "14bf633fafcb566b",
        "name": "Shelly, Pi save location",
        "mode": "link",
        "links": [
            "d58f131e9b602def"
        ],
        "x": 425,
        "y": 160,
        "wires": []
    },
    {
        "id": "4aec194c155291c9",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "get file location",
        "func": "let location = flow.get(\"savefiledestination\")\nmsg.payload = \"<center>Data save folder: \" + location + \"</center>\"\nmsg.topic = \"Actuel version: <b>V1_18-05-2023_R1</b>\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 480,
        "wires": [
            [
                "19aee30154ceb34d"
            ]
        ]
    },
    {
        "id": "77396a8f3c62e703",
        "type": "comment",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Save data locaties",
        "info": "Native system:\n/home/pi/domoticz/plugins/shelly\n\nDocker system:\n/data/saved-files/shelly",
        "x": 150,
        "y": 660,
        "wires": []
    },
    {
        "id": "c4f400f706431fca",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 850,
        "y": 2760,
        "wires": [
            [
                "e95c6af36aa0383f"
            ]
        ]
    },
    {
        "id": "7f29e1217af977d5",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Get save location pi",
        "func": "let destination = msg.payload;\nmsg.filename = destination + \"/testPIdirectory\";\nflow.set(\"savefiledestination\", destination);\nmsg.delay = 5000;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 2800,
        "wires": [
            [
                "b7d1cf93f6d31d8e"
            ]
        ]
    },
    {
        "id": "3e76208b467d3bf3",
        "type": "catch",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "",
        "scope": [
            "7ee6eacc2a5d9cd1",
            "b7d1cf93f6d31d8e"
        ],
        "uncaught": false,
        "x": 110,
        "y": 2880,
        "wires": [
            [
                "fde7411c91ce324f"
            ]
        ]
    },
    {
        "id": "5544b26d64b060a6",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Get save location docker",
        "func": "let destination = msg.payload;\nmsg.filename = destination + \"/testDOCKERdirectory\";\nflow.set(\"savefiledestination\", destination);\nmsg.delay = 5000;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 2880,
        "wires": [
            [
                "0482e6be8e100415"
            ]
        ]
    },
    {
        "id": "de6c39eaa0ba4286",
        "type": "catch",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "",
        "scope": [
            "082e0f0318b184c7",
            "0482e6be8e100415"
        ],
        "uncaught": false,
        "x": 110,
        "y": 2960,
        "wires": [
            [
                "139a7d0257f004db"
            ]
        ]
    },
    {
        "id": "160b6453afc0d67c",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "14bf633fafcb566b",
        "name": "Docker file save location",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/data/saved-files/shelly",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "455e619810a41ff3"
            ]
        ]
    },
    {
        "id": "455e619810a41ff3",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "14bf633fafcb566b",
        "name": "Shelly, Docker save location",
        "mode": "link",
        "links": [
            "7f3876eac033e454"
        ],
        "x": 425,
        "y": 200,
        "wires": []
    },
    {
        "id": "0aa78aca58d88556",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "14bf633fafcb566b",
        "name": "Shelly, Pi save location",
        "links": [
            "552774af28f7338a"
        ],
        "x": 75,
        "y": 160,
        "wires": [
            [
                "f59fd8cdcc7130b8"
            ]
        ]
    },
    {
        "id": "2b544f18baa51578",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "14bf633fafcb566b",
        "name": "Shelly, Docker save location",
        "links": [
            "fde7411c91ce324f"
        ],
        "x": 75,
        "y": 200,
        "wires": [
            [
                "160b6453afc0d67c"
            ]
        ]
    },
    {
        "id": "552774af28f7338a",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Shelly, Start after deploy",
        "mode": "link",
        "links": [
            "9c1dab7fe8516d2a",
            "0aa78aca58d88556"
        ],
        "x": 1625,
        "y": 2760,
        "wires": []
    },
    {
        "id": "d58f131e9b602def",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Shelly, Pi data save location",
        "links": [
            "6e02dd61154ee3c7"
        ],
        "x": 335,
        "y": 2800,
        "wires": [
            [
                "7f29e1217af977d5"
            ]
        ]
    },
    {
        "id": "fde7411c91ce324f",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Shelly, Get docker save location",
        "mode": "link",
        "links": [
            "2b544f18baa51578"
        ],
        "x": 265,
        "y": 2880,
        "wires": []
    },
    {
        "id": "7f3876eac033e454",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Shelly, Docker data save location",
        "links": [
            "455e619810a41ff3"
        ],
        "x": 335,
        "y": 2880,
        "wires": [
            [
                "5544b26d64b060a6",
                "396e35a1d32b1ef4"
            ]
        ]
    },
    {
        "id": "139a7d0257f004db",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Error find directory",
        "func": "let error = \"ERROR, directory PI and DOCKER not found\"\nflow.set(\"savefiledestination\", error);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 2960,
        "wires": [
            [
                "396e35a1d32b1ef4"
            ]
        ]
    },
    {
        "id": "27b9111680cb7c05",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Shelly, start UI",
        "mode": "link",
        "links": [
            "299933034d1680d9",
            "c5c4c92c14f823f4"
        ],
        "x": 1625,
        "y": 2960,
        "wires": []
    },
    {
        "id": "1333c76bcc465e75",
        "type": "delay",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1460,
        "y": 2960,
        "wires": [
            [
                "27b9111680cb7c05"
            ]
        ]
    },
    {
        "id": "396e35a1d32b1ef4",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "reset delay",
        "func": "delete msg.delay;\ndelete msg.error;\nmsg.reset = true;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 2960,
        "wires": [
            [
                "1333c76bcc465e75"
            ]
        ]
    },
    {
        "id": "c5c4c92c14f823f4",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Shelly, start UI text bar",
        "links": [
            "27b9111680cb7c05"
        ],
        "x": 75,
        "y": 480,
        "wires": [
            [
                "4aec194c155291c9"
            ]
        ]
    },
    {
        "id": "cb4af16d862b8704",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "start after deploy",
        "func": "let location = \"please wait, loading config\"\nmsg.payload = \"Data save folder: \" + location\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 520,
        "wires": [
            [
                "19aee30154ceb34d"
            ]
        ]
    },
    {
        "id": "19aee30154ceb34d",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "SCRIPT VERSION",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Actuel version: V1_21-04-2024_R1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 500,
        "wires": [
            [
                "f9c8568712e4c6fc"
            ]
        ]
    },
    {
        "id": "9c1dab7fe8516d2a",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Shelly, startup",
        "links": [
            "552774af28f7338a"
        ],
        "x": 75,
        "y": 520,
        "wires": [
            [
                "cb4af16d862b8704"
            ]
        ]
    },
    {
        "id": "e95c6af36aa0383f",
        "type": "http request",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://127.0.0.1:1880/settings",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 2760,
        "wires": [
            [
                "d81414fee16d756f"
            ]
        ]
    },
    {
        "id": "d81414fee16d756f",
        "type": "json",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1270,
        "y": 2760,
        "wires": [
            [
                "64cb0b9f42d57b2e"
            ]
        ]
    },
    {
        "id": "64cb0b9f42d57b2e",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "Get version",
        "func": "flow.set(\"NoderedVersion\",msg.payload.version);\nmsg.payload = new(Date);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 2760,
        "wires": [
            [
                "552774af28f7338a"
            ]
        ]
    },
    {
        "id": "b7d1cf93f6d31d8e",
        "type": "file",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "V3 Pi, test directory exists",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1110,
        "y": 2800,
        "wires": [
            [
                "1333c76bcc465e75"
            ]
        ]
    },
    {
        "id": "0482e6be8e100415",
        "type": "file",
        "z": "014bce9630cee13d",
        "g": "7aeaf1cd1c87b811",
        "name": "V3 Docker, test directory exists",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1130,
        "y": 2880,
        "wires": [
            [
                "1333c76bcc465e75"
            ]
        ]
    },
    {
        "id": "b9afaabc88e458df",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Shelly, update release in",
        "links": [
            "145e6b9ced901126"
        ],
        "x": 415,
        "y": 560,
        "wires": [
            [
                "a556ba50e320ea35"
            ]
        ]
    },
    {
        "id": "ace7db1b3c3118f0",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "Shelly, update release out",
        "mode": "link",
        "links": [
            "311cf9c380b09b98"
        ],
        "x": 705,
        "y": 560,
        "wires": []
    },
    {
        "id": "a556ba50e320ea35",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "0309977c54ef868e",
        "name": "UPDATE RELEASE",
        "func": "let version = \"V1_21-04-2024_R1\"\nlet oldStr = msg.payload;\nlet newStr = oldStr.slice(0, oldStr.length-1);\nlet store = newStr;\nflow.set(\"version\", newStr);\nlet html = \"\";\nmsg.topic = \"Release notes\";\nif (msg.statusCode === 200 || 201) {\n    if (store === version) {\n        msg.text = \"FLOW IS UP TO DATE WITH GITHUB (\" + version + \")\"\n        msg.background = \"#0A8085\";\n        return msg;\n    } else {\n        msg.text = \"THERE IS AN UPDATE, CLICK HERE TO READ RELEASE-NOTES AND DOWNLOAD FLOW FILE FROM GITHUB\"\n        msg.background = \"#8C101C\";\n        return msg;\n    }\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 560,
        "wires": [
            [
                "ace7db1b3c3118f0"
            ]
        ]
    },
    {
        "id": "145e6b9ced901126",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "Shelly, update release in",
        "mode": "link",
        "links": [
            "b9afaabc88e458df"
        ],
        "x": 435,
        "y": 2620,
        "wires": []
    },
    {
        "id": "311cf9c380b09b98",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "caa93318ac4a6768",
        "name": "Shelly, update release out",
        "links": [
            "ace7db1b3c3118f0"
        ],
        "x": 745,
        "y": 2620,
        "wires": [
            [
                "fe8999794acd76d2"
            ]
        ]
    },
    {
        "id": "21a43ab534fefec4",
        "type": "switch",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Contain domoticz/out",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "domoticz/out",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 240,
        "y": 1080,
        "wires": [
            [
                "18c55140d6034be0"
            ]
        ]
    },
    {
        "id": "bf4f82a93656fb1b",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Source domoticz",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "domoticz",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1040,
        "wires": [
            [
                "6fa45a9ed8a716e3"
            ]
        ]
    },
    {
        "id": "337c524cc4d460bb",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Source shelly gen 1",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 900,
        "wires": [
            [
                "6fa45a9ed8a716e3",
                "6e88df76a40ee5ae"
            ]
        ]
    },
    {
        "id": "dfbb19f1974960be",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Source shelly gen 2",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen2",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 840,
        "wires": [
            [
                "fe3554b170178671"
            ]
        ]
    },
    {
        "id": "6fa45a9ed8a716e3",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly ID filter on ui table",
        "func": "let storetopic = msg.topic;\nlet devs = flow.get(\"sh2dz-idx\") || {};\nlet length = Object.keys(devs).length;\n\nif (msg.source === 'gen1' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n             \n        if (IDkey === storetopic.split(\"/\")[1]) {\n            let type = dev.type;\n            let output = msg.payload;\n            msg.payload = { output, script: { source: \"Shelly_gen1\" }, domoticz : { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen}};\n            \n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, msg];\n            }\n        }\n    }\n}\n\nif (msg.source === 'gen2' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n                \n        if (IDkey === storetopic.split(\"/\")[1]){\n            let type = dev.type;\n            msg.payload.domoticz = { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen };\n            msg.payload.script = { source: \"Shelly_gen2\" };\n            \n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, msg];\n            }\n        }\n    }\n}\n\nif (msg.source === 'gen3') {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let dev = devs[IDkey] || {};\n\n        if (IDkey === storetopic.split(\"/\")[0]) {\n            let type = dev.type;\n            msg.payload.domoticz = { name: dev.name, sw: dev.sw, idx: dev.idx, idxoption1: dev.idxoption1, idxoption2: dev.idxoption2, idxoption3: dev.idxoption3, idxoption4: dev.idxoption4, idxoption5: dev.idxoption5, idxoption6: dev.idxoption6, idxoption7: dev.idxoption7, idxoption8: dev.idxoption8, offline: dev.offline, addon: dev.addon, gen: dev.gen };\n            msg.payload.script = { source: \"Shelly_gen3\" };\n\n            if (type === \"Shelly Plug S\") {\n                return [msg, null, null, null, null]\n            } else if (type === \"Shelly 2.5 shutter mode\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                return [null, null, msg, null, null];\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                return [null, null, null, null, msg];\n            }\n        }\n    }\n}\n\nif ( msg.source === 'domoticz' ) {\n    for (let i = 0; i < length; i++) {\n        let keys = Object.keys(devs);\n        let IDkey = keys[i];\n        let message = devs[IDkey];\n        let messageidx = parseInt(devs[IDkey].idx);\n        let messageidxoption1 = parseInt(devs[IDkey].idxoption1);\n\n        if (messageidx === msg.payload.idx || messageidxoption1 === msg.payload.idx) {\n            let type = message.type;\n            msg.payload.domoticz =  { name: message.name, sw: message.sw, idx: message.idx, idxoption1: message.idxoption1, idxoption2: message.idxoption2, idxoption3: message.idxoption3, idxoption4: message.idxoption4, idxoption5: message.idxoption5, idxoption6: message.idxoption6, idxoption7: message.idxoption7, idxoption8: message.idxoption8, offline: message.offline, addon: message.addon, gen: message.gen };\n            msg.payload.script = { source: \"Domoticz\" }\n                        \n            if (type === \"Shelly Plug S\") {\n                if (messageidx === msg.payload.idx) {\n                    return [msg, null, null, null, null]\n                }\n            } else if (type === \"Shelly 2.5\") {\n                return [null, msg, null, null, null]\n            } else if (type === \"Shelly Plus Plug S\") {\n                if (messageidx === msg.payload.idx) {\n                    return [null, null, msg, null, null];\n                }\n            } else if (type === \"Shelly 1pm mini\") {\n                return [null, null, null, msg, null];\n            } else {\n                if (messageidx === msg.payload.idx) {\n                    return [null, null, null, null, msg];\n                }\n            }\n        }\n    }\n}\n\nreturn [null, null, null, null, msg];",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 840,
        "wires": [
            [
                "142d7d2bd5dc273c"
            ],
            [
                "193b9813d0d66614"
            ],
            [
                "de280be1d9942eed"
            ],
            [
                "24af142e0d288cc9"
            ],
            [
                "73b57c3aa8922a0b"
            ]
        ]
    },
    {
        "id": "86952b6ef3ada7ef",
        "type": "debug",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "IDX not in filter",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 1000,
        "wires": []
    },
    {
        "id": "0c72df2661b2e676",
        "type": "json",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4670,
        "y": 280,
        "wires": [
            [
                "b96f1de2c6def3bd"
            ]
        ]
    },
    {
        "id": "646496ef910afd8e",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":false, \"apower\":0.0, \"voltage\":0.0, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 260,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "ee274ead99ab8199",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "b48a0a1bf220 : 0 Status false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 260,
        "wires": [
            [
                "646496ef910afd8e"
            ]
        ]
    },
    {
        "id": "8c704db0ca75bed5",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":0.053, \"voltage\":231.3, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 300,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "4c4e3045c84acb2e",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "b48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 300,
        "wires": [
            [
                "8c704db0ca75bed5"
            ]
        ]
    },
    {
        "id": "df8a799cbf8b474d",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":12.0, \"voltage\":231.3, \"current\":7.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 340,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "201c197b3e398468",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "c48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 340,
        "wires": [
            [
                "df8a799cbf8b474d"
            ]
        ]
    },
    {
        "id": "9e6c5b8e5b80b749",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "Shelly, Update table out",
        "mode": "link",
        "links": [
            "66181444cc8ccc14"
        ],
        "x": 1625,
        "y": 2160,
        "wires": []
    },
    {
        "id": "390133a2664e1bcd",
        "type": "ui_toast",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1450,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "0d5bb70216a23ba6",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "Del shelly device status list",
        "func": "if (msg.topic === \"del\") {\n    let devs = flow.get(\"sh2dz-status\") || {};\n    delete devs[(msg.payload.name)];\n    \n    msg.topic = msg.payload.name + \" removed from status table\";\n    msg.payload = \"Device is removed.\"\n    return msg;\n}\n\nmsg.topic = msg.payload.label;\n\nlet str = JSON.stringify(msg.payload, null, 2);\ndelete msg.payload;\nmsg.payload = \"<pre>\" + str + \"</pre>\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 2160,
        "wires": [
            [
                "390133a2664e1bcd",
                "9e6c5b8e5b80b749"
            ]
        ]
    },
    {
        "id": "03523c5ceaf8e165",
        "type": "ui_table",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "group": "5d07dbcaa2c15860",
        "name": "Shelly Devices",
        "order": 1,
        "width": 30,
        "height": 11,
        "columns": [
            {
                "field": "name",
                "title": "Topic name",
                "width": "15%",
                "align": "left",
                "formatter": "html",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "sw",
                "title": "Input/Relay",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "output",
                "title": "Payload",
                "width": "10%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "power",
                "title": "Power",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "voltage",
                "title": "Voltage",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "current",
                "title": "Current",
                "width": "8%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "seen",
                "title": "Last",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "status",
                "title": "Status",
                "width": "39%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "del",
                "title": "Remove",
                "width": "7%",
                "align": "center",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 880,
        "y": 2160,
        "wires": [
            [
                "0d5bb70216a23ba6"
            ]
        ]
    },
    {
        "id": "02197b5c825733e3",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "store shelly devices",
        "func": "let devs; \nlet status = \"update\";\n\nif ( msg.src === 'restore' ) {\n    devs = flow.get(\"sh2dz-status\") || {};\n    return [{payload:Object.values(devs)}];\n} else {\n    if (msg.source === 'gen1') {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload === \"announce\") {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [];\n\n            // properties that should not show up in the status\n            let notStatus = [\"name\", \"status\"];\n \n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {};\n\n            let devt = flow.get(\"sh2dz-idx\") || {};\n            let length = Object.keys(devt).length;\n\n            let receivedSensors = [];\n            let sw;\n            if (msg.topic.split(\"/\")[3] === undefined) {\n                sw = msg.topic.split(\"/\")[2];\n            } else {\n                sw = msg.topic.split(\"/\")[2] + \" \" + msg.topic.split(\"/\")[3];\n            }\n            let ID = (msg.topic.split(\"/\")[1]);\n            let dev = devs[ID] || {};\n\n            dev.name = msg.topic.split(\"/\")[1];\n            dev.sw = sw;\n            dev.output = msg.payload;\n            //dev.power = msg.payload.apower;\n            //dev.voltage = msg.payload.voltage;\n            //dev.current = msg.payload.current;\n\n            dev.lastTime = new Date().getTime();\n\n            // create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (inStatus.includes(prop)) {\n                    status += \" \" + prop + \": \" + dev[prop];\n                }\n            }\n            if (status === \"\") {\n                for (let prop in dev) {\n                    if (!notStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop];\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n\n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime() - element[1].lastTime) / 60000) + \"m\");\n\n            flow.set(\"sh2dz-status\", devs);\n\n            return [{ topic: status, payload: Object.values(devs) }];\n        }\n    } else if (msg.source === 'gen2') {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\" ) {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [\"power\", \"voltage\", \"current\"];\n   \n            // properties that should not show up in the status\n            let notStatus = [\"id\", \"source\"];\n\n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {}; \n    \n            let devt = flow.get(\"sh2dz-idx\") || {};\n            let length = Object.keys(devt).length;\n       \n            let receivedSensors = [];\n            let ID = (msg.topic.split(\"/\")[1]);\n            let dev = devs[ID] || {};\n\n            dev.name = msg.topic.split(\"/\")[1];\n            dev.sw = msg.topic.split(\":\")[1];\n            dev.output = msg.payload.output;\n            dev.power = msg.payload.apower;\n            dev.voltage = msg.payload.voltage;\n            dev.current = msg.payload.current;\n\n            dev.lastTime = new Date().getTime();    \n\n            // create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (inStatus.includes(prop)) {\n                    status += \" \" + prop + \": \" + dev[prop];\n                }\n            }\n            if (status === \"\") {\n                for (let prop in dev) {\n                    if (!notStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop];\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n       \n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime()-element[1].lastTime)/60000)+\"m\");\n    \n            flow.set(\"sh2dz-status\", devs);\n\n            return [{topic: status, payload:Object.values(devs)}];\n        }\n    } else if (msg.source === 'gen3') {\n        if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\") {\n            node.log(\"Announce message received\")\n        } else {\n            // properties that should  show up in the status\n            let inStatus = [\"power\", \"voltage\", \"current\"];\n\n            // properties that should not show up in the status\n            let notStatus = [\"id\", \"source\"];\n\n            //node.warn(msg.payload);\n            devs = flow.get(\"sh2dz-status\") || {};\n\n            let devt = flow.get(\"sh2dz-idx\") || {};\n            let length = Object.keys(devt).length;\n\n            let receivedSensors = [];\n            let ID = (msg.topic.split(\"/\")[0]);\n            let dev = devs[ID] || {};\n\n            dev.name = msg.topic.split(\"/\")[0];\n            dev.sw = Object.keys(msg.payload[\"params\"])[1];\n            if (dev.sw === \"input:0\") {\n                dev.output = msg.payload.params[dev.sw].state;\n            } else if (dev.sw === \"switch:0\") {\n                dev.output = msg.payload.params[dev.sw].output;\n            }\n            dev.power = msg.payload.apower;\n            dev.voltage = msg.payload.voltage;\n            dev.current = msg.payload.current;\n\n            dev.lastTime = new Date().getTime();\n\n            // create status from properties\n            let status = \"\";\n            for (let prop in dev) {\n                if (inStatus.includes(prop)) {\n                    status += \" \" + prop + \": \" + dev[prop];\n                }\n            }\n            if (status === \"\") {\n                for (let prop in dev) {\n                    if (!notStatus.includes(prop)) {\n                        status += \" \" + prop + \": \" + dev[prop];\n                    }\n                }\n            }\n            dev.status = status;\n\n            // write back\n            devs[ID] = dev;\n            receivedSensors.push(dev);\n\n            Object.entries(devs).forEach(element => element[1].seen = Math.round((new Date().getTime() - element[1].lastTime) / 60000) + \"m\");\n\n            flow.set(\"sh2dz-status\", devs);\n\n            return [{ topic: status, payload: Object.values(devs) }];\n        }    \n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 2160,
        "wires": [
            [
                "03523c5ceaf8e165"
            ]
        ]
    },
    {
        "id": "93acda876d6342a3",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "add src",
        "func": "msg.src = 'restore';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 2160,
        "wires": [
            [
                "02197b5c825733e3"
            ]
        ]
    },
    {
        "id": "5160cd2f3009f5e2",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "Shelly message received",
        "links": [
            "6e88df76a40ee5ae"
        ],
        "x": 425,
        "y": 2120,
        "wires": [
            [
                "02197b5c825733e3"
            ]
        ]
    },
    {
        "id": "66181444cc8ccc14",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "Shelly, restore/update table",
        "links": [
            "9e6c5b8e5b80b749"
        ],
        "x": 205,
        "y": 2120,
        "wires": [
            [
                "93acda876d6342a3"
            ]
        ]
    },
    {
        "id": "f508848cfb3b905a",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "54c1b9a97dcabe1d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payloadType": "date",
        "x": 150,
        "y": 2160,
        "wires": [
            [
                "93acda876d6342a3"
            ]
        ]
    },
    {
        "id": "3ac37b30f3b8c41d",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":21.0, \"voltage\":213.3, \"current\":17.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 380,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "19287b580d62a6b4",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "c48a0a1bf220 : 0 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 380,
        "wires": [
            [
                "3ac37b30f3b8c41d"
            ]
        ]
    },
    {
        "id": "d9004f4eba85befc",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":false, \"apower\":0.0, \"voltage\":0.0, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 420,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "3aead30b11bc9ca1",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "b48a0a1bf220 : 1 Status false",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 420,
        "wires": [
            [
                "d9004f4eba85befc"
            ]
        ]
    },
    {
        "id": "9a680add2468703b",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":0.053, \"voltage\":231.3, \"current\":0.000, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-b48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 460,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "c07381c22e92f51b",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "b48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 460,
        "wires": [
            [
                "9a680add2468703b"
            ]
        ]
    },
    {
        "id": "28413473259527d3",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":12.0, \"voltage\":231.3, \"current\":7.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 500,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "f398748840b73797",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "c48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 500,
        "wires": [
            [
                "28413473259527d3"
            ]
        ]
    },
    {
        "id": "04c964dd7417797f",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"id\":0, \"source\":\"HTTP\", \"output\":true, \"apower\":21.0, \"voltage\":213.3, \"current\":17.090, \"aenergy\":{\"total\":0.000,\"by_minute\":[0.000,0.000,0.000],\"minute_ts\":1683837554},\"temperature\":{\"tC\":39.9, \"tF\":103.8}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellyplusplugs-c48a0a1bf220/status/switch:1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 540,
        "wires": [
            [
                "0c72df2661b2e676"
            ]
        ]
    },
    {
        "id": "9e8a25841cdeb82b",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b82b070a33fa8cd7",
        "name": "c48a0a1bf220 : 1 Status true",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4180,
        "y": 540,
        "wires": [
            [
                "04c964dd7417797f"
            ]
        ]
    },
    {
        "id": "fe3554b170178671",
        "type": "switch",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Contain shellyplus",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "shellies",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 930,
        "y": 840,
        "wires": [
            [
                "86214df58ae13b4e"
            ],
            [
                "6df6f9ea5f19a2d9"
            ]
        ]
    },
    {
        "id": "6df6f9ea5f19a2d9",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "add shellies",
        "func": "msg.topic = \"shellies/\"+msg.topic;\nmsg.topic_addon = \"shellies\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 860,
        "wires": [
            [
                "6fa45a9ed8a716e3",
                "6e88df76a40ee5ae"
            ]
        ]
    },
    {
        "id": "86214df58ae13b4e",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "add shellies",
        "func": "msg.topic_addon = \"none\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 820,
        "wires": [
            [
                "6fa45a9ed8a716e3",
                "6e88df76a40ee5ae"
            ]
        ]
    },
    {
        "id": "de280be1d9942eed",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "gen2 Shelly Plus Plug S",
        "func": "let d = new Date();\nlet apower, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Heartbeat\") {\n  let heartbeat = flow.get(\"dz-state\") || {};\n  let idxstatus = [];\n  let length = Object.keys(heartbeat).length;\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(heartbeat);\n    let IDkey = keys[i];\n    let dev = heartbeat[IDkey] || {};\n    if (dev.offline === \"Not set\" || dev.offline === \"Disable\") {\n      node.log(\"There is a device which has no heartbeat set or disabled\" )  \n    } else {\n      if (d.getTime() - dev.lasttime > (dev.offline * 1000)) {\n        idx = Number(IDkey.split(\":\")[1])\n        let domoticz = flow.get(\"sh2dz-idx\") || {};\n        let objlength = Object.keys(domoticz).length;\n\n        for (let j = 0; j < objlength; j++) {\n          let objkeys = Object.keys(domoticz);\n          let objIDkey = objkeys[i];\n          let message = domoticz[objIDkey];\n          let messageidx = parseInt(domoticz[objIDkey].idx);\n\n          if (messageidx === idx) {\n            if (dev.online === true){\n              //apower\n              if (Number(message.idxoption1) === 0 || message.idxoption1 === undefined || message.idxoption1 === \"N/A\" || message.idxoption1 === \"Not set\") {\n                apower = null\n              } else {\n                apower = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption1),\n                    svalue: \"-1\",\n                  }\n                }\n              }\n    \n              //voltage\n              if (Number(message.idxoption2) === 0 || message.idxoption2 === undefined || message.idxoption2 === \"N/A\" || message.idxoption2 === \"Not set\") {\n                voltage = null;\n              } else {\n                voltage = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption2),\n                    svalue: \"-1\",\n                  }\n                }\n              }\n    \n              //current\n              if (Number(message.idxoption3) === 0 || message.idxoption3 === undefined || message.idxoption3 === \"N/A\" || message.idxoption3 === \"Not set\") {\n                current = null;\n              } else {\n                current = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption3),\n                    svalue: \"-1\",\n                  }\n                }\n              }\n    \n              //total\n              if (Number(message.idxoption4) === 0 || message.idxoption4 === undefined || message.idxoption4 === \"N/A\" || message.idxoption4 === \"Not set\") {\n                total = null;\n              } else {\n                total = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idxoption4),\n                    nvalue: 0,\n                    svalue: \"0;0\",\n                  }\n                }\n              }\n  \n              //Output\n              if (Number(message.idx) === 0 || message.idx === undefined) {\n                msg = null\n              } else {\n                msg = {\n                  topic: \"domoticz/in\",\n                  payload:\n                  {\n                    command: \"udevice\",\n                    idx: Number(message.idx),\n                    nvalue: 0,\n                  }\n                }\n   \n                dev.online = false\n                dev.output = false\n              \n                heartbeat[IDkey] = dev;\n                idxstatus.push(dev);\n\n                flow.set(\"dz-state\", heartbeat);\n              }\n              return [[msg, apower, voltage, current]];\n            }\n          }\n        }\n      }  \n    }\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Shelly_gen2\") {\n    let info = msg.topic.split(\"/\")[2];\n    let output;\n    \n    if (info === \"status\") {\n      let domoticz = flow.get(\"dz-state\") || {};\n      let idxstate = [];\n      let ID = \"idx:\" + msg.payload.domoticz.idx\n      let dev = domoticz[ID] || {};\n      let length = Object.keys(domoticz).length;\n\n      dev.lasttime = d.getTime();\n      dev.offline = msg.payload.domoticz.offline;\n      dev.online = true;\n\n      for (let i = 0; i < length; i++) {\n        let keys = Object.keys(domoticz);\n        let IDkey = keys[i];\n        let dev = domoticz[IDkey] || {};\n\n        if (IDkey === ID) {\n          output = dev.output;\n        }\n      }\n\n      //apower\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined || msg.payload.domoticz.idxoption1 === \"N/A\" || msg.payload.domoticz.idxoption1 === \"Not set\") {\n        apower = null\n      } else {\n        apower = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption1),\n            svalue: msg.payload.apower.toString(),\n          }\n        }\n      }\n\n      //voltage\n      if (Number(msg.payload.domoticz.idxoption2) === 0 || msg.payload.domoticz.idxoption2 === undefined || msg.payload.domoticz.idxoption2 === \"N/A\" || msg.payload.domoticz.idxoption2 === \"Not set\") {\n        voltage = null;\n      } else {\n        voltage = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption2),\n            svalue: msg.payload.voltage.toString(),\n          }\n        }\n      }\n\n      //current\n      if (Number(msg.payload.domoticz.idxoption3) === 0 || msg.payload.domoticz.idxoption3 === undefined || msg.payload.domoticz.idxoption3 === \"N/A\" || msg.payload.domoticz.idxoption3 === \"Not set\") {\n        current = null;\n      } else {\n        current = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption3),\n            svalue: msg.payload.current.toString(),\n          }\n        }\n      }\n\n      //total\n      if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined || msg.payload.domoticz.idxoption4 === \"N/A\" || msg.payload.domoticz.idxoption4 === \"Not set\") {\n        total = null;\n      } else {\n        total = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idxoption4),\n            nvalue: 0,\n            svalue: msg.payload.aenergy.total + \"\\\";\\\"\" + 0,\n          }\n        }\n      }\n\n      //Output\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg = null\n      } else {\n        if (output == msg.payload.output) {\n          msg = null;\n        } else {\n          dev.output = msg.payload.output\n          let val = msg.payload.output == true ? 1 : 0;\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: val,\n            }\n          }\n        }\n      }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.addon === \"shellies\") {\n    msg.topic = msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n    //msg.topic = msg.payload.domoticz.name + \"/command/switch:0\";\n  } else { \n    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n    //msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/command/switch:0\";\n  }\n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2490,
        "y": 880,
        "wires": [
            [
                "9f5ff7429dacbb8e",
                "a38242331e04ee32",
                "86a0f94de3120b2b"
            ]
        ]
    },
    {
        "id": "464e05c9849409f1",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "Heartbeat check every minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1910,
        "y": 720,
        "wires": [
            [
                "30e02d89014cda79"
            ]
        ]
    },
    {
        "id": "30e02d89014cda79",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "Source Heartbeat",
        "func": "msg.payload = { script: { source: \"Heartbeat\" }};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2170,
        "y": 720,
        "wires": [
            [
                "de280be1d9942eed",
                "142d7d2bd5dc273c"
            ]
        ]
    },
    {
        "id": "18c55140d6034be0",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "IDX Check",
        "func": "let filter = flow.get(\"dz-idx-filter\") || [];\n\nif (msg.payload.hasOwnProperty(\"idx\")) {\n    if (filter.includes(msg.payload.idx.toString())) {\n        return [null, msg];\n        } else {\n        return [msg, null]; \n    }\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1080,
        "wires": [
            [
                "86952b6ef3ada7ef"
            ],
            [
                "bf4f82a93656fb1b",
                "915dfbe3b92ee028"
            ]
        ]
    },
    {
        "id": "2f93587300745922",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Shelly, message idx tabel",
        "links": [
            "6e88df76a40ee5ae"
        ],
        "x": 245,
        "y": 1280,
        "wires": [
            [
                "1fbc2a41de1f81b7"
            ]
        ]
    },
    {
        "id": "1fbc2a41de1f81b7",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Prepare for device table",
        "func": "let devs; \ndevs = flow.get(\"sh2dz-idx\") || {};\n\nif ( msg.src === 'restore' ) {\n    return [{payload:Object.values(devs)}];\n} else if (msg.source === 'gen1') {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let relay = msg.topic.split(\"/\")[3];\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[1];\n        let ID = name;\n        let dev = devs[ID] || {};\n        if (relay === \"energy\") {\n            return;\n        }\n\n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        dev.sw = relay;\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        } \n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }\n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }    \n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }\n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }\n\n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n} else if (msg.source === 'gen2') {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[1];\n        let relay = msg.topic.split(\":\")[1];\n        let ID = name;\n        let dev = devs[ID] || {};\n        if (relay === \"energy\") {\n            return;\n        }\n\n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        dev.sw = relay;\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        }\n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }  \n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }\n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }    \n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }   \n   \n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n} else if (msg.source === 'gen3') {\n    if (msg.topic.split(\"/\")[1] === \"announce\" || msg.payload.output === \"announce\") {\n        node.log(\"Announce message received\")\n    } else {\n        let receivedSensors = [];\n        let name = msg.topic.split(\"/\")[0];\n        let ID = name;\n        let dev = devs[ID] || {};\n        \n        dev.name = name;\n        dev.addon = msg.topic_addon;\n        dev.gen = msg.source;\n        let io = Object.keys(msg.payload[\"params\"])[1];\n        dev.sw = msg.payload.params[io].id;\n        if (dev.type === undefined) {\n            dev.type = \"Unknown\";\n        }\n        if (dev.idx === undefined) {\n            dev.idx = \"Not set\";\n        }\n        if (dev.idxoption1 === undefined) {\n            dev.idxoption1 = \"Not set\";\n        }\n        if (dev.idxoption2 === undefined) {\n            dev.idxoption2 = \"Not set\";\n        }\n        if (dev.idxoption3 === undefined) {\n            dev.idxoption3 = \"Not set\";\n        }\n        if (dev.idxoption4 === undefined) {\n            dev.idxoption4 = \"Not set\";\n        }\n        if (dev.idxoption5 === undefined) {\n            dev.idxoption5 = \"Not set\";\n        }\n        if (dev.idxoption6 === undefined) {\n            dev.idxoption6 = \"Not set\";\n        }\n        if (dev.idxoption7 === undefined) {\n            dev.idxoption7 = \"Not set\";\n        }\n        if (dev.idxoption8 === undefined) {\n            dev.idxoption8 = \"Not set\";\n        }\n        if (dev.offline === undefined) {\n            dev.offline = \"Not set\";\n        }\n\n        // write back\n        devs[ID] = dev;\n        receivedSensors.push(dev);\n\n        flow.set(\"sh2dz-idx\", devs);\n        return //[{ payload: Object.values(devs) }, null];\n    }\n}\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1240,
        "wires": [
            [
                "2312178d86339f5a",
                "025660def2133bcd"
            ]
        ]
    },
    {
        "id": "025660def2133bcd",
        "type": "ui_table",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "group": "e151206531f4336f",
        "name": "Shelly tabel",
        "order": 16,
        "width": 30,
        "height": 4,
        "columns": [
            {
                "field": "name",
                "title": "Name",
                "width": "15%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "sw",
                "title": "Switch",
                "width": "5%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "gen",
                "title": "Generation",
                "width": "7%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "type",
                "title": "Type",
                "width": "13%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idx",
                "title": "IDX",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption1",
                "title": "Option 1",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption2",
                "title": "Option 2",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption3",
                "title": "Option 3",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption4",
                "title": "Option 4",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption5",
                "title": "Option 5",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption6",
                "title": "Option 6",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption7",
                "title": "Option 7",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "idxoption8",
                "title": "Option 8",
                "width": "6%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "offline",
                "title": "Offline",
                "width": "7%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "del",
                "title": "Remove",
                "width": "10%",
                "align": "center",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 670,
        "y": 1260,
        "wires": [
            [
                "fac4bd765c822b09"
            ]
        ]
    },
    {
        "id": "fac4bd765c822b09",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Prefix for asking del?",
        "func": "if (msg.topic === \"del\") {\n    flow.set(\"delbuffer\", msg.payload)\n    \n    msg.topic = \"IDX tabel: Delete \" + msg.payload.name + \", switch \" + msg.payload.sw + \"?\";\n    msg.payload = \"Do you want to remove this device out the IDX list?\"\nreturn [msg, null];    \n}\n\n\nmsg.topic = msg.payload.name + \" (sw:\" + msg.payload.sw + \")\";\n\nlet str = JSON.stringify(msg.payload, null, 2);\ndelete msg.payload;\nmsg.payload = \"<pre>\" + str + \"</pre>\";\n\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1320,
        "wires": [
            [
                "17f88a48f74efe89"
            ],
            [
                "aa289adfb7a90258"
            ]
        ]
    },
    {
        "id": "17f88a48f74efe89",
        "type": "ui_toast",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Cancel",
        "cancel": "Remove",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Del asking pop-up",
        "x": 690,
        "y": 1300,
        "wires": [
            [
                "870e7cf3b6e14b26"
            ]
        ]
    },
    {
        "id": "870e7cf3b6e14b26",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Del in shelly tabel",
        "func": "if (msg.payload === \"Cancel\"){\n    flow.set(\"delbuffer\", \"\");\n    return;\n} else {\n    let dev = flow.get(\"sh2dz-idx\") || {};\n    let devs = flow.get(\"dz-state\") || {};\n    let filter = flow.get(\"dz-idx-filter\") || {};\n    let remove = flow.get(\"delbuffer\")   \n\n    delete dev[remove.name];\n    delete devs[\"idx:\"+remove.idx];\n\n    for (var i = 0; i < filter.length; i++) {\n        if (filter[i] === remove.idx) {\n            filter.splice(i, 1);\n        }\n    }\n    flow.set(\"dz-idx-filter\", filter);\n\n    msg.topic = \"Removing shelly device from list.\"\n    msg.payload = remove.name + \", is removed from IDX list.\";\n\n    let reconfig = flow.get(\"sh2dz-idx\") || {}\n    flow.set(\"delbuffer\", \"\");\n    return [msg,{payload:Object.values(reconfig)}];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 1320,
        "wires": [
            [
                "4c71ba7862a7991d",
                "4e4472bc0363db90"
            ],
            [
                "4f8d0cd8d65f76c4"
            ]
        ]
    },
    {
        "id": "aa289adfb7a90258",
        "type": "ui_toast",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Show detail info",
        "x": 680,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "4c71ba7862a7991d",
        "type": "ui_toast",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1190,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "4e4472bc0363db90",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Shelly, Restore in (shelly table)",
        "mode": "link",
        "links": [
            "f475c5a3cf630886"
        ],
        "x": 1115,
        "y": 1260,
        "wires": []
    },
    {
        "id": "d70969a86f3fd6f0",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "add src",
        "func": "msg.src = 'restore';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 1240,
        "wires": [
            [
                "1fbc2a41de1f81b7"
            ]
        ]
    },
    {
        "id": "f475c5a3cf630886",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Shelly, restore idxtable out",
        "links": [
            "c7b55ab3a1ba3ed1",
            "4e4472bc0363db90",
            "54bc9f402683fdba"
        ],
        "x": 75,
        "y": 1240,
        "wires": [
            [
                "d70969a86f3fd6f0"
            ]
        ]
    },
    {
        "id": "4f8d0cd8d65f76c4",
        "type": "json",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1150,
        "y": 1340,
        "wires": [
            [
                "2fb0671e822b55b8"
            ]
        ]
    },
    {
        "id": "216f27245c48f89c",
        "type": "file",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "2fb0671e822b55b8",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1340,
        "wires": [
            [
                "216f27245c48f89c"
            ]
        ]
    },
    {
        "id": "a38242331e04ee32",
        "type": "link out",
        "z": "014bce9630cee13d",
        "name": "Shelly to mqtt",
        "mode": "link",
        "links": [
            "70c57cd0b1560206",
            "9b3576adfd857fdb"
        ],
        "x": 2695,
        "y": 760,
        "wires": []
    },
    {
        "id": "9f5ff7429dacbb8e",
        "type": "debug",
        "z": "014bce9630cee13d",
        "name": "gen2 shelly plus plug s",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2780,
        "y": 880,
        "wires": []
    },
    {
        "id": "0b6f0127a51a5794",
        "type": "ui_button",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "",
        "group": "e151206531f4336f",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Show discovered shellies",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 1340,
        "wires": [
            [
                "d70969a86f3fd6f0"
            ]
        ]
    },
    {
        "id": "2312178d86339f5a",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "aeb50f6f6458dd04",
        "name": "Shelly, Device discovered",
        "mode": "link",
        "links": [
            "fae8f67d3f65ac90"
        ],
        "x": 615,
        "y": 1220,
        "wires": []
    },
    {
        "id": "73b57c3aa8922a0b",
        "type": "debug",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Not (yet) supported",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1530,
        "y": 980,
        "wires": []
    },
    {
        "id": "f522a330c2e9b79f",
        "type": "ui_text",
        "z": "014bce9630cee13d",
        "group": "61d922efb8a113fa",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Github URL: https://github.com/Hoeby/V1-Shelly-Nodered-flow",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 250,
        "y": 80,
        "wires": []
    },
    {
        "id": "142d7d2bd5dc273c",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "gen1 Shelly Plug S",
        "func": "let d = new Date();\nlet apower, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Heartbeat\") {\n  let heartbeat = flow.get(\"dz-state\") || {};\n  let idxstatus = [];\n  let length = Object.keys(heartbeat).length;\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(heartbeat);\n    let IDkey = keys[i];\n    let dev = heartbeat[IDkey] || {};\n    if (dev.offline === \"Not set\" || dev.offline === \"Disable\") {\n      node.log(\"There is a device which has no heartbeat set or disabled\")\n    } else {\n      if (d.getTime() - dev.lasttime > (dev.offline * 1000)) {\n        idx = Number(IDkey.split(\":\")[1])\n        let domoticz = flow.get(\"sh2dz-idx\") || {};\n        let objlength = Object.keys(domoticz).length;\n \n        for (let j = 0; j < objlength; j++) {\n          let objkeys = Object.keys(domoticz);\n          let objIDkey = objkeys[j];\n          let message = domoticz[objIDkey];\n          let messageidx = parseInt(domoticz[objIDkey].idx);\n          if (messageidx === idx) {\n            if (dev.output === true) {\n              if (dev.online === true) {\n    \n                //apower\n                if (Number(message.idxoption1) === 0 || message.idxoption1 === undefined || message.idxoption1 === \"N/A\" || message.idxoption1 === \"Not set\") {\n                  apower = null\n                } else {\n                  apower = {\n                    topic: \"domoticz/in\",\n                    payload:\n                    {\n                      command: \"udevice\",\n                      idx: Number(message.idxoption1),\n                      svalue: \"-1\",\n                    }\n                  }\n                }\n\n                //Output\n                if (Number(message.idx) === 0 || message.idx === undefined) {\n                  msg = null\n                } else {\n                  msg = {\n                    topic: \"domoticz/in\",\n                    payload:\n                    {\n                      command: \"udevice\",\n                      idx: Number(message.idx),\n                      nvalue: 0,\n                    }\n                  }\n                }\n\n                dev.online = false\n                dev.output = false\n\n                heartbeat[IDkey] = dev;\n                idxstatus.push(dev);\n\n                flow.set(\"dz-state\", heartbeat);\n              }\n              return [[msg, apower, voltage, current]];\n            }\n          }\n        }\n      }\n    }\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n  let info = msg.topic.split(\"/\")[2];\n  let energy = msg.topic.split(\"/\")[4];\n  let output;\n\n  if (info === \"relay\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx:\" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload; \n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        output = dev.output;\n      }\n    }\n      \n    //Output\n    let val;\n    if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n      msg = null\n    } else {\n      if (msg.payload.output === \"on\") {\n        dev.output = true;\n        val = 1;\n      } else if (msg.payload.output === \"off\") {\n        dev.output = false;\n        val = 0;\n      }\n      if (output == dev.output) {\n        msg = null;\n      } else {\n        msg = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(msg.payload.domoticz.idx),\n            nvalue: val,\n          }\n        }\n      }\n    }\n\n    //apower\n    if (dev.output === true) {\n      if (energy === \"energy\") {\n        if (Number(save.domoticz.idxoption1) === 0 || save.domoticz.idxoption1 === undefined || save.domoticz.idxoption1 === \"N/A\" || save.domoticz.idxoption1 === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption1),\n              svalue: save.output.output.toString(),\n            }\n          }\n        }\n      }\n    } else if (dev.output === false) {\n      if (output == dev.output) {\n        msg = null;\n      } else {\n        if (Number(save.domoticz.idxoption1) === 0 || save.domoticz.idxoption1 === undefined || save.domoticz.idxoption1 === \"N/A\" || save.domoticz.idxoption1 === \"Not set\") {\n          apower = null\n        } else {\n          apower = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption1),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.addon === \"shellies\") {\n    //msg.topic = msg.payload.domoticz.name + \"/relay/\" + msg.payload.domoticz.sw + \"/command\";\n    msg.topic = msg.payload.domoticz.name + \"/relay/0/command\";\n  } else { \n    //msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/\" + msg.payload.domoticz.sw + \"/command\" ;\n    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n  }\n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2470,
        "y": 800,
        "wires": [
            [
                "500b4308ace0fb32",
                "a38242331e04ee32",
                "86a0f94de3120b2b"
            ]
        ]
    },
    {
        "id": "500b4308ace0fb32",
        "type": "debug",
        "z": "014bce9630cee13d",
        "name": "gen1 shelly plug s",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2770,
        "y": 800,
        "wires": []
    },
    {
        "id": "a9628f9152635559",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "a36e460dd828ad01",
        "name": "Shellies plug energy",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"output\":9,\"domoticz\":{\"name\":\"shellyplug-s-80646F817476\",\"sw\":\"0\",\"idx\":\"11\",\"idxoption1\":\"N/A\",\"idxoption2\":\"N/A\",\"idxoption3\":\"N/A\",\"idxoption4\":\"N/A\",\"idxoption5\":\"N/A\",\"idxoption6\":\"N/A\",\"idxoption7\":\"N/A\",\"idxoption8\":\"N/A\",\"offline\":\"N/A\",\"addon\":\"none\",\"gen\":\"gen1\"},\"script\":{\"source\":\"Shelly_gen1\"}}",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0/energy",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4460,
        "y": 680,
        "wires": [
            [
                "934eea0918d0c2fc"
            ]
        ]
    },
    {
        "id": "ce8d7e01db365347",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "a36e460dd828ad01",
        "name": "Shellies plug on",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 640,
        "wires": [
            [
                "b96f1de2c6def3bd"
            ]
        ]
    },
    {
        "id": "7598ca4c96174afa",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "a36e460dd828ad01",
        "name": "Shellies plug off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyplug-s-80646F817476/relay/0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 720,
        "wires": [
            [
                "b96f1de2c6def3bd"
            ]
        ]
    },
    {
        "id": "80615d2f35822dad",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "a36e460dd828ad01",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 640,
        "wires": [
            [
                "ce8d7e01db365347"
            ]
        ]
    },
    {
        "id": "a7ec4a729dfa69c6",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "a36e460dd828ad01",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 680,
        "wires": [
            [
                "a9628f9152635559"
            ]
        ]
    },
    {
        "id": "ef0c31489fca381d",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "a36e460dd828ad01",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4240,
        "y": 720,
        "wires": [
            [
                "7598ca4c96174afa"
            ]
        ]
    },
    {
        "id": "081ad32ef73f0665",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX nummer",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idx",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1500,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "d235df133b8ae5e9",
        "type": "ui_button",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "group": "e151206531f4336f",
        "order": 15,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Set settings",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 550,
        "y": 1900,
        "wires": [
            [
                "9fdd46eed38663c4",
                "749f2e80124691b1"
            ]
        ]
    },
    {
        "id": "11ad633a4b29c1a1",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Clear",
        "func": "delete msg.payload;\nmsg.payload =\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1980,
        "wires": [
            [
                "081ad32ef73f0665",
                "459f9cefd7bed137",
                "21c8183ee9d9c0f7",
                "427dd897c6e891e2",
                "4975d0fce7ab243e",
                "040c2eaf08b37023",
                "ea1cd12882fe62f7",
                "6c59b4448b8a83e9",
                "550202f276b4e72b",
                "672b35d8fb3307ef",
                "e9a5b262408d6ea9"
            ]
        ]
    },
    {
        "id": "9fdd46eed38663c4",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Set Device settings",
        "func": "let option1 = [\"Shelly Plug S\", \"Shelly 2.5\", \"Shelly Plus Plug S\", \"Shelly 1pm mini\"];\nlet option2 = [\"Shelly 2.5\", \"Shelly Plus Plug S\"];\nlet option3 = [\"Shelly 2.5\", \"Shelly Plus Plug S\"];\nlet option4 = [\"Shelly 2.5\", \"Shelly Plus Plug S\"];\nlet option5 = [\"Shelly 2.5\"];\nlet option6 = [\"Shelly 2.5\"];\nlet option7 = [\"Shelly 2.5\"];\nlet option8 = [\"Shelly 2.5\"];\nlet option13 = [\"Shelly Plug S\", \"Shelly Plus Plug S\"];\nlet data1 = context.get(\"data1\") || null; //get from context or default to null\nlet data2 = context.get(\"data2\") || null; //get from context or default to null\nlet data3 = context.get(\"data3\") || null; //get from context or default to null\nlet data4 = context.get(\"data4\") || \"Not set\"; //get from context or default to 0\nlet data5 = context.get(\"data5\") || \"Not set\"; //get from context or default to 0\nlet data6 = context.get(\"data6\") || \"Not set\"; //get from context or default to 0\nlet data7 = context.get(\"data7\") || \"Not set\"; //get from context or default to 0\nlet data8 = context.get(\"data8\") || \"Not set\"; //get from context or default to 0\nlet data9 = context.get(\"data9\") || \"Not set\"; //get from context or default to 0\nlet data10 = context.get(\"data10\") || \"Not set\"; //get from context or default to 0\nlet data11 = context.get(\"data11\") || \"Not set\"; //get from context or default to 0\nlet data12 = context.get(\"data12\") || \"Not set\"; //get from context or default to 0\nlet data13 = context.get(\"data13\") || \"Not set\"; //get from context or default to 0\n\n\nlet reconfig = flow.get(\"sh2dz-idx\") || {};\n\nswitch (msg.topic){\n\n    case \"device\":\n        //data1 = msg.payload; \n        data1 = msg.payload.split(\"/\")[0];\n        data2 = msg.payload.split(\"/\")[1];\n        context.set(\"data1\", data1);//store in context for next time \n        context.set(\"data2\", data2);//store in context for next time \n        return;\n\n    //case \"sw\":\n    //    data2 = msg.payload;\n    //    context.set(\"data2\", data2);//store in context for next time \n    //    return;\n\n    case \"type\":\n        data3 = msg.payload;\n        context.set(\"data3\", data3);//store in context for next time \n        return;\n    \n    case \"idx\":\n        data4 = msg.payload; \n        context.set(\"data4\", data4);//store in context for next time \n        return;\n        \n    case \"idxoption1\":\n        data5 = msg.payload;\n        context.set(\"data5\", data5); //store in context for next time \n        return;\n        \n    case \"idxoption2\":\n        data6 = msg.payload;\n        context.set(\"data6\", data6); //store in context for next time \n        return;\n    \n    case \"idxoption3\":\n        data7 = msg.payload;\n        context.set(\"data7\", data7); //store in context for next time \n        return;\n    \n    case \"idxoption4\":\n        data8 = msg.payload;\n        context.set(\"data8\", data8); //store in context for next time \n        return;\n\n    case \"idxoption5\":\n        data9 = msg.payload;\n        context.set(\"data9\", data9); //store in context for next time \n        return;\n\n    case \"idxoption6\":\n        data10 = msg.payload;\n        context.set(\"data10\", data10); //store in context for next time \n        return;\n    \n    case \"idxoption7\":\n        data11 = msg.payload;\n        context.set(\"data11\", data11); //store in context for next time \n        return;\n    \n    case \"idxoption8\":\n        data12 = msg.payload;\n        context.set(\"data12\", data12); //store in context for next time \n        return;\n\n    case \"offline\":\n        data13 = msg.payload;\n        context.set(\"data13\", data13); //store in context for next time \n        return;\n\n    case \"submit\":\n        if (data1 !== null ) {\n            let receivedSensors = [];\n            let dev = reconfig[(data1.split(\"/\")[0])] || {};\n            \n            dev.type = data3;\n\n            dev.name = data1.split(\":\")[0];\n            //dev.sw = data1.split(\":\")[1];\n            dev.sw = data2;\n                        \n            if (data3 === \"Not (yet) supported\") {\n                dev.idx = \"N/A\";\n            } else {\n                dev.idx = data4;\n            }            \n            if (option1.includes(data3)) {\n                dev.idxoption1 = data5;\n            } else {\n                dev.idxoption1 = \"N/A\";\n            }\n            if (option2.includes(data3)) {\n                dev.idxoption2 = data6;\n            } else {\n                dev.idxoption2 = \"N/A\";\n            } \n            if (option3.includes(data3)) {\n                dev.idxoption3 = data7;\n            } else {\n                dev.idxoption3 = \"N/A\";\n            }\n            if (option4.includes(data3)) {\n                dev.idxoption4 = data8;\n            } else {\n                dev.idxoption4 = \"N/A\";\n            }\n            if (option5.includes(data3)) {\n                dev.idxoption5 = data9;\n            } else {\n                dev.idxoption5 = \"N/A\";\n            }\n            if (option6.includes(data3)) {\n                dev.idxoption6 = data10;\n            } else {\n                dev.idxoption6 = \"N/A\";\n            }\n            if (option7.includes(data3)) {\n                dev.idxoption7 = data11;\n            } else {\n                dev.idxoption7 = \"N/A\";\n            }\n            if (option8.includes(data3)) {\n                dev.idxoption8 = data12;\n            } else {\n                dev.idxoption8 = \"N/A\";\n            }\n            if (option13.includes(data3)) {\n                dev.offline = data13;\n            } else {\n                dev.offline = \"N/A\";\n            }\n            // write back\n            reconfig[(data1.split(\"/\")[0])] = dev;\n            receivedSensors.push(dev);\n \n            flow.set(\"sh2dz-idx\", reconfig);\n            context.set(\"data1\", null);\n        } else {\n            return;\n        }\n    }\n\nreturn [{payload:Object.values(reconfig)},msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 1620,
        "wires": [
            [
                "e05f22c2f65c3f2b",
                "04bf803a8d7fb812"
            ],
            [
                "54bc9f402683fdba"
            ]
        ]
    },
    {
        "id": "459f9cefd7bed137",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 1",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 7,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption1",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1540,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "21c8183ee9d9c0f7",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 2",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 12,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption2",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1580,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "427dd897c6e891e2",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 4",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 8,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption4",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1660,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "749f2e80124691b1",
        "type": "delay",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 150,
        "y": 1980,
        "wires": [
            [
                "11ad633a4b29c1a1"
            ]
        ]
    },
    {
        "id": "4975d0fce7ab243e",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 3",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption3",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1620,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "e05f22c2f65c3f2b",
        "type": "json",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1150,
        "y": 1600,
        "wires": [
            [
                "6e7505348b6ade1e"
            ]
        ]
    },
    {
        "id": "54bc9f402683fdba",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Shelly, Restore idx table",
        "mode": "link",
        "links": [
            "f475c5a3cf630886"
        ],
        "x": 1105,
        "y": 1640,
        "wires": []
    },
    {
        "id": "fae8f67d3f65ac90",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Shelly, Device in",
        "links": [
            "452b38fec749323b",
            "6908453d834d5d49",
            "2312178d86339f5a"
        ],
        "x": 75,
        "y": 1440,
        "wires": [
            [
                "b6a7dba6f12d5dfa"
            ]
        ]
    },
    {
        "id": "6c59b4448b8a83e9",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Device list",
        "func": "msg.payload = \"\"\nmsg.options = [\"Shelly Plug S\",\n               //\"Shelly 2.5 shutter mode\",\n               \"Shelly 1pm mini\",\n               \"Shelly Plus Plug S\",\n               \"Not (yet) supported\" ]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1960,
        "wires": [
            [
                "7a30883b06858276"
            ]
        ]
    },
    {
        "id": "7a30883b06858276",
        "type": "ui_dropdown",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "device type",
        "label": "",
        "tooltip": "",
        "place": "Device type",
        "group": "e151206531f4336f",
        "order": 11,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [],
        "payload": "",
        "topic": "type",
        "topicType": "str",
        "className": "",
        "x": 730,
        "y": 1960,
        "wires": [
            [
                "9fdd46eed38663c4",
                "173e5476f10c6083"
            ]
        ]
    },
    {
        "id": "35466ac1bfd4c2ee",
        "type": "ui_button",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "group": "e151206531f4336f",
        "order": 10,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "How setup device in domoticz",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "submit",
        "topicType": "str",
        "x": 1490,
        "y": 1860,
        "wires": [
            [
                "173e5476f10c6083"
            ]
        ]
    },
    {
        "id": "173e5476f10c6083",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "How to setup device in domoticz",
        "func": "let device = context.get(\"type\") || 0; //get from context or default to 0\n\nswitch (msg.topic){\n\n    case \"type\":\n        device = msg.payload; \n        context.set(\"type\", device);//store in context for next time \n        return;\n\n    case \"submit\":\n        \n        //Shelly Plug s (gen1)\n        if (device === \"Shelly Plug S\") {\n            msg.topic = \"Shelly Plug S (generation 1)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch (Dummy = switch)</p><p>IDXoption1 = Power (Dummy = Usage, Electric)</p><p>IDXoption2 = Not available for this device</p><p>IDXoption3 = Not available for this device</p><p>IDXoption4 = Not available for this device</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n        \n        //Shelly 2.5 (gen1)\n        } else if (device === \"Shelly 2.5\") {\n            msg.topic = \"Shelly 2.5 (generation 1)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch relay 0 (Dummy = switch)</p><p>IDXoption1 = switch relay 1 (Dummy = switch)</p><p>IDXoption2 = input 0 (Dummy = switch)</p><p>IDXoption3 = input 1 (Dummy = switch)</p><p>IDXoption4 = Voltage (Dummy = General, Voltage)</p><p>IDXoption5 = Energy 0 (Dummy = General, kWh)</p><p>IDXoption6 = Energy 1 (Dummy = General, kWh)</p><p>IDXoption7 = Power 0 (Dummy = General, Electric)</p><p>IDXoption8 = Power 1 (Dummy = General, Electric)</p><p>Offline notify = Not available for this device</p>\"\n     \n        //Shelly Plus Plug S (gen2)    \n        } else if (device === \"Shelly Plus Plug S\" ) {   \n            msg.topic = \"Shelly Plus Plug S (generation 2)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch (Dummy = switch)</p><p>IDXoption1 = Power (Dummy = Usage, Electric)</p><p>IDXoption2 = Voltage (Dummy = General, Voltage)</p><p>IDXoption3 = Current (Dummy = General, Current)</p><p>IDXoption4 = Total power (Dummy = General, kWh)</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Choose the setting</p>\"\n\n        //Shelly 1PM mini (gen3)       \n        } else if (device === \"Shelly 1pm mini\") {\n            msg.topic = \"Shelly 1PM mini (generation 3)\"\n            msg.payload = \"<p>Make dummy device in domoticz.</p><p>IDX = switch relay 0 (Dummy = switch)</p><p>IDXoption1 = input 0 (Dummy = switch)</p><p>IDXoption2 = Not available for this device</p><p>IDXoption3 = Not available for this device</p><p>IDXoption4 = Not available for this device</p><p>IDXoption5 = Not available for this device</p><p>IDXoption6 = Not available for this device</p><p>IDXoption7 = Not available for this device</p><p>IDXoption8 = Not available for this device</p><p>Offline notify = Not available for this device</p>\"\n\n        } else {\n            msg.topic = \"Device unknown\"\n            msg.payload = \"<p>First select device type, afterwards the info is shown</p>\"\n        }\n        return msg;\n    }",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 1900,
        "wires": [
            [
                "29ec599449db2bc6"
            ]
        ]
    },
    {
        "id": "29ec599449db2bc6",
        "type": "ui_toast",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": false,
        "outputs": 1,
        "ok": "Close",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "Shelly Device Info",
        "x": 1450,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "c2b7a71b63a94da5",
        "type": "ui_dropdown",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "",
        "tooltip": "",
        "place": "Device",
        "group": "e151206531f4336f",
        "order": 6,
        "width": 6,
        "height": 1,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "device",
        "topicType": "str",
        "className": "",
        "x": 540,
        "y": 1440,
        "wires": [
            [
                "9fdd46eed38663c4",
                "4a05ac11c0b41cc7",
                "a86cf831495d53ae"
            ]
        ]
    },
    {
        "id": "b6a7dba6f12d5dfa",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "extract devicenames",
        "func": "if (msg.topic === \"no-update\")  {\n   return;\n} else {\n   msg.options = msg.payload.map(obj => {\n      var rObj = {};\n      rObj[obj.name] = obj.name + \"/\" + obj.sw\n      return rObj;\n   });\n}\n\nmsg.payload = {};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1440,
        "wires": [
            [
                "c2b7a71b63a94da5"
            ]
        ]
    },
    {
        "id": "6e7505348b6ade1e",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Get save location",
        "func": "let destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 1600,
        "wires": [
            [
                "8812399cb0503b07"
            ]
        ]
    },
    {
        "id": "8812399cb0503b07",
        "type": "file",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Save to file",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1570,
        "y": 1600,
        "wires": [
            []
        ]
    },
    {
        "id": "040c2eaf08b37023",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 5",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 13,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption5",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1700,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "ea1cd12882fe62f7",
        "type": "ui_dropdown",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Offline notificatie",
        "label": "Offline notify",
        "tooltip": "",
        "place": "",
        "group": "e151206531f4336f",
        "order": 5,
        "width": 6,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Disable",
                "value": "Disable",
                "type": "str"
            },
            {
                "label": "60 seconds",
                "value": 60,
                "type": "num"
            },
            {
                "label": "120 seconds",
                "value": 120,
                "type": "num"
            },
            {
                "label": "180 seconds",
                "value": 180,
                "type": "num"
            },
            {
                "label": "240 seconds",
                "value": 240,
                "type": "num"
            },
            {
                "label": "300 seconds",
                "value": 300,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "offline",
        "topicType": "str",
        "className": "",
        "x": 560,
        "y": 1860,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "6a23b269e1643faf",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Set device list",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 300,
        "y": 2020,
        "wires": [
            [
                "6c59b4448b8a83e9"
            ]
        ]
    },
    {
        "id": "550202f276b4e72b",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 6",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption6",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1740,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "672b35d8fb3307ef",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 7",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 9,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption7",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1780,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "e9a5b262408d6ea9",
        "type": "ui_text_input",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "label": "IDX option 8",
        "tooltip": "",
        "group": "e151206531f4336f",
        "order": 14,
        "width": 6,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "250",
        "topic": "idxoption8",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 550,
        "y": 1820,
        "wires": [
            [
                "9fdd46eed38663c4"
            ]
        ]
    },
    {
        "id": "04bf803a8d7fb812",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "set idx filter",
        "func": "let filter = [];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    if (msg.payload[i].type === \"Shelly Plug S\") {\n        filter.push(msg.payload[i].idx)\n    } else if (msg.payload[i].type === \"Shelly 2.5\") {\n        filter.push(msg.payload[i].idx)\n        if (msg.payload[i].idxoption1 === \"Not set\") {\n        } else {\n            filter.push(msg.payload[i].idxoption1)\n        }\n    } else if (msg.payload[i].type === \"Shelly Plus Plug S\") {\n        filter.push(msg.payload[i].idx)\n    } else if (msg.payload[i].type === \"Shelly 1pm mini\") {\n        filter.push(msg.payload[i].idx)\n        if (msg.payload[i].idxoption1 === \"Not set\") {\n        } else {\n            filter.push(msg.payload[i].idxoption1)\n        }\n    }\n}\n\nflow.set(\"dz-idx-filter\", filter);\nflow.set(\"dz-state\",{})\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "78c237144ef3eece",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "Set stored value",
        "func": "if (msg.payload === undefined) {\n  return;\n} else {\n  let devicename = msg.payload.split(\"/\")[0];\n  let settings = flow.get(\"sh2dz-idx\") || {};\n  let length = Object.keys(settings).length;\n  let type, idx, idxoption1, idxoption2, idxoption3, idxoption4, idxoption5, idxoption6, idxoption7, idxoption8, offline\n\n  for (let i = 0; i < length; i++) {\n    let keys = Object.keys(settings);\n    let IDkey = keys[i];\n    let dev = settings[IDkey] || {};\n\n    if (dev.name === devicename) {\n      if (dev.type === \"unknown\") {\n        node.log(\"unknown\")\n      } else {\n        type = dev.type\n        type = { payload: type,}\n      }\n      if (dev.idx === undefined ) {\n        node.log(\"unknown\")\n      } else if (dev.idx === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idx = dev.idx\n        idx = { payload: idx, }\n      }\n      if (dev.idxoption1 === undefined || dev.idxoption1 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption1 = dev.idxoption1\n        idxoption1 = { payload: idxoption1, }\n      }\n      if (dev.idxoption2 === undefined || dev.idxoption2 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption2 = dev.idxoption2\n        idxoption2 = { payload: idxoption2, }\n      }\n      if (dev.idxoption3 === undefined || dev.idxoption3 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption3 = dev.idxoption3\n        idxoption3 = { payload: idxoption3, }\n      }\n      if (dev.idxoption4 === undefined || dev.idxoption4 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption4 = dev.idxoption4\n        idxoption4 = { payload: idxoption4, }\n      }\n      if (dev.idxoption5 === undefined || dev.idxoption5 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption5 = dev.idxoption5\n        idxoption5 = { payload: idxoption5, }\n      }\n      if (dev.idxoption6 === undefined || dev.idxoption6 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption6 = dev.idxoption6\n        idxoption6 = { payload: idxoption6, }\n      }\n      if (dev.idxoption7 === undefined || dev.idxoption7 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption7 = dev.idxoption7\n        idxoption7 = { payload: idxoption7, }\n      }\n      if (dev.idxoption8 === undefined || dev.idxoption8 === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        idxoption8 = dev.idxoption8\n        idxoption8 = { payload: idxoption8, }\n      }\n      if (dev.offline === undefined || dev.offline === \"Not set\") {\n        node.log(\"unknown\")\n      } else {\n        offline = dev.offline\n        offline = { payload: offline, }\n      }\n    }\n  }\n  return [type, idx, idxoption1, idxoption2, idxoption3, idxoption4, idxoption5, idxoption6, idxoption7, idxoption8, offline];\n}\n\nreturn;",
        "outputs": 11,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 1800,
        "wires": [
            [
                "7a30883b06858276"
            ],
            [
                "081ad32ef73f0665"
            ],
            [
                "459f9cefd7bed137"
            ],
            [
                "21c8183ee9d9c0f7"
            ],
            [
                "4975d0fce7ab243e"
            ],
            [
                "427dd897c6e891e2"
            ],
            [
                "040c2eaf08b37023"
            ],
            [
                "550202f276b4e72b"
            ],
            [
                "672b35d8fb3307ef"
            ],
            [
                "e9a5b262408d6ea9"
            ],
            [
                "ea1cd12882fe62f7"
            ]
        ]
    },
    {
        "id": "4a05ac11c0b41cc7",
        "type": "delay",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 210,
        "y": 1680,
        "wires": [
            [
                "78c237144ef3eece"
            ]
        ]
    },
    {
        "id": "a86cf831495d53ae",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "a0c043a73758d49b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 1540,
        "wires": [
            [
                "081ad32ef73f0665",
                "459f9cefd7bed137",
                "21c8183ee9d9c0f7",
                "427dd897c6e891e2",
                "4975d0fce7ab243e",
                "7a30883b06858276",
                "040c2eaf08b37023",
                "ea1cd12882fe62f7",
                "550202f276b4e72b",
                "672b35d8fb3307ef",
                "e9a5b262408d6ea9"
            ]
        ]
    },
    {
        "id": "b96f1de2c6def3bd",
        "type": "link out",
        "z": "014bce9630cee13d",
        "name": "Shelly manual test",
        "mode": "link",
        "links": [
            "7bd5bdb52cc2610c"
        ],
        "x": 4885,
        "y": 680,
        "wires": []
    },
    {
        "id": "7f04d8a6de2579a1",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 relay 1Off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 140,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "af584b6abaea5127",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Power relay 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1/power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "62.88",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 500,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "e9762c75535e87d6",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Energy relay 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1/energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "23145",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 420,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "775f69bb64a62133",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Input 0 op 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 180,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "66cf34794b03eab2",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Temperature",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/temperature",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "56.73",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 600,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "e9a949225ad4e0cb",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Overtemperature",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/overtemperature",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2280,
        "y": 640,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "de7b2414e16f37b0",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Overtemp status",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/temperature_status",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Normal",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2280,
        "y": 680,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "5c737b9fcbf0d742",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Voltage",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/voltage",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "229.35",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2250,
        "y": 340,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "9c66b2f46b11bb80",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 140,
        "wires": [
            [
                "7f04d8a6de2579a1"
            ]
        ]
    },
    {
        "id": "2510193836330bd5",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 500,
        "wires": [
            [
                "af584b6abaea5127"
            ]
        ]
    },
    {
        "id": "7974cb5cdbf68621",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 420,
        "wires": [
            [
                "e9762c75535e87d6"
            ]
        ]
    },
    {
        "id": "8726298efc517fd6",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 180,
        "wires": [
            [
                "775f69bb64a62133"
            ]
        ]
    },
    {
        "id": "89c9d30fd9e99c98",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 600,
        "wires": [
            [
                "66cf34794b03eab2"
            ]
        ]
    },
    {
        "id": "0f3104d82df8a7e8",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 640,
        "wires": [
            [
                "e9a949225ad4e0cb"
            ]
        ]
    },
    {
        "id": "5f57f4c8cabceeb3",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 680,
        "wires": [
            [
                "de7b2414e16f37b0"
            ]
        ]
    },
    {
        "id": "33140b4cde291f02",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 340,
        "wires": [
            [
                "5c737b9fcbf0d742"
            ]
        ]
    },
    {
        "id": "56e87e4e6be4dd76",
        "type": "link out",
        "z": "014bce9630cee13d",
        "name": "Shelly, test2",
        "mode": "link",
        "links": [
            "7bd5bdb52cc2610c"
        ],
        "x": 2615,
        "y": 560,
        "wires": []
    },
    {
        "id": "193b9813d0d66614",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "gen1 Shelly 2.5",
        "func": "let d = new Date();\nlet savetopic = msg.topic;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n    let info = msg.topic.split(\"/\")[2];\n    let variable = msg.topic.split(\"/\")[4];\n    let shutter;\n\n    if (variable === \"command\") {\n        return;\n    }\n\n    if (info === \"roller\") {\n        let domoticz = flow.get(\"dz-state\") || {};\n        let idxstate = [];\n        let ID = \"idx \" + msg.payload.domoticz.idx\n        let dev = domoticz[ID] || {};\n        let length = Object.keys(domoticz).length;\n        let save = msg.payload;\n\n        for (let i = 0; i < length; i++) {\n            let keys = Object.keys(domoticz);\n            let IDkey = keys[i];\n            let dev = domoticz[IDkey] || {};\n            if (IDkey === ID) {\n                shutter = dev.shutter;\n            }\n        }\n\n        //Position\n        if (variable === \"pos\") {\n            dev.lasttime = d.getTime();\n            dev.offline = msg.payload.domoticz.offline;\n            dev.online = true;\n\n            if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n                msg.payload = null;\n            } else {\n                dev.shutter = msg.payload.output;\n                if (shutter === dev.shutter) {\n                    msg = null;\n                } else {\n                    msg = {\n                        topic: \"domoticz/in\",\n                        payload:\n                        {\n                            command: \"switchlight\",\n                            idx: Number(msg.payload.domoticz.idx),\n                            switchcmd: \"Set Level\",\n                            level: msg.payload.output\n                        }\n                    }\n                }\n            }\n           \n        //Store stop_reason\n        } else if (variable === \"stop_reason\") {\n            if (msg.payload.output === \"normal\") {\n                dev.state = \"stop\"\n                msg = null;\n            } else {\n                msg = null;\n            }\n        } else {\n            msg = null;\n        }\n        domoticz[ID] = dev;\n        idxstate.push(dev);\n\n        flow.set(\"dz-state\", domoticz);\n        return msg;\n        \n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 840,
        "wires": [
            [
                "0bd4744cbff1be6d",
                "86a0f94de3120b2b"
            ]
        ]
    },
    {
        "id": "0456d348582d1e6c",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 relay 1 On",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 100,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "fe125ac6461ffd22",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 100,
        "wires": [
            [
                "0456d348582d1e6c"
            ]
        ]
    },
    {
        "id": "641d300d10f72348",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 relay 0 Off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 60,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "199b287e16922b65",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 60,
        "wires": [
            [
                "641d300d10f72348"
            ]
        ]
    },
    {
        "id": "a7d086fc6b4e068d",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 relay 0 On",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 20,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "eb47799779abbaeb",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 20,
        "wires": [
            [
                "a7d086fc6b4e068d"
            ]
        ]
    },
    {
        "id": "c34a612038f5fdfa",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Input 0 op 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/0",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 220,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "5eae1c1b160ad38f",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 220,
        "wires": [
            [
                "c34a612038f5fdfa"
            ]
        ]
    },
    {
        "id": "bc79774edb4f8f15",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Input 1 op 1",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "1",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 260,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "cd2c473379f81a2e",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 260,
        "wires": [
            [
                "bc79774edb4f8f15"
            ]
        ]
    },
    {
        "id": "a437e6564a897a3c",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Input 1 op 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/input/1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2260,
        "y": 300,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "8db9cb9329e87d94",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 300,
        "wires": [
            [
                "a437e6564a897a3c"
            ]
        ]
    },
    {
        "id": "9ffa1ee0c9f20f9e",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Power relay 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0/power",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "30.88",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 460,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "35e440c10f642ec9",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 460,
        "wires": [
            [
                "9ffa1ee0c9f20f9e"
            ]
        ]
    },
    {
        "id": "8d916acab01ca972",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 Energy relay 0",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/Shel-2.5-Keuken-gen1-pm/relay/0/energy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "17962",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 380,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "ecd0654f191dc83f",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2040,
        "y": 380,
        "wires": [
            [
                "8d916acab01ca972"
            ]
        ]
    },
    {
        "id": "934eea0918d0c2fc",
        "type": "json",
        "z": "014bce9630cee13d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4650,
        "y": 680,
        "wires": [
            [
                "b96f1de2c6def3bd"
            ]
        ]
    },
    {
        "id": "3b0722459279c780",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "838d2403b660c12a",
        "name": "Shelly to MQTT server",
        "mode": "link",
        "links": [
            "a0024720d71c4146"
        ],
        "x": 165,
        "y": 340,
        "wires": []
    },
    {
        "id": "0df306c3cce61c15",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "838d2403b660c12a",
        "name": "Shelly from MQTT server",
        "links": [
            "815c5ae767ffd619",
            "ce6f5c18fd49fbc1"
        ],
        "x": 575,
        "y": 300,
        "wires": [
            [
                "0d1c8ee346214645"
            ]
        ]
    },
    {
        "id": "6225acbda42e4355",
        "type": "ui_switch",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "",
        "label": "Shelly incoming messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 5,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 340,
        "y": 1040,
        "wires": [
            [
                "e8be1692a322a0ee",
                "5f3bcb962f59cba9"
            ]
        ]
    },
    {
        "id": "e8be1692a322a0ee",
        "type": "gate",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 730,
        "y": 1020,
        "wires": [
            [
                "5f3bcb962f59cba9"
            ]
        ]
    },
    {
        "id": "874e52f1c09dd752",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "name": "Debug switch empty payload",
        "func": "if (msg.payload === true) {\n    msg.topic = \"\"\n    msg.payload = \"\"\n    msg.debug_addon = \"\"\n}\nif (msg.payload === false) {\n    msg.payload = \"\"\n    msg.topic = \"\"\n    msg.debug_addon = \"\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 2260,
        "wires": [
            [
                "262cdef7738fcde0",
                "1742d6dac06785ee",
                "1e7e4ce2e9dd64df"
            ]
        ]
    },
    {
        "id": "262cdef7738fcde0",
        "type": "ui_text",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "group": "240e8c09f225dbd4",
        "order": 3,
        "width": 30,
        "height": 1,
        "name": "",
        "label": "Switch source:",
        "format": "{{msg.debug_addon}}",
        "layout": "row-left",
        "className": "",
        "x": 1100,
        "y": 2300,
        "wires": []
    },
    {
        "id": "df379d698487f160",
        "type": "inject",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payloadType": "str",
        "x": 570,
        "y": 2320,
        "wires": [
            [
                "262cdef7738fcde0",
                "588d0eedab16a672",
                "1742d6dac06785ee",
                "1e7e4ce2e9dd64df"
            ]
        ]
    },
    {
        "id": "5f3bcb962f59cba9",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "63f368d85c94ec56"
        ],
        "x": 875,
        "y": 1020,
        "wires": []
    },
    {
        "id": "63f368d85c94ec56",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "name": "Shelly, show messages on UI",
        "links": [
            "5f3bcb962f59cba9",
            "265a7e03748e48b3",
            "79261e94518d0df1"
        ],
        "x": 75,
        "y": 2260,
        "wires": [
            [
                "874e52f1c09dd752"
            ]
        ]
    },
    {
        "id": "588d0eedab16a672",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "name": "Set debug switch off",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2260,
        "wires": [
            [
                "4b735cc462e55242"
            ]
        ]
    },
    {
        "id": "4b735cc462e55242",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "name": "Shelly, Debug off",
        "mode": "link",
        "links": [
            "6a607d15db6ab0ae",
            "022f8f2ecb6be7ed",
            "1a5f7894e4257c79"
        ],
        "x": 1555,
        "y": 2260,
        "wires": []
    },
    {
        "id": "6a607d15db6ab0ae",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "4b735cc462e55242"
        ],
        "x": 155,
        "y": 1040,
        "wires": [
            [
                "6225acbda42e4355"
            ]
        ]
    },
    {
        "id": "1742d6dac06785ee",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "name": "Debug topic2payload",
        "func": "msg.payload = msg.topic\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2380,
        "wires": [
            [
                "d8d6827992caba86"
            ]
        ]
    },
    {
        "id": "d8d6827992caba86",
        "type": "ui_text",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "group": "240e8c09f225dbd4",
        "order": 1,
        "width": 30,
        "height": 1,
        "name": "",
        "label": "Topic:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1590,
        "y": 2380,
        "wires": []
    },
    {
        "id": "022f8f2ecb6be7ed",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "4b735cc462e55242"
        ],
        "x": 155,
        "y": 1120,
        "wires": [
            [
                "e0df4111043ee574"
            ]
        ]
    },
    {
        "id": "e0df4111043ee574",
        "type": "ui_switch",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "",
        "label": "Domoticz incoming messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 6,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 350,
        "y": 1120,
        "wires": [
            [
                "bca90b0c61805c9f",
                "265a7e03748e48b3"
            ]
        ]
    },
    {
        "id": "bca90b0c61805c9f",
        "type": "gate",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 1130,
        "y": 1120,
        "wires": [
            [
                "265a7e03748e48b3"
            ]
        ]
    },
    {
        "id": "265a7e03748e48b3",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "63f368d85c94ec56"
        ],
        "x": 1265,
        "y": 1120,
        "wires": []
    },
    {
        "id": "1a5f7894e4257c79",
        "type": "link in",
        "z": "014bce9630cee13d",
        "name": "Shelly, debug shelly messages off",
        "links": [
            "4b735cc462e55242"
        ],
        "x": 2395,
        "y": 1020,
        "wires": [
            [
                "cfc3bcf3529dd7ba"
            ]
        ]
    },
    {
        "id": "cfc3bcf3529dd7ba",
        "type": "ui_switch",
        "z": "014bce9630cee13d",
        "name": "",
        "label": "Shelly --> MQTT messages",
        "tooltip": "",
        "group": "240e8c09f225dbd4",
        "order": 4,
        "width": 7,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "control",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2570,
        "y": 1020,
        "wires": [
            [
                "766d6898638874d7",
                "79261e94518d0df1"
            ]
        ]
    },
    {
        "id": "766d6898638874d7",
        "type": "gate",
        "z": "014bce9630cee13d",
        "name": "",
        "controlTopic": "control",
        "defaultState": "closed",
        "openCmd": "true",
        "closeCmd": "false",
        "toggleCmd": "toggle",
        "defaultCmd": "default",
        "statusCmd": "status",
        "persist": false,
        "storeName": "memory",
        "x": 3000,
        "y": 1020,
        "wires": [
            [
                "79261e94518d0df1"
            ]
        ]
    },
    {
        "id": "79261e94518d0df1",
        "type": "link out",
        "z": "014bce9630cee13d",
        "name": "Shelly, debug shelly messages",
        "mode": "link",
        "links": [
            "63f368d85c94ec56"
        ],
        "x": 3125,
        "y": 1020,
        "wires": []
    },
    {
        "id": "86a0f94de3120b2b",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "add button label",
        "func": "msg.debug_addon = \"Shelly --> MQTT messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2790,
        "y": 980,
        "wires": [
            [
                "766d6898638874d7"
            ]
        ]
    },
    {
        "id": "915dfbe3b92ee028",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "add button label",
        "func": "msg.debug_addon = \"Domoticz incoming messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 1080,
        "wires": [
            [
                "bca90b0c61805c9f"
            ]
        ]
    },
    {
        "id": "9f31b851488855ad",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "add button label",
        "func": "msg.debug_addon = \"Shelly incoming messages\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 960,
        "wires": [
            [
                "e8be1692a322a0ee"
            ]
        ]
    },
    {
        "id": "1e7e4ce2e9dd64df",
        "type": "ui_text",
        "z": "014bce9630cee13d",
        "g": "b3137b38ca33dfeb",
        "group": "240e8c09f225dbd4",
        "order": 2,
        "width": 30,
        "height": 2,
        "name": "",
        "label": "Payload:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1080,
        "y": 2340,
        "wires": []
    },
    {
        "id": "0bd4744cbff1be6d",
        "type": "debug",
        "z": "014bce9630cee13d",
        "name": "gen1 shelly 2.5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2760,
        "y": 840,
        "wires": []
    },
    {
        "id": "98e57f7ff629d9b2",
        "type": "switch",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Contain shelly message",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "events",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "status/switch",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "shellies",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 270,
        "y": 880,
        "wires": [
            [
                "9f31b851488855ad",
                "a7df550693ea6f33"
            ],
            [
                "dfbb19f1974960be",
                "9f31b851488855ad"
            ],
            [
                "337c524cc4d460bb",
                "9f31b851488855ad"
            ]
        ]
    },
    {
        "id": "a7df550693ea6f33",
        "type": "change",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Source shelly gen 3",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "gen3",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic_addon",
                "pt": "msg",
                "to": "none",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 780,
        "wires": [
            [
                "6fa45a9ed8a716e3",
                "6e88df76a40ee5ae"
            ]
        ]
    },
    {
        "id": "9d6db5d997f98011",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\", \"dst\":\"Pomp wensput/events\", \"method\":\"NotifyStatus\", \"params\":{\"ts\":1713549431.88, \"input:0\":{\"id\":0, \"state\": true}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 540,
        "wires": [
            [
                "2ae70ba7f6bd1c58"
            ]
        ]
    },
    {
        "id": "04ab56b34144e0f7",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "Shelly 1PM ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1420,
        "y": 540,
        "wires": [
            [
                "9d6db5d997f98011"
            ]
        ]
    },
    {
        "id": "2ae70ba7f6bd1c58",
        "type": "json",
        "z": "014bce9630cee13d",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 560,
        "wires": [
            [
                "56e87e4e6be4dd76"
            ]
        ]
    },
    {
        "id": "e7cf795abe1e1ef2",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\", \"dst\":\"Pomp wensput/events\", \"method\":\"NotifyStatus\", \"params\":{\"ts\":1713549431.88, \"input:0\":{\"id\":0, \"state\": false}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 580,
        "wires": [
            [
                "2ae70ba7f6bd1c58"
            ]
        ]
    },
    {
        "id": "10548d032681ea74",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "Shelly 1PM OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1420,
        "y": 580,
        "wires": [
            [
                "e7cf795abe1e1ef2"
            ]
        ]
    },
    {
        "id": "24af142e0d288cc9",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "gen3 Shelly 1PM mini",
        "func": "let d = new Date();\nlet idx;\n\nif (msg.payload.script.source === \"Shelly_gen3\") {\n  let info = msg.topic.split(\"/\")[1];\n  let input, output;\n\n  if (info === \"events\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx:\" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n    \n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input = dev.input;\n        output = dev.output;\n      }\n    }\n      \n    //Input\n    if ((Object.keys(msg.payload[\"params\"])[1]) === \"input:0\"){\n      let value, state;\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.params[\"input:0\"].state === true) {\n          dev.input = true;\n          value = 1;\n          state = \"On\"\n        } else if (msg.payload.params[\"input:0\"].state === false) {\n          dev.input = false;\n          value = 0;\n          state = \"Off\"\n        }\n        if (input == dev.input) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption1),\n              nvalue: value,\n              svalue1: state\n            }\n          }\n        }\n      }\n    //Output\n    } else if ((Object.keys(msg.payload[\"params\"])[1]) === \"switch:0\") {\n      let value, state;\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.params[\"switch:0\"].output === true) {\n          dev.output = true;\n          value = 1;\n          state = \"On\"\n        } else if (msg.payload.params[\"switch:0\"].output === false) {\n          dev.output = false;\n          value = 0;\n          state = \"Off\"\n        }\n        if (output == dev.output) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: value,\n              svalue1: state\n            }\n          }\n        }\n      }\n    } else {\n      return;\n    }\n\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return msg;\n    //return [[msg, apower, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx:\" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.gen === \"gen1\") {\n    msg.topic = msg.payload.domoticz.name + \"/command/\" + msg.payload.domoticz.sw;\n  } else if (msg.payload.domoticz.gen === \"gen2\") {\n    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  } else if (msg.payload.domoticz.gen === \"gen3\") {\n    msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/command/switch:\" + msg.payload.domoticz.sw;\n  } else {\n    return;\n  }\n  if (msg.payload.nvalue == 1) {\n    msg.payload = \"on\";\n    dev.output = true;\n  } else if (msg.payload.nvalue == 0) {\n    msg.payload = \"off\";\n    dev.output = false;\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  if (msg.topic === \"domoticz/out\") {\n    return;\n  } else {\n    return msg;\n  }\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2480,
        "y": 920,
        "wires": [
            [
                "3acd1605134aa92e",
                "86a0f94de3120b2b",
                "a38242331e04ee32"
            ]
        ]
    },
    {
        "id": "3acd1605134aa92e",
        "type": "debug",
        "z": "014bce9630cee13d",
        "name": "gen3 shelly 1pm",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2760,
        "y": 920,
        "wires": []
    },
    {
        "id": "9109c4d8fee2bdb8",
        "type": "json",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 2480,
        "wires": [
            [
                "c4b8d8a9736812b3"
            ]
        ]
    },
    {
        "id": "ad1c49aa6ab0d1fe",
        "type": "debug",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Debug flow.get",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 2520,
        "wires": []
    },
    {
        "id": "188632209b4a081e",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Set flow.get test",
        "func": "let store =  msg.payload;\nflow.set(\"sh2dz-idx\", store);\nreturn [{payload:Object.values(store)}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 2480,
        "wires": [
            [
                "c7b55ab3a1ba3ed1"
            ]
        ]
    },
    {
        "id": "c4b8d8a9736812b3",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Payload2Object",
        "func": "let store = msg.payload;\nlet msg2 = Object.assign({}, store);\nreturn [{payload:(msg2)}];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 2480,
        "wires": [
            [
                "0b10e0257f9e36db"
            ]
        ]
    },
    {
        "id": "0b10e0257f9e36db",
        "type": "split",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 950,
        "y": 2480,
        "wires": [
            [
                "4b454a5eba8e9733"
            ]
        ]
    },
    {
        "id": "4b454a5eba8e9733",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "shelly2topic",
        "func": "let value = msg.payload.name\nmsg.topic = value;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 2480,
        "wires": [
            [
                "b147434c8839e7b0"
            ]
        ]
    },
    {
        "id": "b147434c8839e7b0",
        "type": "join",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1290,
        "y": 2480,
        "wires": [
            [
                "ad1c49aa6ab0d1fe",
                "188632209b4a081e",
                "3e8fddf55325e3a0"
            ]
        ]
    },
    {
        "id": "c7b55ab3a1ba3ed1",
        "type": "link out",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Shelly, Restore idx table (read file)",
        "mode": "link",
        "links": [
            "f475c5a3cf630886"
        ],
        "x": 1625,
        "y": 2480,
        "wires": []
    },
    {
        "id": "d494b5cd53674e51",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Get save location",
        "func": "delete msg.payload;\nlet destination = flow.get(\"savefiledestination\");\nmsg.filename = destination + \"/shellytabel.txt\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 2480,
        "wires": [
            [
                "4592fa5aaa1228be"
            ]
        ]
    },
    {
        "id": "299933034d1680d9",
        "type": "link in",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Shelly, start UI",
        "links": [
            "27b9111680cb7c05"
        ],
        "x": 75,
        "y": 2480,
        "wires": [
            [
                "d494b5cd53674e51"
            ]
        ]
    },
    {
        "id": "4592fa5aaa1228be",
        "type": "file in",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "Read backup",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 410,
        "y": 2480,
        "wires": [
            [
                "9109c4d8fee2bdb8"
            ]
        ]
    },
    {
        "id": "3e8fddf55325e3a0",
        "type": "function",
        "z": "014bce9630cee13d",
        "g": "18852a505197e53b",
        "name": "set idx filter",
        "func": "let filter = [];\nlet length = Object.keys(msg.payload).length;\n\nfor (var devN in msg.payload) {\n    let devInfo = msg.payload[devN];\n    if (devInfo.type === \"Shelly Plug S\") {\n        filter.push(devInfo.idx)\n    } else if (devInfo.type === \"Shelly 2.5\") {\n        filter.push(devInfo.idx)\n        if (devInfo.idxoption1 === \"Not set\") {\n        } else {\n            filter.push(devInfo.idxoption1)\n        }\n    } else if (devInfo.type === \"Shelly Plus Plug S\") {\n        filter.push(devInfo.idx)\n    } else if (devInfo.type === \"Shelly 1pm mini\") {\n        filter.push(devInfo.idx)\n        if (devInfo.idxoption1 === \"Not set\") {\n        } else {\n            filter.push(devInfo.idxoption1)\n        }\n    }\n}\n\nflow.set(\"dz-idx-filter\", filter);\nflow.set(\"dz-state\",{})\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 2520,
        "wires": [
            []
        ]
    },
    {
        "id": "41913a778c72d43c",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\",\"dst\":\"Pomp wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1713556420.54,\"switch:0\":{\"id\":0,\"output\":true,\"source\":\"SHC\",\"timer_duration\":5,\"timer_started_at\":1713556420.54}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 460,
        "wires": [
            [
                "2ae70ba7f6bd1c58"
            ]
        ]
    },
    {
        "id": "08468d6ecc452184",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "Shelly 1PM switch ON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1400,
        "y": 460,
        "wires": [
            [
                "41913a778c72d43c"
            ]
        ]
    },
    {
        "id": "cab35fceec230f02",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 1pm gen3",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Pomp wensput/events/rpc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"src\":\"shelly1pmminig3-84fce63b7818\",\"dst\":\"Pomp wensput/events\",\"method\":\"NotifyStatus\",\"params\":{\"ts\":1713556420.54,\"switch:0\":{\"id\":0,\"output\":false,\"source\":\"SHC\",\"timer_duration\":5,\"timer_started_at\":1713556420.54}}}",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1650,
        "y": 500,
        "wires": [
            [
                "2ae70ba7f6bd1c58"
            ]
        ]
    },
    {
        "id": "0f3879adf1dbb1d4",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "Shelly 1PM switch OFF",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1400,
        "y": 500,
        "wires": [
            [
                "cab35fceec230f02"
            ]
        ]
    },
    {
        "id": "6be7f57440f7ad2c",
        "type": "function",
        "z": "014bce9630cee13d",
        "name": "gen1 Shelly 2.5",
        "func": "let d = new Date();\nlet energy, energy0, energy1, power, power0, power1, voltage, current, total;\nlet idx;\n\nif (msg.payload.script.source === \"Shelly_gen1\") {\n  let info = msg.topic.split(\"/\")[2];\n  let relaynr = msg.topic.split(\"/\")[3];\n  let variable = msg.topic.split(\"/\")[4];\n  let input0, input1, output0, output1, shutter;\n\n  if (variable === \"command\") {\n    return;\n  }\n\n  if (info === \"roller\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n      if (IDkey === ID) {\n        shutter = dev.shutter;\n      }\n    }\n\n    //energy output\n    if (variable === \"energy\") {\n      if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n        msg = null\n        energy = null\n      } else {\n        msg = null\n        energy = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(save.domoticz.idxoption5),\n            svalue: save.output + \"\\\";\\\"\" + 0,\n          }\n        }\n      }\n\n      //power output\n    } else if (variable === \"power\") {\n      if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n        msg = null\n        power = null\n      } else {\n        msg = null\n        power = {\n          topic: \"domoticz/in\",\n          payload:\n          {\n            command: \"udevice\",\n            idx: Number(save.domoticz.idxoption7),\n            svalue: save.output.toString(),\n          }\n        }\n      }\n\n      //Position\n    } else if (variable === \"pos\") {\n      if (dev.state === \"stop\") {\n        dev.lasttime = d.getTime();\n        dev.offline = msg.payload.domoticz.offline;\n        dev.online = true;\n\n        if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n          msg.payload = null;\n        } else {\n          dev.shutter = msg.payload.output;\n          if (shutter === dev.shutter) {\n            msg = null;\n          } else {\n            msg = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"switchlight\",\n                idx: Number(msg.payload.domoticz.idx),\n                switchcmd: \"Set Level\",\n                level: msg.payload.output\n              }\n            }\n          }\n        }\n      } else {\n        msg = null;\n      }\n\n      //Store stop_reason\n    } else if (variable === \"stop_reason\") {\n      if (msg.payload.output === \"normal\") {\n        dev.state = \"stop\"\n        msg = null;\n      } else {\n        msg = null;\n      }\n\n\n    } else {\n      if (msg.payload.output === \"stop\") {\n        if (Number(msg.payload.domoticz.idxoption5) === 0 || msg.payload.domoticz.idxoption5 === undefined || msg.payload.domoticz.idxoption5 === \"N/A\" || msg.payload.domoticz.idxoption5 === \"Not set\") {\n          energy = null;\n        } else {\n          energy = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption5),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(msg.payload.domoticz.idxoption7) === 0 || msg.payload.domoticz.idxoption7 === undefined || msg.payload.domoticz.idxoption7 === \"N/A\" || msg.payload.domoticz.idxoption7 === \"Not set\") {\n          power = null;\n        } else {\n          power = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption7),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n      msg = null;\n    }\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy, power, voltage, current, total]];\n  }\n\n  if (info === \"relay\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input0 = dev.input0;\n        input1 = dev.input1;\n        output0 = dev.output0;\n        output1 = dev.output1;\n      }\n    }\n\n    //Output\n    if (Number(relaynr) === 0) {\n      let val0;\n      if (Number(msg.payload.domoticz.idx) === 0 || msg.payload.domoticz.idx === undefined) {\n        msg.payload = null;\n      } else {\n        if (msg.payload.output === \"on\") {\n          dev.output0 = true;\n          val0 = 1;\n        } else if (msg.payload.output === \"off\") {\n          dev.output0 = false;\n          val0 = 0;\n        }\n        if (output0 == dev.output0) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idx),\n              nvalue: val0,\n            }\n          }\n        }\n      }\n    } else if (Number(relaynr) === 1) {\n      let val1;\n      if (Number(msg.payload.domoticz.idxoption1) === 0 || msg.payload.domoticz.idxoption1 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === \"on\") {\n          dev.output1 = true;\n          val1 = 1;\n        } else if (msg.payload.output === \"off\") {\n          dev.output1 = false;\n          val1 = 0;\n        }\n        if (output1 == dev.output1) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption1),\n              nvalue: val1,\n            }\n          }\n        }\n      }\n    }\n\n    //power output 0\n    if (dev.output0 === true && (Number(relaynr) === 0)) {\n      if (info === \"relay\") {\n        if (variable === \"energy\") {\n          if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n            energy0 = null\n          } else {\n            energy0 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption5),\n                svalue: save.output + \"\\\";\\\"\" + 0,\n              }\n            }\n          }\n        }\n        if (variable === \"power\") {\n          if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n            power0 = null\n          } else {\n            power0 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption7),\n                svalue: save.output.toString(),\n              }\n            }\n          }\n        }\n      }\n    } else if (dev.output0 === false) {\n      if (output0 == dev.output0) {\n        energy0 = null;\n      } else {\n        if (Number(save.domoticz.idxoption5) === 0 || save.domoticz.idxoption5 === undefined || save.domoticz.idxoption5 === \"N/A\" || save.domoticz.idxoption5 === \"Not set\") {\n          energy0 = null\n        } else {\n          energy0 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption5),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(save.domoticz.idxoption7) === 0 || save.domoticz.idxoption7 === undefined || save.domoticz.idxoption7 === \"N/A\" || save.domoticz.idxoption7 === \"Not set\") {\n          power0 = null\n        } else {\n          power0 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption7),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    //power output 1\n    if (dev.output1 === true && (Number(relaynr) === 1)) {\n      if (info === \"relay\") {\n        if (variable === \"energy\") {\n          if (Number(save.domoticz.idxoption6) === 0 || save.domoticz.idxoption6 === undefined || save.domoticz.idxoption6 === \"N/A\" || save.domoticz.idxoption6 === \"Not set\") {\n            energy1 = null\n          } else {\n            energy1 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption6),\n                svalue: save.output + \"\\\";\\\"\" + 0,\n              }\n            }\n          }\n        }\n        if (variable === \"power\") {\n          if (Number(save.domoticz.idxoption8) === 0 || save.domoticz.idxoption8 === undefined || save.domoticz.idxoption8 === \"N/A\" || save.domoticz.idxoption8 === \"Not set\") {\n            power1 = null\n          } else {\n            power1 = {\n              topic: \"domoticz/in\",\n              payload:\n              {\n                command: \"udevice\",\n                idx: Number(save.domoticz.idxoption8),\n                svalue: save.output.toString(),\n              }\n            }\n          }\n        }\n      }\n    } else if (dev.output1 === false) {\n      if (output1 == dev.output1) {\n        energy1 = null;\n      } else {\n        if (Number(save.domoticz.idxoption6) === 0 || save.domoticz.idxoption6 === undefined || save.domoticz.idxoption6 === \"N/A\" || save.domoticz.idxoption6 === \"Not set\") {\n          energy1 = null\n        } else {\n          energy1 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption6),\n              nvalue: 0,\n              svalue: \"0;0\",\n            }\n          }\n        }\n        if (Number(save.domoticz.idxoption8) === 0 || save.domoticz.idxoption8 === undefined || save.domoticz.idxoption8 === \"N/A\" || save.domoticz.idxoption8 === \"Not set\") {\n          power1 = null\n        } else {\n          power1 = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(save.domoticz.idxoption8),\n              svalue: \"0\",\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n\n  if (info === \"input\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n\n      if (IDkey === ID) {\n        input0 = dev.input0;\n        input1 = dev.input1;\n      }\n    }\n\n    //Input\n    if (Number(relaynr) === 0) {\n      let val0;\n      if (Number(msg.payload.domoticz.idxoption2) === 0 || msg.payload.domoticz.idxoption2 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === 1) {\n          dev.input0 = true;\n        } else if (msg.payload.output === 0) {\n          dev.input0 = false;\n        }\n        if (input0 == dev.input0) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption2),\n              nvalue: msg.payload.output,\n            }\n          }\n        }\n      }\n    } else if (Number(relaynr) === 1) {\n      if (Number(msg.payload.domoticz.idxoption3) === 0 || msg.payload.domoticz.idxoption3 === undefined) {\n        msg = null\n      } else {\n        if (msg.payload.output === 1) {\n          dev.input1 = true;\n        } else if (msg.payload.output === 0) {\n          dev.input1 = false;\n        }\n        if (input1 == dev.input1) {\n          msg = null;\n        } else {\n          msg = {\n            topic: \"domoticz/in\",\n            payload:\n            {\n              command: \"udevice\",\n              idx: Number(msg.payload.domoticz.idxoption3),\n              nvalue: msg.payload.output,\n            }\n          }\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n\n  if (info === \"voltage\") {\n    let domoticz = flow.get(\"dz-state\") || {};\n    let idxstate = [];\n    let ID = \"idx \" + msg.payload.domoticz.idx\n    let dev = domoticz[ID] || {};\n    let length = Object.keys(domoticz).length;\n    let save = msg.payload;\n\n    dev.lasttime = d.getTime();\n    dev.offline = msg.payload.domoticz.offline;\n    dev.online = true;\n\n    for (let i = 0; i < length; i++) {\n      let keys = Object.keys(domoticz);\n      let IDkey = keys[i];\n      let dev = domoticz[IDkey] || {};\n    }\n\n    //Voltage\n    if (Number(msg.payload.domoticz.idxoption4) === 0 || msg.payload.domoticz.idxoption4 === undefined) {\n      msg = null\n    } else {\n      msg = {\n        topic: \"domoticz/in\",\n        payload:\n        {\n          command: \"udevice\",\n          idx: Number(msg.payload.domoticz.idxoption4),\n          svalue: msg.payload.output,\n        }\n      }\n    }\n\n    domoticz[ID] = dev;\n    idxstate.push(dev);\n\n    flow.set(\"dz-state\", domoticz);\n    return [[msg, energy0, energy1, power0, power1, voltage, current, total]];\n  }\n  return;\n}\n\nif (msg.payload.script.source === \"Domoticz\") {\n  let shelly = flow.get(\"dz-state\") || {};\n  let idxshellystate = [];\n  let IDidx = \"idx \" + msg.payload.domoticz.idx\n  let dev = shelly[IDidx] || {};\n\n  if (msg.payload.domoticz.addon === \"shellies\") {\n    if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n      msg.topic = msg.payload.domoticz.name + \"/relay/0/command\";\n      if (msg.payload.nvalue == 1) {\n        msg.payload = \"on\";\n        dev.output0 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.payload = \"off\";\n        dev.output0 = false;\n      }\n    } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption1)) {\n      msg.topic = msg.payload.domoticz.name + \"/relay/1/command\";\n      if (msg.payload.nvalue == 1) {\n        msg.payload = \"on\";\n        dev.output1 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.payload = \"off\";\n        dev.output1 = false;\n      }\n    }\n  } else {\n    if (msg.payload.idx === Number(msg.payload.domoticz.idx)) {\n      if (msg.payload.hasOwnProperty(\"Level\")) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n        msg.payload = msg.payload.Level\n        dev.state = \"moving\"\n      } else if (msg.payload.nvalue == 1) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n        msg.payload = \"on\";\n        dev.output0 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/0/command\";\n        msg.payload = \"off\";\n        dev.output0 = false;\n      }\n    } else if (msg.payload.idx === Number(msg.payload.domoticz.idxoption1)) {\n      if (msg.payload.hasOwnProperty(\"Level\")) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/roller/0/command/pos\";\n        msg.payload = msg.payload.Level;\n        dev.state = \"moving\";\n      } else if (msg.payload.nvalue == 1) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/1/command\";\n        msg.payload = \"on\";\n        dev.output1 = true;\n      } else if (msg.payload.nvalue == 0) {\n        msg.topic = \"shellies/\" + msg.payload.domoticz.name + \"/relay/1/command\";\n        msg.payload = \"off\";\n        dev.output1 = false;\n      }\n    }\n  }\n\n  shelly[IDidx] = dev;\n  idxshellystate.push(dev);\n\n  flow.set(\"dz-state\", shelly);\n  return msg\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2460,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "3f18d210da63121d",
        "type": "change",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 share position 95",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shellyswitch25-68C63AF96C39/roller/0/pos",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "94",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1680,
        "y": 240,
        "wires": [
            [
                "2ae70ba7f6bd1c58"
            ]
        ]
    },
    {
        "id": "b530b004a5ed0c06",
        "type": "inject",
        "z": "014bce9630cee13d",
        "name": "Shelly 2.5 share position",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1410,
        "y": 240,
        "wires": [
            [
                "3f18d210da63121d"
            ]
        ]
    },
    {
        "id": "709cb410f4aa0efb",
        "type": "debug",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Shelly command",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 780,
        "wires": []
    },
    {
        "id": "47b7c93947b1f26a",
        "type": "switch",
        "z": "014bce9630cee13d",
        "g": "73f5c74c76c54c87",
        "name": "Contain shelly command",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "command",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 800,
        "wires": [
            [
                "709cb410f4aa0efb"
            ],
            [
                "98e57f7ff629d9b2"
            ]
        ]
    },
    {
        "id": "15c4f2f2cb991459",
        "type": "ui_spacer",
        "z": "014bce9630cee13d",
        "name": "spacer",
        "group": "240e8c09f225dbd4",
        "order": 7,
        "width": 9,
        "height": 1
    },
    {
        "id": "e6ffe1b28d49f4ed",
        "type": "mqtt-broker",
        "name": "",
        "broker": "192.168.178.14",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "d823ccdecb8e433a",
        "type": "ui_group",
        "name": "shelly update",
        "tab": "e3edb57efc8062a5",
        "order": 2,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "53b94e9a48b9cb3e",
        "type": "ui_group",
        "name": "Version number",
        "tab": "e3edb57efc8062a5",
        "order": 1,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ecbbb13f9bc2e1f2",
        "type": "ui_group",
        "name": "",
        "tab": "e3edb57efc8062a5",
        "order": 6,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5d07dbcaa2c15860",
        "type": "ui_group",
        "name": "status table",
        "tab": "e3edb57efc8062a5",
        "order": 4,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e151206531f4336f",
        "type": "ui_group",
        "name": "Idx table",
        "tab": "e3edb57efc8062a5",
        "order": 3,
        "disp": true,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "61d922efb8a113fa",
        "type": "ui_group",
        "name": "URL",
        "tab": "e3edb57efc8062a5",
        "order": 5,
        "disp": false,
        "width": "30",
        "collapse": false,
        "className": ""
    },
    {
        "id": "240e8c09f225dbd4",
        "type": "ui_group",
        "name": "Debug messages",
        "tab": "e3edb57efc8062a5",
        "order": 5,
        "disp": true,
        "width": 30,
        "collapse": false,
        "className": ""
    },
    {
        "id": "e3edb57efc8062a5",
        "type": "ui_tab",
        "name": "Shelly devices",
        "icon": "dashboard",
        "order": 3,
        "disabled": false,
        "hidden": false
    }
]
